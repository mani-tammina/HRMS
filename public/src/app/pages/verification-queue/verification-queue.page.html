<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin/timesheet/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>Verification Queue</ion-title>
  </ion-toolbar>

  <!-- Filters and Actions -->
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="toggleSelectAll()">
        <ion-icon name="checkmark-done-outline"></ion-icon>
        Select All
      </ion-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-badge color="primary">{{ selectedItems.size }}</ion-badge>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Filter and Search -->
  <ion-card>
    <ion-card-content>
      <ion-item>
        <ion-label>Status Filter</ion-label>
        <ion-select [(ngModel)]="filterStatus" (ionChange)="onFilterChange($event)">
          <ion-select-option value="pending">Pending</ion-select-option>
          <ion-select-option value="verified">Verified</ion-select-option>
        </ion-select>
      </ion-item>
      <ion-searchbar [(ngModel)]="searchTerm" 
                     placeholder="Search by employee, project, file..."
                     animated>
      </ion-searchbar>
    </ion-card-content>
  </ion-card>

  <!-- Bulk Actions -->
  <ion-card *ngIf="selectedItems.size > 0" class="bulk-actions-card">
    <ion-card-content>
      <div class="bulk-actions">
        <ion-button size="small" color="success" (click)="bulkApprove()">
          <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
          Verify ({{ selectedItems.size }})
        </ion-button>
        <ion-button size="small" color="danger" (click)="bulkReject()">
          <ion-icon name="close-circle-outline" slot="start"></ion-icon>
          Reject ({{ selectedItems.size }})
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Verification Queue List -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        Client Timesheet Uploads
        <ion-badge color="primary">{{ filteredQueue.length }}</ion-badge>
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list *ngIf="filteredQueue.length > 0">
        <ion-item *ngFor="let item of filteredQueue">
          <ion-checkbox slot="start" 
                        [checked]="selectedItems.has(item.client_timesheet_id)"
                        (ionChange)="toggleSelection(item.client_timesheet_id)">
          </ion-checkbox>

          <ion-label>
            <h2>{{ item.first_name }} {{ item.last_name }}</h2>
            <p>{{ item.employee_code }} â€¢ {{ item.project_name }}</p>
            <p><strong>Client:</strong> {{ item.client_name }}</p>
            <p><strong>Month/Year:</strong> {{ item.month }}/{{ item.year }}</p>
            <p><strong>File:</strong> {{ item.file_name }} ({{ (item.file_size / 1024).toFixed(2) }} KB)</p>
            
            <div class="chips">
              <ion-chip [color]="item.is_verified ? 'success' : 'warning'">
                <ion-icon [name]="item.is_verified ? 'checkmark-circle-outline' : 'time-outline'"></ion-icon>
                <ion-label>{{ item.is_verified ? 'Verified' : 'Pending Verification' }}</ion-label>
              </ion-chip>
              <ion-chip color="tertiary" *ngIf="item.work_update_id">
                <ion-icon name="document-text-outline"></ion-icon>
                <ion-label>Has Work Updates</ion-label>
              </ion-chip>
            </div>

            <p class="submission-time">
              Uploaded: {{ item.uploaded_at | date:'short' }}
            </p>
          </ion-label>

          <ion-button slot="end" 
                      fill="outline" 
                      size="small"
                      (click)="viewDetails(item.client_timesheet_id)">
            <ion-icon name="eye-outline"></ion-icon>
            View & Verify
          </ion-button>
        </ion-item>
      </ion-list>

      <div *ngIf="filteredQueue.length === 0" class="empty-state">
        <ion-icon name="checkmark-circle-outline" size="large" color="success"></ion-icon>
        <p>No client timesheets in queue</p>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>
