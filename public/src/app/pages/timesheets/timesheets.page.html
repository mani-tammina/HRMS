<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home"></ion-back-button>
    </ion-buttons>
    <ion-title>My Timesheets</ion-title>
  </ion-toolbar>
  
  <ion-toolbar>
    <ion-segment [(ngModel)]="selectedStatus" (ionChange)="segmentChanged($event)">
      <ion-segment-button value="all">
        <ion-label>All</ion-label>
      </ion-segment-button>
      <ion-segment-button value="pending">
        <ion-label>Pending</ion-label>
      </ion-segment-button>
      <ion-segment-button value="approved">
        <ion-label>Approved</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Assignment Status Card -->
  <ion-card *ngIf="hasProjectAssignment" class="info-card">
    <ion-card-content>
      <ion-icon name="checkmark-outline" color="success"></ion-icon>
      <span>You are assigned to projects - submit project timesheets</span>
    </ion-card-content>
  </ion-card>

  <!-- Timesheets List -->
  <div *ngIf="!isLoading && timesheets.length > 0">
    <ion-card *ngFor="let timesheet of timesheets" class="timesheet-card">
      <ion-card-content>
        <div class="timesheet-header">
          <div>
            <h3>{{formatDate(timesheet.timesheet_date)}}</h3>
            <p class="work-mode">{{timesheet.work_mode}}</p>
          </div>
          <ion-badge [color]="getStatusColor(timesheet.status)">
            {{timesheet.status}}
          </ion-badge>
        </div>

        <div class="timesheet-details">
          <div class="detail-row">
            <ion-icon name="time-outline"></ion-icon>
            <span>{{timesheet.shift_start_time}} - {{timesheet.shift_end_time}}</span>
          </div>
          <div class="detail-row">
            <ion-icon name="time-outline"></ion-icon>
            <span>Hours Worked: {{timesheet.actual_hours_worked}}h</span>
          </div>
          <div class="detail-row">
            <ion-icon name="checkmark-outline"></ion-icon>
            <span>Regular: {{timesheet.regular_hours}}h | Overtime: {{timesheet.overtime_hours}}h</span>
          </div>
        </div>

        <div class="tasks-section" *ngIf="timesheet.tasks_completed">
          <strong>Tasks Completed:</strong>
          <p>{{timesheet.tasks_completed}}</p>
        </div>

        <div class="challenges-section" *ngIf="timesheet.challenges_faced">
          <strong>Challenges:</strong>
          <p>{{timesheet.challenges_faced}}</p>
        </div>

        <div class="submission-time" *ngIf="timesheet.submission_timestamp">
          <ion-icon name="calendar-outline"></ion-icon>
          <span>Submitted: {{formatDate(timesheet.submission_timestamp)}}</span>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Empty State -->
  <ion-card *ngIf="!isLoading && timesheets.length === 0">
    <ion-card-content class="empty-state">
      <ion-icon name="time-outline" size="large"></ion-icon>
      <h3>No Timesheets</h3>
      <p>You haven't submitted any timesheets yet</p>
      <ion-button (click)="openSubmitModal()">
        <ion-icon name="add-outline" slot="start"></ion-icon>
        Submit Timesheet
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- FAB Button -->
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button (click)="openSubmitModal()">
      <ion-icon name="add-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <!-- Submit Timesheet Modal -->
  <ion-modal [isOpen]="showSubmitModal" (didDismiss)="closeSubmitModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Submit Timesheet</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeSubmitModal()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content>
        <div class="modal-content">
          <ion-list>
            <ion-item>
              <ion-label position="stacked">Date</ion-label>
              <ion-input type="date" [(ngModel)]="newTimesheet.timesheet_date"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Work Mode</ion-label>
              <ion-select [(ngModel)]="newTimesheet.work_mode">
                <ion-select-option value="Office">Office</ion-select-option>
                <ion-select-option value="WFH">Work From Home</ion-select-option>
                <ion-select-option value="Remote">Remote</ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Shift Start Time</ion-label>
              <ion-input type="time" [(ngModel)]="newTimesheet.shift_start_time"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Shift End Time</ion-label>
              <ion-input type="time" [(ngModel)]="newTimesheet.shift_end_time"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Hours Worked</ion-label>
              <ion-input type="number" [(ngModel)]="newTimesheet.actual_hours_worked"></ion-input>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Tasks Completed *</ion-label>
              <ion-textarea 
                [(ngModel)]="newTimesheet.tasks_completed"
                rows="4"
                placeholder="Describe what you accomplished today..."></ion-textarea>
            </ion-item>

            <ion-item>
              <ion-label position="stacked">Challenges Faced (Optional)</ion-label>
              <ion-textarea 
                [(ngModel)]="newTimesheet.challenges_faced"
                rows="3"
                placeholder="Any issues or blockers..."></ion-textarea>
            </ion-item>
          </ion-list>

          <div class="button-container">
            <ion-button expand="block" (click)="submitTimesheet()">
              Submit Timesheet
            </ion-button>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
