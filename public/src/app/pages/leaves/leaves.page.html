<ion-header>
  <ion-toolbar>
    <ion-title>Leave Management</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="leaves-container">
    <!-- Leave Balance -->
    <ion-card>
      <ion-card-header>
        <ion-card-title>Leave Balance</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="leave-grid" *ngIf="leaveBalances.length > 0; else noLeaveData">
          <div class="leave-type-item" *ngFor="let leave of leaveBalances">
            <div class="leave-icon" [ngClass]="{
              'primary': leave.type_code === 'AL' || leave.type_code === 'PL',
              'success': leave.type_code === 'SL' || leave.type_code === 'ML',
              'warning': leave.type_code === 'CL',
              'danger': leave.type_code === 'LWP' || leave.type_code === 'UL'
            }">
              <ion-icon [name]="getLeaveIcon(leave.type_code)"></ion-icon>
            </div>
            <div class="leave-info">
              <p class="leave-count">{{ leave.used_days || 0 }}<span>/{{ leave.allocated_days || 0 }}</span></p>
              <p class="leave-name">{{ leave.type_name || leave.leave_type_name }}</p>
              <p class="leave-remaining">{{ leave.available_days || 0 }} remaining</p>
            </div>
          </div>
        </div>
        <ng-template #noLeaveData>
          <div class="empty-state">
            <ion-icon name="calendar-outline" size="large"></ion-icon>
            <p>No leave balance data available</p>
          </div>
        </ng-template>
      </ion-card-content>
    </ion-card>

    <!-- Leave History -->
    <div class="section-title">
      <h2>Leave Requests</h2>
    </div>

    <ion-card *ngIf="leaves.length === 0">
      <ion-card-content class="empty-state">
        <ion-icon name="document-text-outline" size="large"></ion-icon>
        <p>No leave requests found</p>
        <ion-button (click)="requestLeave()">
          Request Leave
        </ion-button>
      </ion-card-content>
    </ion-card>

    <ion-card *ngIf="leaves.length > 0">
      <ion-list>
        <ion-item *ngFor="let leave of leaves" lines="full">
          <ion-icon 
            slot="start" 
            [name]="getStatusIcon(leave.status)" 
            [color]="getStatusColor(leave.status)">
          </ion-icon>
          <ion-label>
            <h3>{{ leave.type_name || leave.leaveType || 'Leave' }}</h3>
            <p>{{ leave.start_date | date:'MMM d' }} - {{ leave.end_date | date:'MMM d, y' }}</p>
            <p>{{ leave.total_days || leave.days }} day(s) â€¢ {{ leave.reason }}</p>
          </ion-label>
          <ion-badge slot="end" [color]="getStatusColor(leave.status)">
            {{ leave.status | titlecase }}
          </ion-badge>
        </ion-item>
      </ion-list>
    </ion-card>
  </div>

  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button (click)="requestLeave()">
      <ion-icon name="add-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
