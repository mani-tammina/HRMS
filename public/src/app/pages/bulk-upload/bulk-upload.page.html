<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>Bulk Upload</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Instructions Card -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="document-outline"></ion-icon>
        Upload Instructions
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ol>
        <li>Select the type of data you want to upload</li>
        <li>Download the template file for the selected type</li>
        <li>Fill in the template with your data</li>
        <li>Upload the completed file</li>
        <li>Review the upload results</li>
      </ol>
      <p class="note">
        <strong>Note:</strong> Make sure to follow the template format exactly. 
        Invalid data will be skipped with error messages.
      </p>
    </ion-card-content>
  </ion-card>

  <!-- Upload Type Selection -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Step 1: Select Upload Type</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item *ngFor="let type of uploadTypes">
          <ion-label>
            <h3>{{type.name}}</h3>
            <p>{{type.description}}</p>
          </ion-label>
          <ion-button 
            slot="end" 
            fill="outline"
            [color]="selectedType === type.id ? 'primary' : 'medium'"
            (click)="selectedType = type.id; resetUpload()">
            {{selectedType === type.id ? 'Selected' : 'Select'}}
          </ion-button>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Template Download -->
  <ion-card *ngIf="selectedType">
    <ion-card-header>
      <ion-card-title>Step 2: Download Template</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>Download the template file for <strong>{{getSelectedTypeName()}}</strong></p>
      <ion-button expand="block" (click)="downloadTemplate()">
        <ion-icon name="download-outline" slot="start"></ion-icon>
        Download Template
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- File Upload -->
  <ion-card *ngIf="selectedType">
    <ion-card-header>
      <ion-card-title>Step 3: Upload File</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="upload-area">
        <input 
          type="file" 
          id="fileInput" 
          accept=".xlsx,.xls,.csv"
          (change)="onFileSelected($event)"
          style="display: none">
        
        <label for="fileInput" class="file-label">
          <ion-icon name="cloud-upload-outline"></ion-icon>
          <p>Click to select file or drag & drop</p>
          <small>Supported formats: Excel (.xlsx, .xls), CSV (.csv)</small>
        </label>

        <div *ngIf="selectedFile" class="selected-file">
          <ion-icon name="document-outline"></ion-icon>
          <span>{{selectedFile.name}}</span>
          <ion-button fill="clear" size="small" (click)="resetUpload()">
            <ion-icon name="close-circle-outline"></ion-icon>
          </ion-button>
        </div>
      </div>

      <ion-button 
        expand="block" 
        [disabled]="!selectedFile || isUploading"
        (click)="uploadFile()"
        class="upload-btn">
        <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
        {{isUploading ? 'Uploading...' : 'Upload File'}}
      </ion-button>

      <ion-progress-bar 
        *ngIf="isUploading" 
        [value]="uploadProgress / 100"
        color="primary">
      </ion-progress-bar>
    </ion-card-content>
  </ion-card>

  <!-- Upload Results -->
  <ion-card *ngIf="uploadResult">
    <ion-card-header>
      <ion-card-title>
        <ion-icon 
          [name]="uploadResult.success ? 'checkmark-circle-outline' : 'close-circle-outline'"
          [color]="uploadResult.success ? 'success' : 'danger'">
        </ion-icon>
        Upload Results
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <div class="result-stat success">
              <ion-icon name="checkmark-circle-outline"></ion-icon>
              <span class="stat-value">{{uploadResult.successCount}}</span>
              <span class="stat-label">Successful</span>
            </div>
          </ion-col>
          <ion-col size="6">
            <div class="result-stat error">
              <ion-icon name="close-circle-outline"></ion-icon>
              <span class="stat-value">{{uploadResult.errorCount}}</span>
              <span class="stat-label">Errors</span>
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>

      <div *ngIf="uploadResult.errors && uploadResult.errors.length > 0" class="error-list">
        <h4>Errors:</h4>
        <ion-list>
          <ion-item *ngFor="let error of uploadResult.errors">
            <ion-label class="ion-text-wrap">
              <p class="error-message">
                <strong>Row {{error.row}}:</strong> {{error.error}}
              </p>
            </ion-label>
          </ion-item>
        </ion-list>
      </div>

      <ion-button expand="block" (click)="resetUpload()" class="reset-btn">
        Upload Another File
      </ion-button>
    </ion-card-content>
  </ion-card>
</ion-content>
