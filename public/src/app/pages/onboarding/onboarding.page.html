<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Onboarding Management</ion-title>
    <ion-buttons slot="end" *ngIf="isHR && selectedSegment === 'candidates'">
      <ion-button (click)="openCandidateModal()">
        <ion-icon slot="icon-only" name="add-circle"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-buttons slot="end" *ngIf="isHR && selectedSegment === 'tasks'">
      <ion-button (click)="openTaskModal()">
        <ion-icon slot="icon-only" name="add-circle"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <!-- Segments -->
  <ion-toolbar>
    <ion-segment [(ngModel)]="selectedSegment" (ionChange)="segmentChanged($event)">
      <ion-segment-button value="candidates" *ngIf="isHR">
        <ion-icon name="people"></ion-icon>
        <ion-label>Candidates</ion-label>
      </ion-segment-button>
      <ion-segment-button value="tasks" *ngIf="isHR">
        <ion-icon name="list"></ion-icon>
        <ion-label>Tasks Setup</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- CANDIDATES TAB -->
  <div *ngIf="selectedSegment === 'candidates' && isHR">
    <!-- Stats Cards -->
    <div class="stats-container" *ngIf="candidateStats">
      <ion-card class="stat-card">
        <ion-card-content>
          <div class="stat-value">{{ candidateStats.total_candidates || 0 }}</div>
          <div class="stat-label">Total Candidates</div>
        </ion-card-content>
      </ion-card>
      <ion-card class="stat-card">
        <ion-card-content>
          <div class="stat-value">{{ candidateStats.offer_accepted || 0 }}</div>
          <div class="stat-label">Accepted</div>
        </ion-card-content>
      </ion-card>
      <ion-card class="stat-card">
        <ion-card-content>
          <div class="stat-value">{{ candidateStats.ready_to_join || 0 }}</div>
          <div class="stat-label">Ready to Join</div>
        </ion-card-content>
      </ion-card>
      <ion-card class="stat-card">
        <ion-card-content>
          <div class="stat-value">{{ candidateStats.joined || 0 }}</div>
          <div class="stat-label">Joined</div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Action Bar -->
    <div class="action-bar">
      <ion-button expand="block" (click)="openCandidateModal()">
        <ion-icon name="add-circle" slot="start"></ion-icon>
        Add New Candidate
      </ion-button>
    </div>

    <!-- Candidates List -->
    <div class="candidates-list">
      <ion-card *ngFor="let candidate of candidates" class="candidate-card">
        <ion-card-header>
          <div class="candidate-header">
            <div class="candidate-info">
              <ion-card-title>{{ candidate.full_name }}</ion-card-title>
              <p class="candidate-id">{{ candidate.candidate_id }}</p>
              <p class="position">{{ candidate.position }}</p>
              <p class="contact">
                <ion-icon name="mail"></ion-icon> {{ candidate.email }}
                <ion-icon name="call" style="margin-left: 10px"></ion-icon> {{ candidate.phone }}
              </p>
            </div>
            <div class="candidate-badges">
              <ion-badge [color]="getStatusColor(candidate.status)">
                {{ candidate.status }}
              </ion-badge>
              <ion-badge [color]="getBGVColor(candidate.bgv_status)" *ngIf="candidate.bgv_status && candidate.bgv_status !== 'not_started'">
                BGV: {{ candidate.bgv_status }}
              </ion-badge>
            </div>
          </div>
        </ion-card-header>

        <ion-card-content>
          <div class="candidate-details">
            <ion-chip *ngIf="candidate.department_name">
              <ion-icon name="briefcase"></ion-icon>
              <ion-label>{{ candidate.department_name }}</ion-label>
            </ion-chip>
            <ion-chip *ngIf="candidate.designation_name">
              <ion-icon name="person"></ion-icon>
              <ion-label>{{ candidate.designation_name }}</ion-label>
            </ion-chip>
            <ion-chip *ngIf="candidate.joining_date">
              <ion-icon name="calendar"></ion-icon>
              <ion-label>{{ formatDate(candidate.joining_date) }}</ion-label>
            </ion-chip>
            <ion-chip *ngIf="candidate.offered_ctc">
              <ion-icon name="cash"></ion-icon>
              <ion-label>₹{{ candidate.offered_ctc }}</ion-label>
            </ion-chip>
          </div>

          <div class="action-buttons">
            <ion-button size="small" fill="outline" (click)="viewCandidateDetails(candidate)">
              <ion-icon name="eye" slot="start"></ion-icon>
              View
            </ion-button>
            <ion-button size="small" fill="outline" (click)="showCandidateActions(candidate)">
              <ion-icon name="ellipsis-horizontal" slot="start"></ion-icon>
              Actions
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Empty State -->
      <ion-card *ngIf="!loading && candidates.length === 0" class="empty-state">
        <ion-card-content>
          <ion-icon name="people-outline" size="large"></ion-icon>
          <h3>No Candidates Found</h3>
          <p>Add candidates to start the pre-onboarding process</p>
          <ion-button (click)="openCandidateModal()">
            <ion-icon name="add-circle" slot="start"></ion-icon>
            Add Candidate
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Loading -->
    <div class="loading-container" *ngIf="loading">
      <ion-spinner></ion-spinner>
    </div>
  </div>

  <!-- TASKS TAB -->
  <div *ngIf="selectedSegment === 'tasks' && isHR">
    <div class="action-bar">
      <ion-button expand="block" (click)="setupDefaultTasks()">
        <ion-icon name="refresh" slot="start"></ion-icon>
        Setup Default Tasks
      </ion-button>
    </div>

    <ion-list>
      <ion-item-divider>
        <ion-label>Pre-onboarding Task Templates ({{ taskTemplates.length }})</ion-label>
      </ion-item-divider>

      <ion-item *ngFor="let task of taskTemplates">
        <ion-label>
          <h2>{{ task.task_name }}</h2>
          <p>{{ task.description }}</p>
          <ion-badge [color]="task.is_mandatory ? 'danger' : 'medium'" style="margin-right: 5px;">
            {{ task.is_mandatory ? 'Mandatory' : 'Optional' }}
          </ion-badge>
          <ion-badge color="secondary" *ngIf="task.auto_assign">Auto-assign</ion-badge>
          <ion-chip>
            <ion-label>{{ task.task_category }}</ion-label>
          </ion-chip>
        </ion-label>
        <ion-buttons slot="end">
          <ion-button (click)="openTaskModal(task)">
            <ion-icon name="create" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-button color="danger" (click)="deleteTask(task)">
            <ion-icon name="trash" slot="icon-only"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>

      <ion-item *ngIf="taskTemplates.length === 0 && !loading">
        <ion-label>
          <h2>No Tasks Found</h2>
          <p>Click "Setup Default Tasks" to create initial templates</p>
        </ion-label>
      </ion-item>
    </ion-list>

    <div class="loading-container" *ngIf="loading">
      <ion-spinner></ion-spinner>
    </div>
  </div>
</ion-content>

<!-- ADD/EDIT CANDIDATE MODAL -->
<ion-modal [isOpen]="showCandidateModal" (didDismiss)="closeCandidateModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>{{ candidateForm.id ? 'Edit' : 'Add' }} Candidate</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeCandidateModal()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <form>
        <ion-list>
          <ion-item-divider>
            <ion-label>Personal Information</ion-label>
          </ion-item-divider>

          <ion-item>
            <ion-input label="First Name *" labelPlacement="floating" [(ngModel)]="candidateForm.first_name" name="first_name" required></ion-input>
          </ion-item>
          
          <ion-item>
            <ion-input label="Middle Name" labelPlacement="floating" [(ngModel)]="candidateForm.middle_name" name="middle_name"></ion-input>
          </ion-item>

          <ion-item>
            <ion-input label="Last Name *" labelPlacement="floating" [(ngModel)]="candidateForm.last_name" name="last_name" required></ion-input>
          </ion-item>

          <ion-item>
            <ion-input label="Email *" labelPlacement="floating" type="email" [(ngModel)]="candidateForm.email" name="email" required></ion-input>
          </ion-item>

          <ion-item>
            <ion-input label="Phone *" labelPlacement="floating" type="tel" [(ngModel)]="candidateForm.phone" name="phone" required></ion-input>
          </ion-item>

          <ion-item>
            <ion-input label="Alternate Phone" labelPlacement="floating" type="tel" [(ngModel)]="candidateForm.alternate_phone" name="alternate_phone"></ion-input>
          </ion-item>

          <ion-item>
            <ion-input label="Date of Birth" labelPlacement="floating" type="date" [(ngModel)]="candidateForm.date_of_birth" name="date_of_birth"></ion-input>
          </ion-item>

          <ion-item>
            <ion-select label="Gender" labelPlacement="floating" [(ngModel)]="candidateForm.gender" name="gender">
              <ion-select-option value="Male">Male</ion-select-option>
              <ion-select-option value="Female">Female</ion-select-option>
              <ion-select-option value="Other">Other</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item-divider>
            <ion-label>Job Information</ion-label>
          </ion-item-divider>

          <ion-item>
            <ion-input label="Position *" labelPlacement="floating" [(ngModel)]="candidateForm.position" name="position" required></ion-input>
          </ion-item>

          <ion-item>
            <ion-select label="Department" labelPlacement="floating" [(ngModel)]="candidateForm.department_id" name="department_id">
              <ion-select-option *ngFor="let dept of departments" [value]="dept.id">{{ dept.name }}</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-select label="Designation" labelPlacement="floating" [(ngModel)]="candidateForm.designation_id" name="designation_id">
              <ion-select-option *ngFor="let desg of designations" [value]="desg.id">{{ desg.name }}</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-select label="Location" labelPlacement="floating" [(ngModel)]="candidateForm.location_id" name="location_id">
              <ion-select-option *ngFor="let loc of locations" [value]="loc.id">{{ loc.name }}</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-select label="Reporting Manager" labelPlacement="floating" [(ngModel)]="candidateForm.reporting_manager_id" name="reporting_manager_id" interface="alert">
              <div slot="header">
                <ion-searchbar placeholder="Search manager" (ionInput)="filterManagers($event)"></ion-searchbar>
              </div>
              <ion-select-option *ngFor="let mgr of filteredManagers" [value]="mgr.id">
                {{ mgr.FullName }} ({{ mgr.EmployeeCode }})
              </ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-input label="Offered CTC" labelPlacement="floating" type="number" [(ngModel)]="candidateForm.offered_ctc" name="offered_ctc"></ion-input>
          </ion-item>

          <ion-item>
            <ion-input label="Joining Date" labelPlacement="floating" type="date" [(ngModel)]="candidateForm.joining_date" name="joining_date"></ion-input>
          </ion-item>

          <ion-item-divider>
            <ion-label>Recruitment Information</ion-label>
          </ion-item-divider>

          <ion-item>
            <ion-input label="Recruiter Name" labelPlacement="floating" [(ngModel)]="candidateForm.recruiter_name" name="recruiter_name"></ion-input>
          </ion-item>

          <ion-item>
            <ion-input label="Recruitment Source" labelPlacement="floating" [(ngModel)]="candidateForm.recruitment_source" name="recruitment_source" placeholder="e.g., LinkedIn, Naukri"></ion-input>
          </ion-item>
        </ion-list>
      </form>
    </ion-content>

    <ion-footer>
      <ion-toolbar>
        <ion-buttons slot="end">
          <ion-button (click)="closeCandidateModal()">Cancel</ion-button>
          <ion-button (click)="saveCandidate()" color="primary">Save</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-footer>
  </ng-template>
</ion-modal>

<!-- TASK TEMPLATE MODAL -->
<ion-modal [isOpen]="showTaskModal" (didDismiss)="closeTaskModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>{{ taskForm.id ? 'Edit' : 'Add' }} Task Template</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeTaskModal()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <form>
        <ion-list>
          <ion-item>
            <ion-input label="Task Name *" labelPlacement="floating" [(ngModel)]="taskForm.task_name" name="task_name" required></ion-input>
          </ion-item>

          <ion-item>
            <ion-textarea label="Description" labelPlacement="floating" [(ngModel)]="taskForm.description" name="description" rows="3"></ion-textarea>
          </ion-item>

          <ion-item>
            <ion-select label="Category" labelPlacement="floating" [(ngModel)]="taskForm.task_category" name="task_category">
              <ion-select-option value="document_submission">Document Submission</ion-select-option>
              <ion-select-option value="form_filling">Form Filling</ion-select-option>
              <ion-select-option value="verification">Verification</ion-select-option>
              <ion-select-option value="system_setup">System Setup</ion-select-option>
              <ion-select-option value="other">Other</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-select label="Assigned To" labelPlacement="floating" [(ngModel)]="taskForm.assigned_to_role" name="assigned_to_role">
              <ion-select-option value="candidate">Candidate</ion-select-option>
              <ion-select-option value="hr">HR</ion-select-option>
              <ion-select-option value="manager">Manager</ion-select-option>
              <ion-select-option value="admin">Admin</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-input label="Task Order" labelPlacement="floating" type="number" [(ngModel)]="taskForm.task_order" name="task_order"></ion-input>
          </ion-item>

          <ion-item>
            <ion-select label="Mandatory?" labelPlacement="floating" [(ngModel)]="taskForm.is_mandatory" name="is_mandatory">
              <ion-select-option [value]="1">Yes</ion-select-option>
              <ion-select-option [value]="0">No</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-select label="Auto-assign?" labelPlacement="floating" [(ngModel)]="taskForm.auto_assign" name="auto_assign">
              <ion-select-option [value]="1">Yes</ion-select-option>
              <ion-select-option [value]="0">No</ion-select-option>
            </ion-select>
          </ion-item>
        </ion-list>
      </form>
    </ion-content>

    <ion-footer>
      <ion-toolbar>
        <ion-buttons slot="end">
          <ion-button (click)="closeTaskModal()">Cancel</ion-button>
          <ion-button (click)="saveTask()" color="primary">Save</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-footer>
  </ng-template>
</ion-modal>

<!-- DOCUMENT UPLOAD MODAL -->
<ion-modal [isOpen]="showDocumentModal" (didDismiss)="closeDocumentModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Upload Document</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeDocumentModal()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <form>
        <ion-list>
          <ion-item>
            <ion-select label="Document Type" labelPlacement="floating" [(ngModel)]="documentForm.document_type" name="document_type">
              <ion-select-option value="photo">Photo</ion-select-option>
              <ion-select-option value="resume">Resume</ion-select-option>
              <ion-select-option value="offer_letter">Offer Letter</ion-select-option>
              <ion-select-option value="id_proof">ID Proof</ion-select-option>
              <ion-select-option value="address_proof">Address Proof</ion-select-option>
              <ion-select-option value="pan_card">PAN Card</ion-select-option>
              <ion-select-option value="aadhar_card">Aadhar Card</ion-select-option>
              <ion-select-option value="education_certificate">Education Certificate</ion-select-option>
              <ion-select-option value="experience_certificate">Experience Certificate</ion-select-option>
              <ion-select-option value="relieving_letter">Relieving Letter</ion-select-option>
              <ion-select-option value="salary_slip">Salary Slip</ion-select-option>
              <ion-select-option value="bank_passbook">Bank Passbook</ion-select-option>
              <ion-select-option value="cancelled_cheque">Cancelled Cheque</ion-select-option>
              <ion-select-option value="other">Other</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-select label="Required?" labelPlacement="floating" [(ngModel)]="documentForm.required" name="required">
              <ion-select-option [value]="1">Yes</ion-select-option>
              <ion-select-option [value]="0">No</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <input type="file" (change)="onFileSelected($event)" />
          </ion-item>
        </ion-list>
      </form>
    </ion-content>

    <ion-footer>
      <ion-toolbar>
        <ion-buttons slot="end">
          <ion-button (click)="closeDocumentModal()">Cancel</ion-button>
          <ion-button (click)="uploadDocument()" color="primary">Upload</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-footer>
  </ng-template>
</ion-modal>

<!-- OFFER CREATION MODAL -->
<ion-modal [isOpen]="showOfferModal" (didDismiss)="showOfferModal = false">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>Create Offer - Step {{ offerStep }}/4</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="showOfferModal = false">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <!-- Step 1: Job Details -->
      <div *ngIf="offerStep === 1">
        <ion-list>
          <ion-item-divider>
            <ion-label>Job Details</ion-label>
          </ion-item-divider>

          <ion-item>
            <ion-input label="Position" labelPlacement="floating" [(ngModel)]="offerForm.position" name="position"></ion-input>
          </ion-item>

          <ion-item>
            <ion-select label="Department" labelPlacement="floating" [(ngModel)]="offerForm.department_id" name="department_id">
              <ion-select-option *ngFor="let dept of departments" [value]="dept.id">{{ dept.department_name }}</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-select label="Designation" labelPlacement="floating" [(ngModel)]="offerForm.designation_id" name="designation_id">
              <ion-select-option *ngFor="let desg of designations" [value]="desg.id">{{ desg.designation_name }}</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-select label="Location" labelPlacement="floating" [(ngModel)]="offerForm.location_id" name="location_id">
              <ion-select-option *ngFor="let loc of locations" [value]="loc.id">{{ loc.location_name }}</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-select label="Reporting Manager" labelPlacement="floating" [(ngModel)]="offerForm.reporting_manager_id" name="reporting_manager_id" interface="alert">
              <div slot="header">
                <ion-searchbar placeholder="Search manager" (ionInput)="filterManagers($event)"></ion-searchbar>
              </div>
              <ion-select-option *ngFor="let mgr of filteredManagers" [value]="mgr.id">
                {{ mgr.FullName }} ({{ mgr.EmployeeCode }})
              </ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-select label="Work Mode" labelPlacement="floating" [(ngModel)]="offerForm.work_mode" name="work_mode">
              <ion-select-option value="Office">Office</ion-select-option>
              <ion-select-option value="WFH">Work From Home</ion-select-option>
              <ion-select-option value="Hybrid">Hybrid</ion-select-option>
              <ion-select-option value="Remote">Remote</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-input label="Joining Date" labelPlacement="floating" type="date" [(ngModel)]="offerForm.joining_date" name="joining_date"></ion-input>
          </ion-item>
        </ion-list>
      </div>

      <!-- Step 2: Compensation -->
      <div *ngIf="offerStep === 2">
        <ion-list>
          <ion-item-divider>
            <ion-label>Compensation</ion-label>
          </ion-item-divider>

          <ion-item>
            <ion-input label="Offered CTC" labelPlacement="floating" type="number" [(ngModel)]="offerForm.offered_ctc" name="offered_ctc" (ionBlur)="calculateSalaryBreakup()"></ion-input>
          </ion-item>

          <ion-item>
            <ion-button expand="block" (click)="calculateSalaryBreakup()">Calculate Breakup</ion-button>
          </ion-item>

          <ion-item>
            <ion-input label="Basic Salary" labelPlacement="floating" type="number" [(ngModel)]="offerForm.salary_breakup.basic" name="basic" readonly></ion-input>
          </ion-item>

          <ion-item>
            <ion-input label="HRA" labelPlacement="floating" type="number" [(ngModel)]="offerForm.salary_breakup.hra" name="hra" readonly></ion-input>
          </ion-item>

          <ion-item>
            <ion-input label="Special Allowance" labelPlacement="floating" type="number" [(ngModel)]="offerForm.salary_breakup.special_allowance" name="special_allowance" readonly></ion-input>
          </ion-item>
        </ion-list>
      </div>

      <!-- Step 3: Offer Details -->
      <div *ngIf="offerStep === 3">
        <ion-list>
          <ion-item-divider>
            <ion-label>Offer Details</ion-label>
          </ion-item-divider>

          <ion-item>
            <ion-input label="Offer Valid Until" labelPlacement="floating" type="date" [(ngModel)]="offerForm.offer_validity_date" name="offer_validity_date"></ion-input>
          </ion-item>

          <ion-item>
            <ion-input label="Probation Period (months)" labelPlacement="floating" type="number" [(ngModel)]="offerForm.probation_period" name="probation_period"></ion-input>
          </ion-item>

          <ion-item>
            <ion-input label="Notice Period (months)" labelPlacement="floating" type="number" [(ngModel)]="offerForm.notice_period" name="notice_period"></ion-input>
          </ion-item>

          <ion-item>
            <ion-textarea label="Special Terms" labelPlacement="floating" [(ngModel)]="offerForm.special_terms" name="special_terms" rows="3"></ion-textarea>
          </ion-item>

          <ion-item>
            <ion-textarea label="Benefits" labelPlacement="floating" [(ngModel)]="offerForm.benefits" name="benefits" rows="3"></ion-textarea>
          </ion-item>
        </ion-list>
      </div>

      <!-- Step 4: Preview -->
      <div *ngIf="offerStep === 4">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Offer Preview</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-item>
                <ion-label><strong>Position:</strong> {{ offerForm.position }}</ion-label>
              </ion-item>
              <ion-item>
                <ion-label><strong>CTC:</strong> ₹{{ offerForm.offered_ctc }}</ion-label>
              </ion-item>
              <ion-item>
                <ion-label><strong>Joining Date:</strong> {{ formatDate(offerForm.joining_date) }}</ion-label>
              </ion-item>
              <ion-item>
                <ion-label><strong>Work Mode:</strong> {{ offerForm.work_mode }}</ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </div>
    </ion-content>

    <ion-footer>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button *ngIf="offerStep > 1" (click)="prevOfferStep()">Previous</ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
          <ion-button *ngIf="offerStep < 4" (click)="nextOfferStep()" color="primary">Next</ion-button>
          <ion-button *ngIf="offerStep === 4" (click)="saveOffer()" color="success">Save Offer</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-footer>
  </ng-template>
</ion-modal>

<!-- CANDIDATE DETAILS/PROGRESS MODAL -->
<ion-modal [isOpen]="showProgressModal" (didDismiss)="showProgressModal = false">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-buttons slot="start">
          <ion-button (click)="showProgressModal = false">
            <ion-icon name="arrow-back"></ion-icon>
          </ion-button>
        </ion-buttons>
        <ion-title>{{ selectedCandidate?.full_name }}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="showProgressModal = false">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <ion-card *ngIf="selectedCandidate">
        <ion-card-header>
          <ion-card-title>Candidate Information</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p><strong>Email:</strong> {{ selectedCandidate.email }}</p>
          <p><strong>Phone:</strong> {{ selectedCandidate.phone }}</p>
          <p><strong>Position:</strong> {{ selectedCandidate.position }}</p>
          <p><strong>Status:</strong> 
            <ion-badge [color]="getStatusColor(selectedCandidate.status)">{{ selectedCandidate.status }}</ion-badge>
          </p>
          <p *ngIf="selectedCandidate.bgv_status"><strong>BGV:</strong> 
            <ion-badge [color]="getBGVColor(selectedCandidate.bgv_status)">{{ selectedCandidate.bgv_status }}</ion-badge>
          </p>
        </ion-card-content>
      </ion-card>

      <!-- Documents -->
      <ion-card *ngIf="candidateDocuments.length > 0">
        <ion-card-header>
          <ion-card-title>Documents ({{ candidateDocuments.length }})</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item *ngFor="let doc of candidateDocuments">
              <ion-label>
                <h3>{{ doc.document_type }}</h3>
                <p>{{ doc.document_name }}</p>
                <p *ngIf="doc.uploaded_date">Uploaded: {{ formatDate(doc.uploaded_date) }}</p>
              </ion-label>
              <ion-badge slot="end" [color]="doc.verified ? 'success' : 'warning'">
                {{ doc.verified ? 'Verified' : 'Pending' }}
              </ion-badge>
              <ion-button slot="end" *ngIf="!doc.verified" (click)="verifyDocument(doc)" size="small">
                <ion-icon name="checkmark-circle"></ion-icon>
              </ion-button>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>

      <!-- Tasks Progress -->
      <ion-card *ngIf="candidateProgress.length > 0">
        <ion-card-header>
          <ion-card-title>Tasks Progress ({{ candidateProgress.length }})</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item *ngFor="let task of candidateProgress">
              <ion-label>
                <h3>{{ task.task_name }}</h3>
                <p>{{ task.description }}</p>
                <p *ngIf="task.completed_date">Completed: {{ formatDate(task.completed_date) }}</p>
              </ion-label>
              <ion-badge slot="end" [color]="task.status === 'completed' ? 'success' : 'warning'">
                {{ task.status }}
              </ion-badge>
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>
    </ion-content>
  </ng-template>
</ion-modal>
