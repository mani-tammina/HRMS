<!-- Payroll Period Lock Section -->
<ion-card *ngIf="selectedView === 'payroll' && payrollStatus" class="payroll-lock-card">
  <ion-card-header>
    <div class="card-header-flex">
      <ion-card-title>Payroll Period Management</ion-card-title>
      <ion-badge [color]="getPayrollLockStatusColor(payrollStatus.payrollPeriodLock?.lock_status)">
        {{ payrollStatus.payrollPeriodLock?.lock_status || 'Open' | titlecase }}
      </ion-badge>
    </div>
  </ion-card-header>
  <ion-card-content>
    <!-- Current Period Info -->
    <div class="period-info">
      <div class="info-row">
        <span class="label">Current Period:</span>
        <span class="value">{{ selectedDate | date:'MMMM yyyy' }}</span>
      </div>
      <div class="info-row">
        <span class="label">Pending Verifications:</span>
        <span class="value" [class.warning]="payrollStatus.pendingVerifications.count > 0">
          {{ payrollStatus.pendingVerifications.count }}
        </span>
      </div>
      <div class="info-row">
        <span class="label">Flagged Submissions:</span>
        <span class="value" [class.warning]="payrollStatus.payrollPeriodLock?.flagged_submissions > 0">
          {{ payrollStatus.payrollPeriodLock?.flagged_submissions || 0 }}
        </span>
      </div>
    </div>

    <!-- Warning Messages -->
    <div class="warning-section" *ngIf="payrollStatus.pendingVerifications.count > 0">
      <ion-chip color="warning">
        <ion-icon name="warning-outline"></ion-icon>
        <ion-label>{{ payrollStatus.pendingVerifications.count }} timesheets pending verification</ion-label>
      </ion-chip>
      <p class="warning-text">
        Please verify all pending timesheets before locking the payroll period.
      </p>
    </div>

    <div class="warning-section" *ngIf="payrollStatus.payrollPeriodLock?.flagged_submissions > 0">
      <ion-chip color="danger">
        <ion-icon name="alert-circle-outline"></ion-icon>
        <ion-label>{{ payrollStatus.payrollPeriodLock.flagged_submissions }} flagged submissions</ion-label>
      </ion-chip>
      <p class="warning-text">
        Review and resolve all flagged timesheets before processing payroll.
      </p>
    </div>

    <!-- Lock/Unlock Actions -->
    <div class="action-section">
      <ion-button 
        expand="block" 
        [disabled]="payrollStatus.pendingVerifications.count > 0 || payrollStatus.payrollPeriodLock?.lock_status === 'locked'"
        (click)="lockPayrollPeriod()"
        color="danger">
        <ion-icon slot="start" name="lock-closed-outline"></ion-icon>
        Lock Payroll Period
      </ion-button>

      <p class="help-text">
        <ion-icon name="information-circle-outline"></ion-icon>
        Locking the period will prevent any further changes to timesheets and enable payroll processing.
      </p>
    </div>

    <!-- Lock Status Details -->
    <div class="lock-details" *ngIf="payrollStatus.payrollPeriodLock?.lock_status === 'locked'">
      <div class="detail-row">
        <ion-icon name="lock-closed" color="danger"></ion-icon>
        <span>Period locked on {{ payrollStatus.payrollPeriodLock.locked_at | date:'medium' }}</span>
      </div>
      <p class="info-text">
        This payroll period is locked. Contact system administrator if changes are needed.
      </p>
    </div>
  </ion-card-content>
</ion-card>

<!-- Pending Verifications List for Payroll View -->
<ion-card *ngIf="selectedView === 'payroll' && payrollStatus && payrollStatus.pendingVerifications.items?.length > 0">
  <ion-card-header>
    <ion-card-title>Pending Verifications</ion-card-title>
  </ion-card-header>
  <ion-card-content>
    <ion-list>
      <ion-item *ngFor="let item of payrollStatus.pendingVerifications.items" 
                [routerLink]="['/verification-queue']"
                button>
        <ion-label>
          <h3>{{ item.employee_name }}</h3>
          <p>{{ item.project_name }} - {{ item.update_date | date:'mediumDate' }}</p>
        </ion-label>
        <ion-badge slot="end" color="warning">Pending</ion-badge>
      </ion-item>
    </ion-list>
    
    <ion-button expand="block" fill="outline" routerLink="/verification-queue">
      <ion-icon slot="start" name="document-text-outline"></ion-icon>
      View Verification Queue
    </ion-button>
  </ion-card-content>
</ion-card>
