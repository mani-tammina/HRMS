<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>Master Data Management</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Type Selection -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Select Master Data Type</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label position="stacked">Master Data Type</ion-label>
        <ion-select 
          [(ngModel)]="selectedType" 
          (ionChange)="onTypeChange()"
          placeholder="Choose a type">
          <ion-select-option *ngFor="let type of masterDataTypes" [value]="type.id">
            {{type.name}}
          </ion-select-option>
        </ion-select>
      </ion-item>
    </ion-card-content>
  </ion-card>

  <!-- Data List -->
  <div *ngIf="selectedType">
    <!-- Search Bar -->
    <ion-searchbar
      [(ngModel)]="searchTerm"
      (ionInput)="searchData()"
      placeholder="Search by name, code or description"
      animated>
    </ion-searchbar>

    <!-- Summary -->
    <div class="data-summary">
      <ion-badge color="primary">{{filteredData.length}} records</ion-badge>
      <span class="type-name">{{getSelectedTypeName()}}</span>
    </div>

    <!-- Debug Info -->
    <ion-card color="light" style="margin: 8px;">
      <ion-card-content>
        <strong>Debug Info:</strong><br>
        masterData.length: {{masterData.length}}<br>
        filteredData.length: {{filteredData.length}}<br>
        isLoading: {{isLoading}}<br>
        selectedType: {{selectedType}}
      </ion-card-content>
    </ion-card>

    <!-- Data Cards -->
    <ion-card *ngFor="let item of filteredData" class="data-card">
      <ion-card-content>
        <div class="card-header">
          <div class="item-info">
            <h3>{{item.name}}</h3>
            <p *ngIf="item.code" class="code">Code: {{item.code}}</p>
            <p *ngIf="item.description" class="description">{{item.description}}</p>
          </div>
          <div class="item-actions">
            <ion-badge *ngIf="item.is_active !== undefined" [color]="item.is_active ? 'success' : 'danger'">
              {{item.is_active ? 'Active' : 'Inactive'}}
            </ion-badge>
          </div>
        </div>
        
        <div class="action-buttons">
          <ion-button fill="outline" size="small" (click)="openEditModal(item)">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Edit
          </ion-button>
          <ion-button fill="outline" color="danger" size="small" (click)="deleteItem(item)">
            <ion-icon name="trash-outline" slot="start"></ion-icon>
            Delete
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Empty State -->
    <div *ngIf="filteredData.length === 0 && !isLoading" class="empty-state">
      <ion-icon name="search-outline"></ion-icon>
      <h3>No records found</h3>
      <p>{{searchTerm ? 'Try a different search term' : 'Click + to add new record'}}</p>
    </div>

    <!-- FAB Button -->
    <ion-fab vertical="bottom" horizontal="end" slot="fixed">
      <ion-fab-button (click)="openCreateModal()">
        <ion-icon name="add-outline"></ion-icon>
      </ion-fab-button>
    </ion-fab>
  </div>

  <!-- No Type Selected State -->
  <div *ngIf="!selectedType" class="empty-state">
    <ion-icon name="settings-outline"></ion-icon>
    <h3>Select a Master Data Type</h3>
    <p>Choose a type from the dropdown above to manage data</p>
  </div>
</ion-content>

<!-- Create/Edit Modal -->
<ion-modal [isOpen]="showModal" (didDismiss)="closeModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>{{isEditMode ? 'Edit' : 'Create'}} {{getSelectedTypeName()}}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeModal()">Close</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    
    <ion-content class="ion-padding">
      <ion-list>
        <ion-item>
          <ion-label position="stacked">Name *</ion-label>
          <ion-input 
            [(ngModel)]="currentItem.name" 
            placeholder="Enter name"
            required>
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Code</ion-label>
          <ion-input 
            [(ngModel)]="currentItem.code" 
            placeholder="Enter code">
          </ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">Description</ion-label>
          <ion-textarea 
            [(ngModel)]="currentItem.description" 
            placeholder="Enter description"
            rows="3">
          </ion-textarea>
        </ion-item>

        <ion-item *ngIf="hasActiveField()">
          <ion-label>Active</ion-label>
          <ion-toggle [(ngModel)]="currentItem.is_active" slot="end"></ion-toggle>
        </ion-item>
      </ion-list>

      <ion-button expand="block" (click)="saveItem()" class="save-btn">
        {{isEditMode ? 'Update' : 'Create'}}
      </ion-button>
    </ion-content>
  </ng-template>
</ion-modal>
