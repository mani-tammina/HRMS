<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home"></ion-back-button>
    </ion-buttons>
    <ion-title>My Payslips</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="loadPayslips($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Filter Section -->
  <ion-card>
    <ion-card-content>
      <ion-item lines="none">
        <ion-label>Year</ion-label>
        <ion-select [(ngModel)]="selectedYear" (ionChange)="onYearChange()" interface="popover">
          <ion-select-option *ngFor="let year of years" [value]="year">{{year}}</ion-select-option>
        </ion-select>
      </ion-item>
    </ion-card-content>
  </ion-card>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-card>
      <ion-card-content>
        <p>Loading payslips...</p>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Payslips List -->
  <div *ngIf="!isLoading && filteredPayslips.length > 0">
    <ion-card *ngFor="let payslip of filteredPayslips" class="payslip-card">
      <ion-card-header>
        <div class="payslip-header">
          <div>
            <ion-card-title>{{getMonthName(payslip.month)}} {{payslip.year}}</ion-card-title>
            <p class="employee-info">{{payslip.employee_name}} ({{payslip.employee_code}})</p>
          </div>
          <ion-badge [color]="getStatusColor(payslip.status)">{{payslip.status}}</ion-badge>
        </div>
      </ion-card-header>
      
      <ion-card-content>
        <div class="salary-details">
          <div class="salary-row">
            <span class="label">Gross Salary:</span>
            <span class="value">₹{{payslip.gross_salary | number:'1.2-2'}}</span>
          </div>
          <div class="salary-row">
            <span class="label">Deductions:</span>
            <span class="value deduction">-₹{{payslip.total_deductions | number:'1.2-2'}}</span>
          </div>
          <div class="salary-row net">
            <span class="label"><strong>Net Salary:</strong></span>
            <span class="value"><strong>₹{{payslip.net_salary | number:'1.2-2'}}</strong></span>
          </div>
        </div>

        <div class="attendance-info">
          <div class="info-item">
            <ion-icon name="calendar-outline"></ion-icon>
            <span>Working Days: {{payslip.working_days}}</span>
          </div>
          <div class="info-item">
            <ion-icon name="calendar-outline"></ion-icon>
            <span>Present: {{payslip.present_days}}</span>
          </div>
          <div class="info-item">
            <ion-icon name="calendar-outline"></ion-icon>
            <span>Leaves: {{payslip.leave_days}}</span>
          </div>
        </div>

        <ion-button expand="block" (click)="downloadPayslip(payslip)" *ngIf="payslip.status === 'paid'">
          <ion-icon name="download-outline" slot="start"></ion-icon>
          Download Payslip
        </ion-button>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Empty State -->
  <ion-card *ngIf="!isLoading && filteredPayslips.length === 0">
    <ion-card-content class="empty-state">
      <ion-icon name="document-text-outline" size="large"></ion-icon>
      <h3>No Payslips Found</h3>
      <p>No payslips available for {{selectedYear}}</p>
    </ion-card-content>
  </ion-card>
</ion-content>
