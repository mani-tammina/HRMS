<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin"></ion-back-button>
    </ion-buttons>
    <ion-title>Projects</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="page-container">
    <!-- Search and Filter Bar -->
    <ion-card class="filter-card">
      <ion-card-content>
        <div class="filter-controls">
          <ion-searchbar
            [(ngModel)]="searchTerm"
            (ionInput)="onSearchChange($event)"
            placeholder="Search projects..."
            debounce="300">
          </ion-searchbar>
          
          <ion-select
            [(ngModel)]="filterStatus"
            (ionChange)="onFilterChange($event)"
            placeholder="Filter by Status"
            interface="popover">
            <ion-select-option value="all">All Projects</ion-select-option>
            <ion-select-option value="active">Active</ion-select-option>
            <ion-select-option value="completed">Completed</ion-select-option>
            <ion-select-option value="on_hold">On Hold</ion-select-option>
            <ion-select-option value="cancelled">Cancelled</ion-select-option>
          </ion-select>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Loading State -->
    @if (isLoading) {
      <app-loading message="Loading projects..." type="spinner"></app-loading>
    }

    <!-- Projects List -->
    @if (!isLoading) {
      @if (filteredProjects.length === 0) {
        <ion-card>
          <ion-card-content class="empty-state">
            <ion-icon name="briefcase-outline" size="large"></ion-icon>
            <h3>No Projects Found</h3>
            <p>{{searchTerm ? 'Try adjusting your search' : 'Click the + button to create a new project'}}</p>
          </ion-card-content>
        </ion-card>
      } @else {
        @for (project of filteredProjects; track project.id) {
          <ion-card (click)="viewProject(project.id)" class="project-card">
            <ion-card-header>
              <div class="project-header">
                <div class="project-info">
                  <ion-card-title>{{ project.project_name }}</ion-card-title>
                  <div class="project-meta">
                    <span class="project-code">{{ project.project_code }}</span>
                    <span class="separator">â€¢</span>
                    <span class="client-name">{{ project.client_name }}</span>
                  </div>
                </div>
                <ion-badge [color]="getStatusColor(project.status)">
                  <ion-icon [name]="getStatusIcon(project.status)"></ion-icon>
                  {{ getStatusLabel(project.status) }}
                </ion-badge>
              </div>
            </ion-card-header>

            <ion-card-content>
              @if (project.description) {
                <p class="project-description">{{ project.description }}</p>
              }

              <div class="project-stats">
                <div class="stat-item">
                  <ion-icon name="people-outline"></ion-icon>
                  <span>{{ project.total_employees || 0 }} employees</span>
                </div>
                <div class="stat-item">
                  <ion-icon name="time-outline"></ion-icon>
                  <span>{{ formatDate(project.start_date) }} - {{ formatDate(project.end_date) }}</span>
                </div>
              </div>

              @if (project.manager_name) {
                <div class="manager-info">
                  <ion-icon name="person-outline"></ion-icon>
                  <span>Manager: {{ project.manager_name }}</span>
                </div>
              }
            </ion-card-content>
          </ion-card>
        }
      }
    }

    <!-- Pull to Refresh -->
    <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
      <ion-refresher-content></ion-refresher-content>
    </ion-refresher>

    <!-- Floating Action Button -->
    <ion-fab slot="fixed" vertical="bottom" horizontal="end">
      <ion-fab-button (click)="addProject()">
        <ion-icon name="add-outline"></ion-icon>
      </ion-fab-button>
    </ion-fab>
  </div>
</ion-content>
