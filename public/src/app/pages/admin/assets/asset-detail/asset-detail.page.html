<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin/assets"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ asset ? asset.asset_name : 'New Asset' }}</ion-title>
    <ion-buttons slot="end">
      @if (assetId && asset) {
        <ion-button (click)="openEditModal()">
          <ion-icon slot="icon-only" name="create-outline"></ion-icon>
        </ion-button>
        <ion-button (click)="deleteAsset()" color="danger">
          <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
        </ion-button>
      }
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  @if (isLoading) {
    <div class="loading-container">
      <ion-card>
        <ion-card-content>
          <p>Loading asset details...</p>
        </ion-card-content>
      </ion-card>
    </div>
  }

  @if (!isLoading && asset) {
    <div class="page-container">
      <!-- Asset Overview Card -->
      <ion-card>
        <ion-card-header>
          <div class="header-content">
            <ion-card-title>{{ asset.asset_name }}</ion-card-title>
            <div class="badges">
              <ion-badge [color]="getStatusColor(asset.status)">
                {{ asset.status | titlecase }}
              </ion-badge>
              <ion-badge [color]="getConditionColor(asset.condition)">
                {{ asset.condition | titlecase }}
              </ion-badge>
            </div>
          </div>
        </ion-card-header>
        <ion-card-content>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="label">Asset Tag:</span>
              <span class="value">{{ asset.asset_tag }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Asset Type:</span>
              <span class="value">{{ asset.asset_type }}</span>
            </div>
            @if (asset.serial_number) {
              <div class="detail-item">
                <span class="label">Serial Number:</span>
                <span class="value">{{ asset.serial_number }}</span>
              </div>
            }
            @if (asset.manufacturer) {
              <div class="detail-item">
                <span class="label">Manufacturer:</span>
                <span class="value">{{ asset.manufacturer }}</span>
              </div>
            }
            @if (asset.model) {
              <div class="detail-item">
                <span class="label">Model:</span>
                <span class="value">{{ asset.model }}</span>
              </div>
            }
            @if (asset.location) {
              <div class="detail-item">
                <span class="label">Location:</span>
                <span class="value">{{ asset.location }}</span>
              </div>
            }
          </div>

          @if (asset.description) {
            <div class="description-section">
              <h3>Description</h3>
              <p>{{ asset.description }}</p>
            </div>
          }
        </ion-card-content>
      </ion-card>

      <!-- Purchase & Warranty Card -->
      @if (asset.purchase_date || asset.purchase_cost || asset.warranty_expiry) {
        <ion-card>
          <ion-card-header>
            <ion-card-title>Purchase & Warranty</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="detail-grid">
              @if (asset.purchase_date) {
                <div class="detail-item">
                  <span class="label">Purchase Date:</span>
                  <span class="value">{{ formatDate(asset.purchase_date) }}</span>
                </div>
              }
              @if (asset.purchase_cost) {
                <div class="detail-item">
                  <span class="label">Purchase Cost:</span>
                  <span class="value">â‚¹{{ asset.purchase_cost }}</span>
                </div>
              }
              @if (asset.warranty_expiry) {
                <div class="detail-item">
                  <span class="label">Warranty Expiry:</span>
                  <span class="value">{{ formatDate(asset.warranty_expiry) }}</span>
                </div>
              }
            </div>
          </ion-card-content>
        </ion-card>
      }
    </div>
  }

  <!-- Edit/Create Modal -->
  <ion-modal [isOpen]="showEditModal" (didDismiss)="closeEditModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ assetId ? 'Edit Asset' : 'New Asset' }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeEditModal()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content>
        <div class="modal-content">
          <ion-list>
            <ion-item>
              <ion-input 
                label="Asset Tag *" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.asset_tag"
                placeholder="e.g., LAP-001">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-input 
                label="Asset Name *" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.asset_name"
                placeholder="e.g., Dell Latitude 5420">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-select 
                label="Asset Type *" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.asset_type">
                <ion-select-option value="Laptop">Laptop</ion-select-option>
                <ion-select-option value="Desktop">Desktop</ion-select-option>
                <ion-select-option value="Monitor">Monitor</ion-select-option>
                <ion-select-option value="Mobile">Mobile</ion-select-option>
                <ion-select-option value="Keyboard">Keyboard</ion-select-option>
                <ion-select-option value="Mouse">Mouse</ion-select-option>
                <ion-select-option value="Other">Other</ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item>
              <ion-textarea 
                label="Description" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.description"
                rows="3"
                placeholder="Enter asset description">
              </ion-textarea>
            </ion-item>

            <ion-item>
              <ion-input 
                label="Serial Number" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.serial_number"
                placeholder="Enter serial number">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-input 
                label="Manufacturer" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.manufacturer"
                placeholder="e.g., Dell, HP, Lenovo">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-input 
                label="Model" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.model"
                placeholder="Enter model number">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-input 
                type="date"
                label="Purchase Date" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.purchase_date"
                [max]="maxDate">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-input 
                type="number"
                label="Purchase Cost" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.purchase_cost"
                placeholder="Enter amount">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-input 
                type="date"
                label="Warranty Expiry" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.warranty_expiry">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-input 
                label="Location" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.location"
                placeholder="e.g., Office, Warehouse">
              </ion-input>
            </ion-item>

            <ion-item>
              <ion-select 
                label="Status" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.status">
                <ion-select-option value="available">Available</ion-select-option>
                <ion-select-option value="allocated">Allocated</ion-select-option>
                <ion-select-option value="under_maintenance">Under Maintenance</ion-select-option>
                <ion-select-option value="retired">Retired</ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item>
              <ion-select 
                label="Condition" 
                labelPlacement="stacked"
                [(ngModel)]="assetForm.condition">
                <ion-select-option value="new">New</ion-select-option>
                <ion-select-option value="good">Good</ion-select-option>
                <ion-select-option value="fair">Fair</ion-select-option>
                <ion-select-option value="poor">Poor</ion-select-option>
                <ion-select-option value="damaged">Damaged</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-list>

          <div class="modal-actions">
            <ion-button expand="block" (click)="saveAsset()">
              <ion-icon slot="start" name="save-outline"></ion-icon>
              {{ assetId ? 'Update Asset' : 'Create Asset' }}
            </ion-button>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
