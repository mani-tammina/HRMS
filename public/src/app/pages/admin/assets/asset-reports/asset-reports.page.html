<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin/assets"></ion-back-button>
    </ion-buttons>
    <ion-title>Asset Reports</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="page-container">
    @if (isLoading) {
      <app-loading message="Loading reports..." type="spinner"></app-loading>
    }

    @if (!isLoading && report) {
      <!-- Summary Cards -->
      <ion-grid>
        <ion-row>
          <ion-col size="6" sizeMd="3">
            <app-stat-card
              title="Total Assets"
              [value]="report.total_assets"
              icon="cube-outline"
              iconColor="primary">
            </app-stat-card>
          </ion-col>
          <ion-col size="6" sizeMd="3">
            <app-stat-card
              title="Available"
              [value]="report.available_assets"
              icon="checkmark-circle-outline"
              iconColor="success">
            </app-stat-card>
          </ion-col>
          <ion-col size="6" sizeMd="3">
            <app-stat-card
              title="Allocated"
              [value]="report.allocated_assets"
              icon="trending-up-outline"
              iconColor="primary">
            </app-stat-card>
          </ion-col>
          <ion-col size="6" sizeMd="3">
            <app-stat-card
              title="Maintenance"
              [value]="report.maintenance_assets"
              icon="construct-outline"
              iconColor="warning">
            </app-stat-card>
          </ion-col>
        </ion-row>
      </ion-grid>

      <!-- Utilization Rate -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Asset Utilization Rate</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="utilization-display">
            <div class="progress-circle">
              <span class="percentage">{{ getUtilizationRate() }}%</span>
            </div>
            <p class="utilization-text">
              {{ report.allocated_assets }} of {{ report.total_assets }} assets currently in use
            </p>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Assets by Type -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Assets by Type</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="distribution-list">
            @for (item of report.by_type; track item.asset_type) {
              <div class="distribution-item">
                <div class="item-info">
                  <span class="item-label">{{ item.asset_type }}</span>
                  <span class="item-count">{{ item.count }}</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="(item.count / report.total_assets) * 100"></div>
                </div>
              </div>
            }
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Assets by Status -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Assets by Status</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="distribution-list">
            @for (item of report.by_status; track item.status) {
              <div class="distribution-item">
                <div class="item-info">
                  <span class="item-label">{{ item.status | titlecase }}</span>
                  <span class="item-count">{{ item.count }}</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" [style.width.%]="(item.count / report.total_assets) * 100"></div>
                </div>
              </div>
            }
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Recent Allocations -->
      @if (report.recent_allocations && report.recent_allocations.length > 0) {
        <ion-card>
          <ion-card-header>
            <ion-card-title>Recent Allocations</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="recent-list">
              @for (allocation of report.recent_allocations; track allocation.id) {
                <div class="recent-item">
                  <div class="recent-info">
                    <div class="asset-name">{{ allocation.asset_name }}</div>
                    <div class="employee-name">{{ allocation.employee_name }}</div>
                  </div>
                  <div class="recent-date">{{ formatDate(allocation.allocation_date) }}</div>
                </div>
              }
            </div>
          </ion-card-content>
        </ion-card>
      }

      <!-- Overdue Returns -->
      @if (report.overdue_returns && report.overdue_returns.length > 0) {
        <ion-card class="warning-card">
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="alert-circle-outline" color="danger"></ion-icon>
              Overdue Returns ({{ report.overdue_returns.length }})
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div class="recent-list">
              @for (allocation of report.overdue_returns; track allocation.id) {
                <div class="recent-item overdue">
                  <div class="recent-info">
                    <div class="asset-name">{{ allocation.asset_name }}</div>
                    <div class="employee-name">{{ allocation.employee_name }}</div>
                  </div>
                  <div class="recent-date">Due: {{ formatDate(allocation.expected_return_date!) }}</div>
                </div>
              }
            </div>
          </ion-card-content>
        </ion-card>
      }
    }

    <!-- Pull to Refresh -->
    <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
      <ion-refresher-content></ion-refresher-content>
    </ion-refresher>
  </div>
</ion-content>
