<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin"></ion-back-button>
    </ion-buttons>
    <ion-title>Assets Management</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="viewReports()">
        <ion-icon slot="icon-only" name="stats-chart-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="page-container">
    <!-- Action Cards -->
    <div class="action-cards">
      <ion-card class="action-card" (click)="addAsset()">
        <ion-card-content>
          <ion-icon name="add-outline" color="primary"></ion-icon>
          <span>Add Asset</span>
        </ion-card-content>
      </ion-card>
      
      <ion-card class="action-card" (click)="allocateAsset()">
        <ion-card-content>
          <ion-icon name="person-add-outline" color="success"></ion-icon>
          <span>Allocate Asset</span>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Search and Filter Bar -->
    <ion-card class="filter-card">
      <ion-card-content>
        <ion-searchbar
          [(ngModel)]="searchTerm"
          (ionInput)="onSearchChange($event)"
          placeholder="Search assets..."
          debounce="300">
        </ion-searchbar>
        
        <div class="filter-row">
          <ion-select
            [(ngModel)]="filterStatus"
            (ionChange)="onFilterChange()"
            placeholder="Status"
            interface="popover">
            <ion-select-option value="all">All Status</ion-select-option>
            <ion-select-option value="available">Available</ion-select-option>
            <ion-select-option value="allocated">Allocated</ion-select-option>
            <ion-select-option value="under_maintenance">Maintenance</ion-select-option>
            <ion-select-option value="retired">Retired</ion-select-option>
          </ion-select>
          
          <ion-select
            [(ngModel)]="filterType"
            (ionChange)="onFilterChange()"
            placeholder="Type"
            interface="popover">
            <ion-select-option value="all">All Types</ion-select-option>
            <ion-select-option value="Laptop">Laptop</ion-select-option>
            <ion-select-option value="Desktop">Desktop</ion-select-option>
            <ion-select-option value="Monitor">Monitor</ion-select-option>
            <ion-select-option value="Mobile">Mobile</ion-select-option>
            <ion-select-option value="Keyboard">Keyboard</ion-select-option>
            <ion-select-option value="Mouse">Mouse</ion-select-option>
            <ion-select-option value="Other">Other</ion-select-option>
          </ion-select>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Loading State -->
    @if (isLoading) {
      <app-loading message="Loading assets..." type="spinner"></app-loading>
    }

    <!-- Assets List -->
    @if (!isLoading) {
      @if (filteredAssets.length === 0) {
        <ion-card>
          <ion-card-content class="empty-state">
            <ion-icon name="cube-outline" size="large"></ion-icon>
            <h3>No Assets Found</h3>
            <p>{{searchTerm ? 'Try adjusting your search' : 'Click Add Asset to create a new asset'}}</p>
          </ion-card-content>
        </ion-card>
      } @else {
        @for (asset of filteredAssets; track asset.id) {
          <ion-card (click)="viewAsset(asset.id)" class="asset-card">
            <ion-card-header>
              <div class="asset-header">
                <div class="asset-info">
                  <ion-card-title>{{ asset.asset_name }}</ion-card-title>
                  <div class="asset-meta">
                    <span class="asset-tag">{{ asset.asset_tag }}</span>
                    <span class="separator">â€¢</span>
                    <span class="asset-type">{{ asset.asset_type }}</span>
                  </div>
                </div>
                <div class="badges">
                  <ion-badge [color]="getStatusColor(asset.status)">
                    {{ asset.status | titlecase }}
                  </ion-badge>
                  <ion-badge [color]="getConditionColor(asset.condition)">
                    {{ asset.condition | titlecase }}
                  </ion-badge>
                </div>
              </div>
            </ion-card-header>

            <ion-card-content>
              @if (asset.description) {
                <p class="asset-description">{{ asset.description }}</p>
              }

              <div class="asset-details">
                @if (asset.serial_number) {
                  <div class="detail-item">
                    <span class="label">Serial:</span>
                    <span class="value">{{ asset.serial_number }}</span>
                  </div>
                }
                @if (asset.purchase_date) {
                  <div class="detail-item">
                    <span class="label">Purchase:</span>
                    <span class="value">{{ formatDate(asset.purchase_date) }}</span>
                  </div>
                }
                @if (asset.warranty_expiry) {
                  <div class="detail-item">
                    <span class="label">Warranty:</span>
                    <span class="value">{{ formatDate(asset.warranty_expiry) }}</span>
                  </div>
                }
                @if (asset.location) {
                  <div class="detail-item">
                    <span class="label">Location:</span>
                    <span class="value">{{ asset.location }}</span>
                  </div>
                }
              </div>
            </ion-card-content>
          </ion-card>
        }
      }
    }

    <!-- Pull to Refresh -->
    <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
      <ion-refresher-content></ion-refresher-content>
    </ion-refresher>
  </div>
</ion-content>
