<ion-header>
  <ion-toolbar>
    <ion-title>Register</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="register-container">
    <!-- Logo/Header -->
    <div class="header-section">
      <h1>Create Your Account</h1>
      <p>Register using your Employee ID, Number, or Work Email</p>
    </div>

    <!-- Registration Form -->
    <ion-card>
      <ion-card-content>
        <!-- Step 1: Employee ID Verification -->
        <div class="form-section">
          <ion-item>
            <ion-icon name="person-outline" slot="start"></ion-icon>
            <ion-label position="floating">Employee ID / Number / Email</ion-label>
            <ion-input
              type="text"
              [(ngModel)]="employeeId"
              placeholder="Enter Employee ID, Number, or Work Email"
              [disabled]="isChecking || employeeFound"
            ></ion-input>
          </ion-item>

          <ion-button
            expand="block"
            (click)="checkEmployeeId()"
            [disabled]="isChecking || !employeeId || employeeFound"
            class="verify-button"
          >
            <ion-spinner *ngIf="isChecking" name="crescent"></ion-spinner>
            <span *ngIf="!isChecking">
              {{ employeeFound ? 'Verified âœ“' : 'Verify Employee' }}
            </span>
          </ion-button>
        </div>

        <!-- Employee Info Preview -->
        <div *ngIf="rolePreview && employeeFound" class="employee-info">
          <ion-card color="light">
            <ion-card-content>
              <div class="info-row">
                <ion-icon name="checkmark-circle" color="success"></ion-icon>
                <div class="info-details">
                  <strong>{{ rolePreview.employee.fullName }}</strong>
                  <p>{{ rolePreview.employee.employeeNumber }}</p>
                  <p>{{ rolePreview.employee.email }}</p>
                  <p>{{ rolePreview.employee.department }}</p>
                </div>
              </div>

              <div class="role-info">
                <ion-badge [color]="getRoleBadgeColor(rolePreview.suggestedRole)">
                  {{ rolePreview.suggestedRole.toUpperCase() }}
                </ion-badge>
                <ion-note>
                  <ion-icon name="information-circle" size="small"></ion-icon>
                  {{ rolePreview.roleAssignmentReason }}
                </ion-note>
              </div>

              <ion-note *ngIf="rolePreview.reportCount > 0" color="medium">
                Manages {{ rolePreview.reportCount }} direct report{{ rolePreview.reportCount !== 1 ? 's' : '' }}
              </ion-note>
            </ion-card-content>
          </ion-card>
        </div>

        <!-- Step 2: Password Setup (only if employee verified) -->
        <div *ngIf="employeeFound && !rolePreview?.userExists" class="form-section password-section">
          <ion-item>
            <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
            <ion-label position="floating">Password</ion-label>
            <ion-input
              type="password"
              [(ngModel)]="password"
              (ngModelChange)="checkPasswordStrength()"
              placeholder="Create a strong password"
            ></ion-input>
          </ion-item>

          <div *ngIf="password" class="password-strength">
            <ion-note>Password Strength: </ion-note>
            <ion-badge [color]="getPasswordStrengthColor()">
              {{ passwordStrength.toUpperCase() }}
            </ion-badge>
          </div>

          <ion-item>
            <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
            <ion-label position="floating">Confirm Password</ion-label>
            <ion-input
              type="password"
              [(ngModel)]="confirmPassword"
              placeholder="Re-enter your password"
            ></ion-input>
          </ion-item>

          <ion-note color="medium" class="password-hint">
            Password must be at least 8 characters with uppercase, lowercase, numbers, and special characters.
          </ion-note>

          <!-- Register Button -->
          <ion-button
            expand="block"
            color="primary"
            (click)="register()"
            [disabled]="isRegistering || !password || !confirmPassword"
            class="register-button"
          >
            <ion-spinner *ngIf="isRegistering" name="crescent"></ion-spinner>
            <span *ngIf="!isRegistering">Create Account</span>
          </ion-button>
        </div>

        <!-- Already has account message -->
        <div *ngIf="rolePreview?.userExists" class="existing-account">
          <ion-note color="warning">
            <ion-icon name="alert-circle"></ion-icon>
            Account already exists for this employee.
          </ion-note>
          <ion-button expand="block" fill="outline" (click)="goToLogin()">
            Go to Login
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Login Link -->
    <div class="login-link">
      <ion-text>
        Already have an account?
        <a (click)="goToLogin()">Login here</a>
      </ion-text>
    </div>
  </div>
</ion-content>
