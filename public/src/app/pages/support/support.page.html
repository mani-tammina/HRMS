<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Support Tickets</ion-title>
  </ion-toolbar>
  
  <ion-toolbar>
    <ion-searchbar [(ngModel)]="searchTerm" 
                   (ionInput)="onSearchChange($event)"
                   placeholder="Search tickets..."></ion-searchbar>
  </ion-toolbar>
  
  <ion-toolbar>
    <ion-segment [(ngModel)]="selectedStatus" (ionChange)="segmentChanged($event)">
      <ion-segment-button value="all">
        <ion-label>All</ion-label>
      </ion-segment-button>
      <ion-segment-button value="open">
        <ion-label>Open</ion-label>
      </ion-segment-button>
      <ion-segment-button value="in-progress">
        <ion-label>In Progress</ion-label>
      </ion-segment-button>
      <ion-segment-button value="resolved">
        <ion-label>Resolved</ion-label>
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Tickets List -->
  <div *ngIf="!isLoading && filteredTickets.length > 0">
    <ion-card *ngFor="let ticket of filteredTickets" (click)="viewTicket(ticket)" class="ticket-card">
      <ion-card-content>
        <div class="ticket-header">
          <div class="ticket-id">
            <ion-icon name="ticket-outline"></ion-icon>
            <span>#{{ticket.id}}</span>
          </div>
          <ion-badge [color]="getStatusColor(ticket.status)">
            <ion-icon [name]="getStatusIcon(ticket.status)"></ion-icon>
            {{ticket.status}}
          </ion-badge>
        </div>

        <h3 class="ticket-subject">{{ticket.subject}}</h3>
        <p class="ticket-description">{{ticket.description}}</p>

        <div class="ticket-meta">
          <ion-chip [color]="getCategoryColor(ticket.category)">
            <ion-label>{{ticket.category}}</ion-label>
          </ion-chip>
          <ion-chip [color]="getPriorityColor(ticket.priority)">
            <ion-label>{{ticket.priority}}</ion-label>
          </ion-chip>
        </div>

        <div class="ticket-footer">
          <span class="created-date">
            <ion-icon name="time-outline"></ion-icon>
            {{formatDate(ticket.created_at)}}
          </span>
          <span class="assigned-to" *ngIf="ticket.assigned_to_name">
            Assigned to: {{ticket.assigned_to_name}}
          </span>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Empty State -->
  <ion-card *ngIf="!isLoading && filteredTickets.length === 0">
    <ion-card-content class="empty-state">
      <ion-icon name="ticket-outline" size="large"></ion-icon>
      <h3>No Tickets Found</h3>
      <p *ngIf="selectedStatus === 'all'">You haven't created any support tickets yet</p>
      <p *ngIf="selectedStatus !== 'all'">No tickets with status: {{selectedStatus}}</p>
      <ion-button (click)="createTicket()">
        <ion-icon name="add-outline" slot="start"></ion-icon>
        Create Ticket
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- FAB Button -->
  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button (click)="createTicket()">
      <ion-icon name="add-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
