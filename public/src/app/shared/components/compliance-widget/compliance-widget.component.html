<ion-card *ngIf="!isLoading && complianceStatus" class="compliance-widget">
  <ion-card-header>
    <ion-card-title>
      <ion-icon [name]="getStatusIcon()" [color]="getStatusColor()"></ion-icon>
      Today's Timesheet
      <ion-badge [color]="getStatusColor()">{{ getStatusText() }}</ion-badge>
    </ion-card-title>
  </ion-card-header>

  <ion-card-content>
    <!-- Compliance Status -->
    <div class="status-section">
      <div class="status-item">
        <ion-icon name="time-outline"></ion-icon>
        <span>{{ complianceStatus.date | date: 'mediumDate' }}</span>
      </div>
      
      <div class="status-item">
        <span class="label">Type:</span>
        <ion-badge color="primary">{{ complianceStatus.timesheet_type }}</ion-badge>
      </div>

      @if (complianceStatus.is_submitted) {
        <div class="status-item success">
          <ion-icon name="checkmark-circle-outline" color="success"></ion-icon>
          <span>Submitted {{ complianceStatus.submission_details?.total_hours || 0 }} hours</span>
        </div>
      } @else {
        <div class="status-item warning">
          <ion-icon name="alert-circle-outline" color="warning"></ion-icon>
          <span>Not submitted yet</span>
        </div>
      }
    </div>

    <!-- Actions -->
    <div class="actions">
      @if (!complianceStatus.is_submitted) {
        <ion-button expand="block" (click)="submitTimesheet()" color="primary">
          <ion-icon name="time-outline" slot="start"></ion-icon>
          Submit Timesheet
        </ion-button>
      } @else {
        <ion-button expand="block" fill="outline" (click)="viewHistory()">
          <ion-icon name="refresh-outline" slot="start"></ion-icon>
          View History
        </ion-button>
      }
    </div>

    <!-- Monthly Stats -->
    @if (complianceStatus.this_month) {
      <div class="month-stats">
        <h4>This Month</h4>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-value">{{ complianceStatus.this_month.submitted_days }}</div>
            <div class="stat-label">Days</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ complianceStatus.this_month.total_hours }}</div>
            <div class="stat-label">Hours</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">{{ complianceStatus.this_month.avg_hours }}</div>
            <div class="stat-label">Avg/Day</div>
          </div>
        </div>
      </div>
    }

    <!-- Pending Client Uploads -->
    @if (complianceStatus.pending_client_uploads && complianceStatus.pending_client_uploads.length > 0) {
      <div class="pending-uploads">
        <h4>
          <ion-icon name="cloud-upload-outline" color="warning"></ion-icon>
          Pending Client Timesheet Uploads
        </h4>
        <ion-list>
          @for (upload of complianceStatus.pending_client_uploads; track upload.month) {
            <ion-item>
              <ion-label>
                <h3>{{ upload.year }}-{{ upload.month | number: '2.0-0' }}</h3>
                <p>{{ upload.days_count }} days â€¢ {{ upload.total_hours }} hours</p>
              </ion-label>
              <ion-button fill="outline" size="small" (click)="uploadClientTimesheet()">
                Upload
              </ion-button>
            </ion-item>
          }
        </ion-list>
      </div>
    }
  </ion-card-content>
</ion-card>

<!-- Loading State -->
<ion-card *ngIf="isLoading" class="compliance-widget loading">
  <ion-card-content>
    <div class="loading-spinner">
      <ion-icon name="refresh-outline"></ion-icon>
      <p>Loading compliance status...</p>
    </div>
  </ion-card-content>
</ion-card>
