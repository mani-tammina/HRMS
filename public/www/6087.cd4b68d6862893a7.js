"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6087],{6087:(U,_,c)=>{c.r(_),c.d(_,{TeamCompliancePage:()=>N});var m=c(467),g=c(177),h=c(4341),a=c(7820),f=c(2951),d=c(5873),C=c(6233),e=c(4438),p=c(1626),v=c(5312);let y=(()=>{class o{constructor(t){this.http=t,this.apiUrl=`${v.c.apiUrl}/compliance`}getMyComplianceStatus(){return this.http.get(`${this.apiUrl}/my-status`)}getMyComplianceHistory(t,n){let i=new p.Nl;return t&&(i=i.set("start_date",t)),n&&(i=i.set("end_date",n)),this.http.get(`${this.apiUrl}/my-history`,{params:i})}getManagerDashboard(){return this.http.get(`${this.apiUrl}/manager/dashboard`)}getManagerNonCompliantEmployees(t){let n=new p.Nl;return t&&(n=n.set("date",t)),this.http.get(`${this.apiUrl}/manager/non-compliant`,{params:n})}getManagerTeamReport(t,n){let i=new p.Nl;return t&&(i=i.set("month",t.toString())),n&&(i=i.set("year",n.toString())),this.http.get(`${this.apiUrl}/manager/team-report`,{params:i})}sendManagerReminders(t,n){return this.http.post(`${this.apiUrl}/manager/send-reminders`,{date:t,employee_ids:n})}getAdminDashboard(){return this.http.get(`${this.apiUrl}/admin/dashboard`)}getNonCompliantEmployees(t){let n=new p.Nl;return t&&(n=n.set("date",t)),this.http.get(`${this.apiUrl}/admin/non-compliant`,{params:n})}sendReminders(t,n){return this.http.post(`${this.apiUrl}/admin/send-reminders`,{date:t,employee_ids:n})}bulkApproveTimesheets(t,n){return this.http.post(`${this.apiUrl}/admin/bulk-approve`,{timesheet_ids:t,notes:n})}bulkValidateClientTimesheets(t){return this.http.post(`${this.apiUrl}/admin/bulk-validate-client-timesheets`,{validations:t})}closeMonth(t,n){return this.http.post(`${this.apiUrl}/admin/close-month`,{month:t,year:n})}reopenMonth(t,n,i){return this.http.post(`${this.apiUrl}/admin/reopen-month`,{month:t,year:n,reason:i})}getPeriodStatus(t,n){return this.http.get(`${this.apiUrl}/period-status/${t}/${n}`)}getMonthlyReport(t,n){let i=new p.Nl;return t&&(i=i.set("month",t.toString())),n&&(i=i.set("year",n.toString())),this.http.get(`${this.apiUrl}/admin/monthly-report`,{params:i})}static{this.\u0275fac=function(n){return new(n||o)(e.KVO(p.Qq))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var b=c(6119);function M(o,s){1&o&&e.nrm(0,"app-loading")}function P(o,s){if(1&o&&(e.j41(0,"ion-badge",30),e.EFF(1),e.k0s()),2&o){const t=e.XpG(3);e.R7$(),e.SpI(" ",t.nonCompliantEmployees.length," ")}}function x(o,s){if(1&o){const t=e.RV6();e.j41(0,"div",31)(1,"ion-button",32),e.bIt("click",function(){e.eBV(t);const i=e.XpG(3);return e.Njj(i.sendBulkReminders())}),e.nrm(2,"ion-icon",33),e.EFF(3),e.k0s()()}if(2&o){const t=e.XpG(3);e.R7$(3),e.SpI(" Send Reminders to All (",t.nonCompliantEmployees.length,") ")}}function T(o,s){if(1&o&&(e.j41(0,"span",40),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&o){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" Last: ",e.i5U(2,1,t.last_reminder_sent,"short")," ")}}function R(o,s){if(1&o&&(e.j41(0,"p",37)(1,"ion-badge",38),e.EFF(2),e.k0s(),e.DNE(3,T,3,4,"span",39),e.k0s()),2&o){const t=e.XpG().$implicit,n=e.XpG(4);e.R7$(),e.Y8G("color",n.getReminderBadgeColor(t.reminder_count)),e.R7$(),e.SpI(" ",t.reminder_count," reminder(s) sent "),e.R7$(),e.Y8G("ngIf",t.last_reminder_sent)}}function k(o,s){if(1&o){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-label")(2,"h3"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s(),e.DNE(6,R,4,3,"p",35),e.k0s(),e.j41(7,"ion-button",36),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(4);return e.Njj(r.sendReminder(i))}),e.nrm(8,"ion-icon",33),e.EFF(9," Remind "),e.k0s()()}if(2&o){const t=s.$implicit;e.R7$(3),e.JRh(t.name),e.R7$(2),e.Lme("",t.EmployeeNumber," \u2022 ",t.department,""),e.R7$(),e.Y8G("ngIf",t.reminder_count>0)}}function O(o,s){if(1&o&&(e.j41(0,"ion-list"),e.DNE(1,k,10,4,"ion-item",34),e.k0s()),2&o){const t=e.XpG(3);e.R7$(),e.Y8G("ngForOf",t.filteredEmployees)}}function E(o,s){1&o&&(e.j41(0,"p"),e.EFF(1,"All team members are compliant! \u{1f389}"),e.k0s())}function F(o,s){1&o&&(e.j41(0,"p"),e.EFF(1,"No matching employees found"),e.k0s())}function $(o,s){if(1&o&&(e.j41(0,"div",41),e.nrm(1,"ion-icon",42),e.DNE(2,E,2,0,"p",11)(3,F,2,0,"p",11),e.k0s()),2&o){const t=e.XpG(3);e.R7$(2),e.Y8G("ngIf",!t.searchTerm),e.R7$(),e.Y8G("ngIf",t.searchTerm)}}function S(o,s){if(1&o){const t=e.RV6();e.j41(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e.nrm(4,"ion-icon",14),e.EFF(5),e.nI1(6,"date"),e.k0s()(),e.j41(7,"ion-card-content")(8,"ion-grid")(9,"ion-row")(10,"ion-col",15)(11,"div",16)(12,"div",17),e.EFF(13),e.k0s(),e.j41(14,"div",18),e.EFF(15,"Total Team"),e.k0s()()(),e.j41(16,"ion-col",15)(17,"div",16)(18,"div",19),e.EFF(19),e.k0s(),e.j41(20,"div",18),e.nrm(21,"ion-icon",20),e.EFF(22," Pending "),e.k0s()()()()(),e.j41(23,"div",21)(24,"ion-button",22),e.nrm(25,"ion-icon",23),e.j41(26,"input",24),e.bIt("change",function(i){e.eBV(t);const r=e.XpG(2);return e.Njj(r.onDateChange(i))}),e.k0s()()()()(),e.j41(27,"ion-card")(28,"ion-card-header")(29,"ion-card-title"),e.nrm(30,"ion-icon",25),e.EFF(31," Non-Compliant Team Members "),e.DNE(32,P,2,1,"ion-badge",26),e.k0s()(),e.j41(33,"ion-card-content")(34,"ion-searchbar",27),e.mxI("ngModelChange",function(i){e.eBV(t);const r=e.XpG(2);return e.DH7(r.searchTerm,i)||(r.searchTerm=i),e.Njj(i)}),e.k0s(),e.DNE(35,x,4,1,"div",28)(36,O,2,1,"ion-list",11)(37,$,4,2,"div",29),e.k0s()()()}if(2&o){const t=e.XpG(2);e.R7$(5),e.SpI(" Team Compliance - ",e.i5U(6,9,t.selectedDate,"mediumDate")," "),e.R7$(8),e.JRh(t.todayStats.total),e.R7$(6),e.JRh(t.todayStats.pending),e.R7$(7),e.Y8G("value",t.selectedDate),e.R7$(6),e.Y8G("ngIf",t.nonCompliantEmployees.length>0),e.R7$(2),e.R50("ngModel",t.searchTerm),e.R7$(),e.Y8G("ngIf",t.nonCompliantEmployees.length>0),e.R7$(),e.Y8G("ngIf",t.filteredEmployees.length>0),e.R7$(),e.Y8G("ngIf",0===t.filteredEmployees.length)}}function j(o,s){if(1&o&&(e.j41(0,"ion-item")(1,"ion-label")(2,"h3"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s()(),e.j41(6,"ion-badge",45),e.EFF(7),e.k0s()()),2&o){const t=s.$implicit;e.R7$(3),e.JRh(t.name),e.R7$(2),e.JRh(t.department),e.R7$(2),e.SpI(" ",t.reminder_count||0," reminders ")}}function I(o,s){if(1&o&&(e.j41(0,"ion-list"),e.DNE(1,j,8,3,"ion-item",34),e.k0s()),2&o){const t=e.XpG(3);e.R7$(),e.Y8G("ngForOf",t.nonCompliantEmployees.slice(0,5))}}function D(o,s){if(1&o&&(e.j41(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e.nrm(4,"ion-icon",43),e.EFF(5),e.k0s()(),e.j41(6,"ion-card-content")(7,"div",44),e.nrm(8,"ion-icon",14),e.j41(9,"p"),e.EFF(10,"Detailed historical compliance data coming soon"),e.k0s()(),e.DNE(11,I,2,1,"ion-list",11),e.k0s()()()),2&o){const t=e.XpG(2);e.R7$(5),e.SpI(" ","week"===t.selectedSegment?"This Week":"This Month"," Summary "),e.R7$(6),e.Y8G("ngIf",t.nonCompliantEmployees.length>0)}}function G(o,s){if(1&o&&(e.j41(0,"div",13),e.DNE(1,S,38,12,"div",11)(2,D,12,2,"div",11),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngIf","today"===t.selectedSegment),e.R7$(),e.Y8G("ngIf","today"!==t.selectedSegment)}}let N=(()=>{class o{constructor(t,n,i,r){this.complianceService=t,this.errorHandler=n,this.alertController=i,this.toastController=r,this.isLoading=!0,this.selectedDate=(new Date).toISOString().split("T")[0],this.selectedSegment="today",this.dashboard=null,this.nonCompliantEmployees=[],this.todayStats={total:0,submitted:0,pending:0,compliance_rate:0},this.weeklyTrends=[],this.teamReport=null,this.teamHistory=[],this.searchTerm="",(0,f.d)({statsChartOutline:d.IEp,peopleOutline:d.wx_,checkmarkCircleOutline:d.gz2,alertCircleOutline:d.ndb,sendOutline:d.NF$,refreshOutline:d.mVv,calendarOutline:d.RXF,timeOutline:d.CVk})}ngOnInit(){this.loadData()}loadData(){"today"===this.selectedSegment||"week"===this.selectedSegment?this.loadManagerDashboard():this.loadTeamMonthlyReport()}loadManagerDashboard(){var n,t=this;this.isLoading=!0,this.complianceService.getManagerDashboard().subscribe({next:n=>{n.success&&(this.dashboard=n.dashboard,this.todayStats={total:this.dashboard?.today?.total_employees||0,submitted:this.dashboard?.today?.submitted_count||0,pending:this.dashboard?.today?.non_compliant_count||0,compliance_rate:this.dashboard?.today?.compliance_rate||0},this.nonCompliantEmployees=this.dashboard?.today?.non_compliant_employees||[],this.weeklyTrends=this.dashboard?.weekly_trends||[]),this.isLoading=!1},error:(n=(0,m.A)(function*(i){yield t.errorHandler.handleError(i,"Failed to load team compliance dashboard"),t.isLoading=!1}),function(r){return n.apply(this,arguments)})})}loadTodayCompliance(){var n,t=this;this.isLoading=!0,this.complianceService.getManagerNonCompliantEmployees(this.selectedDate).subscribe({next:n=>{this.nonCompliantEmployees=n.employees||[],this.todayStats={total:n.non_compliant_count,submitted:0,pending:n.non_compliant_count,compliance_rate:0},this.isLoading=!1},error:(n=(0,m.A)(function*(i){yield t.errorHandler.handleError(i,"Failed to load team compliance"),t.isLoading=!1}),function(r){return n.apply(this,arguments)})})}loadTeamMonthlyReport(){var t=this;this.isLoading=!0;const n=new Date,i=n.getMonth()+1,r=n.getFullYear();var l;this.complianceService.getManagerTeamReport(i,r).subscribe({next:l=>{l.success&&(this.teamReport=l,this.teamHistory=l.team_compliance||[],this.weeklyTrends=l.daily_trend||[]),this.isLoading=!1},error:(l=(0,m.A)(function*(u){yield t.errorHandler.handleError(u,"Failed to load team report"),t.isLoading=!1}),function(w){return l.apply(this,arguments)})})}loadTeamHistory(){this.loadTeamMonthlyReport()}handleRefresh(t){this.loadData(),setTimeout(()=>t.target.complete(),1e3)}onSegmentChange(){this.loadData()}onDateChange(t){this.selectedDate=t.detail.value,"today"===this.selectedSegment&&this.loadTodayCompliance()}sendReminder(t){var n=this;return(0,m.A)(function*(){yield(yield n.alertController.create({header:"Send Reminder",message:`Send timesheet reminder to ${t.name}?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Send",handler:()=>n.confirmSendReminder(t)}]})).present()})()}confirmSendReminder(t){var n=this;return(0,m.A)(function*(){try{yield n.complianceService.sendManagerReminders(n.selectedDate,[t.id]).toPromise(),yield(yield n.toastController.create({message:`Reminder sent to ${t.name||t.employee_name}`,duration:2e3,color:"success"})).present(),n.loadManagerDashboard()}catch(i){yield n.errorHandler.handleError(i,"Failed to send reminder")}})()}sendBulkReminders(){var t=this;return(0,m.A)(function*(){0!==t.nonCompliantEmployees.length&&(yield(yield t.alertController.create({header:"Send Bulk Reminders",message:`Send reminders to all ${t.nonCompliantEmployees.length} non-compliant team members?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Send All",handler:()=>t.confirmBulkReminders()}]})).present())})()}confirmBulkReminders(){var t=this;return(0,m.A)(function*(){try{const n=t.nonCompliantEmployees.map(l=>l.id),i=yield t.complianceService.sendManagerReminders(t.selectedDate,n).toPromise();yield(yield t.toastController.create({message:i.message||"Reminders sent successfully",duration:3e3,color:"success"})).present(),t.loadManagerDashboard()}catch(n){yield t.errorHandler.handleError(n,"Failed to send reminders")}})()}get filteredEmployees(){if(!this.searchTerm)return this.nonCompliantEmployees;const t=this.searchTerm.toLowerCase();return this.nonCompliantEmployees.filter(n=>n.name?.toLowerCase().includes(t)||n.EmployeeNumber?.toLowerCase().includes(t)||n.department?.toLowerCase().includes(t))}getComplianceRateColor(t){return t>=95?"success":t>=80?"warning":"danger"}getReminderBadgeColor(t){return 0===t?"medium":t<=2?"warning":"danger"}static{this.\u0275fac=function(n){return new(n||o)(e.rXU(y),e.rXU(b.c),e.rXU(a.hG),e.rXU(a.K_))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-team-compliance"]],standalone:!0,features:[e.aNF],decls:23,vars:5,consts:[[3,"translucent"],["color","primary"],["slot","end"],[3,"click"],["name","refresh-outline","slot","icon-only"],[3,"ngModelChange","ionChange","ngModel"],["value","today"],["value","week"],["value","month"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],["class","content-container",4,"ngIf"],[1,"content-container"],["name","stats-chart-outline"],["size","6"],[1,"stat-box"],[1,"stat-value"],[1,"stat-label"],[1,"stat-value","danger"],["name","alert-circle-outline","color","danger"],[1,"date-picker"],["fill","outline","size","small"],["name","calendar-outline","slot","start"],["type","date",1,"date-input",3,"change","value"],["name","people-outline"],["color","danger",4,"ngIf"],["placeholder","Search by name, emp number, or department","debounce","300",3,"ngModelChange","ngModel"],["class","bulk-actions",4,"ngIf"],["class","empty-state",4,"ngIf"],["color","danger"],[1,"bulk-actions"],["expand","block",3,"click"],["name","send-outline","slot","start"],[4,"ngFor","ngForOf"],["class","reminder-info",4,"ngIf"],["slot","end","fill","outline","size","small",3,"click"],[1,"reminder-info"],[3,"color"],["class","last-reminder",4,"ngIf"],[1,"last-reminder"],[1,"empty-state"],["name","checkmark-circle-outline","color","success"],["name","time-outline"],[1,"info-message"],["slot","end","color","warning"]],template:function(n,i){1&n&&(e.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),e.EFF(3,"Team Compliance"),e.k0s(),e.j41(4,"ion-buttons",2)(5,"ion-button",3),e.bIt("click",function(){return i.loadData()}),e.nrm(6,"ion-icon",4),e.k0s()()(),e.j41(7,"ion-toolbar")(8,"ion-segment",5),e.mxI("ngModelChange",function(l){return e.DH7(i.selectedSegment,l)||(i.selectedSegment=l),l}),e.bIt("ionChange",function(){return i.onSegmentChange()}),e.j41(9,"ion-segment-button",6)(10,"ion-label"),e.EFF(11,"Today"),e.k0s()(),e.j41(12,"ion-segment-button",7)(13,"ion-label"),e.EFF(14,"This Week"),e.k0s()(),e.j41(15,"ion-segment-button",8)(16,"ion-label"),e.EFF(17,"This Month"),e.k0s()()()()(),e.j41(18,"ion-content",9)(19,"ion-refresher",10),e.bIt("ionRefresh",function(l){return i.handleRefresh(l)}),e.nrm(20,"ion-refresher-content"),e.k0s(),e.DNE(21,M,1,0,"app-loading",11)(22,G,3,2,"div",12),e.k0s()),2&n&&(e.Y8G("translucent",!0),e.R7$(8),e.R50("ngModel",i.selectedSegment),e.R7$(10),e.Y8G("fullscreen",!0),e.R7$(3),e.Y8G("ngIf",i.isLoading),e.R7$(),e.Y8G("ngIf",!i.isLoading))},dependencies:[g.MD,g.Sq,g.bT,g.vh,h.YN,h.BC,h.vS,a.W9,a.eU,a.BC,a.ai,a.QW,a.b_,a.I9,a.ME,a.tN,a.lO,a.ln,a.hU,a.nf,a.uz,a.he,a.In,a.Jm,a.iq,a.To,a.Ki,a.Gp,a.eP,a.S1,C.q],styles:["ion-content[_ngcontent-%COMP%]{--background: var(--ion-color-light)}.content-container[_ngcontent-%COMP%]{padding:16px}.stat-box[_ngcontent-%COMP%]{text-align:center;padding:16px;border-radius:8px;background:var(--ion-color-light-tint)}.stat-box[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:32px;font-weight:700;margin-bottom:4px}.stat-box[_ngcontent-%COMP%]   .stat-value.success[_ngcontent-%COMP%]{color:var(--ion-color-success)}.stat-box[_ngcontent-%COMP%]   .stat-value.warning[_ngcontent-%COMP%]{color:var(--ion-color-warning)}.stat-box[_ngcontent-%COMP%]   .stat-value.danger[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.stat-box[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium);display:flex;align-items:center;justify-content:center;gap:4px}.stat-box[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.date-picker[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:center}.date-picker[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{position:relative}.date-picker[_ngcontent-%COMP%]   .date-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.bulk-actions[_ngcontent-%COMP%]{padding:12px 0}.reminder-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:4px;font-size:12px}.reminder-info[_ngcontent-%COMP%]   .last-reminder[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px 24px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;opacity:.5}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--ion-color-medium);margin-top:16px}.info-message[_ngcontent-%COMP%]{text-align:center;padding:32px 16px}.info-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:var(--ion-color-medium);opacity:.5}.info-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:12px;color:var(--ion-color-medium)}ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:18px}ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px}ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:8px}ion-item[_ngcontent-%COMP%]{--padding-start: 16px;--inner-padding-end: 16px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600;margin-bottom:4px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;color:var(--ion-color-medium)}@media (max-width: 768px){.stat-box[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:24px}.stat-box[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:11px}}ion-toolbar[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:4px}"]})}}return o})()}}]);