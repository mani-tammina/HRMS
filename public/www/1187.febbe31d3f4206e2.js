"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1187],{1187:(w,g,r)=>{r.r(g),r.d(g,{AssetAllocationPage:()=>T});var _=r(467),p=r(177),c=r(4341),a=r(7820),F=r(2951),m=r(5873),e=r(4438),A=r(5493),f=r(6437),C=r(3799),v=r(6119);const u=(n,s)=>s.id;function E(n,s){if(1&n&&(e.j41(0,"ion-select-option",10),e.EFF(1),e.k0s()),2&n){const t=s.$implicit;e.Y8G("value",t.id),e.R7$(),e.Lme(" ",t.asset_name," (",t.asset_tag,") ")}}function h(n,s){if(1&n&&(e.j41(0,"ion-select-option",10),e.EFF(1),e.k0s()),2&n){const t=s.$implicit;e.Y8G("value",t.id),e.R7$(),e.Lme(" ",t.name," (",t.email,") ")}}function P(n,s){if(1&n){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3,"Allocate Asset to Employee"),e.k0s()(),e.j41(4,"ion-card-content")(5,"form",7)(6,"ion-item")(7,"ion-label",8),e.EFF(8,"Asset *"),e.k0s(),e.j41(9,"ion-select",9),e.Z7z(10,E,2,3,"ion-select-option",10,u),e.k0s()(),e.j41(12,"ion-item")(13,"ion-label",8),e.EFF(14,"Employee *"),e.k0s(),e.j41(15,"ion-select",11),e.Z7z(16,h,2,3,"ion-select-option",10,u),e.k0s()(),e.j41(18,"ion-item")(19,"ion-label",8),e.EFF(20,"Allocation Date *"),e.k0s(),e.nrm(21,"ion-input",12),e.k0s(),e.j41(22,"ion-item")(23,"ion-label",8),e.EFF(24,"Expected Return Date"),e.k0s(),e.nrm(25,"ion-input",13),e.k0s(),e.j41(26,"ion-item")(27,"ion-label",8),e.EFF(28,"Notes"),e.k0s(),e.nrm(29,"ion-textarea",14),e.k0s(),e.j41(30,"div",15)(31,"ion-button",16),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.allocateAsset())}),e.nrm(32,"ion-icon",17),e.EFF(33," Allocate Asset "),e.k0s()()()()()}if(2&n){const t=e.XpG();e.R7$(5),e.Y8G("formGroup",t.allocationForm),e.R7$(5),e.Dyx(t.availableAssets),e.R7$(6),e.Dyx(t.employees),e.R7$(15),e.Y8G("disabled",t.allocationForm.invalid)}}function M(n,s){1&n&&(e.j41(0,"ion-card")(1,"ion-card-content",18),e.nrm(2,"ion-icon",19),e.j41(3,"h3"),e.EFF(4,"No Active Allocations"),e.k0s(),e.j41(5,"p"),e.EFF(6,"All assets are currently available"),e.k0s()()())}function b(n,s){if(1&n&&(e.j41(0,"div",24)(1,"span",25),e.EFF(2,"Expected Return:"),e.k0s(),e.j41(3,"span",26),e.EFF(4),e.k0s()()),2&n){const t=e.XpG().$implicit,o=e.XpG(3);e.R7$(4),e.JRh(o.formatDate(t.expected_return_date))}}function k(n,s){if(1&n&&(e.j41(0,"div",24)(1,"span",25),e.EFF(2,"Notes:"),e.k0s(),e.j41(3,"span",26),e.EFF(4),e.k0s()()),2&n){const t=e.XpG().$implicit;e.R7$(4),e.JRh(t.allocation_notes)}}function O(n,s){if(1&n){const t=e.RV6();e.j41(0,"ion-card",20)(1,"ion-card-header")(2,"div",21)(3,"ion-card-title"),e.EFF(4),e.k0s(),e.j41(5,"ion-badge",22),e.EFF(6),e.nI1(7,"titlecase"),e.k0s()()(),e.j41(8,"ion-card-content")(9,"div",23)(10,"div",24)(11,"span",25),e.EFF(12,"Employee:"),e.k0s(),e.j41(13,"span",26),e.EFF(14),e.k0s()(),e.j41(15,"div",24)(16,"span",25),e.EFF(17,"Asset Tag:"),e.k0s(),e.j41(18,"span",26),e.EFF(19),e.k0s()(),e.j41(20,"div",24)(21,"span",25),e.EFF(22,"Allocated:"),e.k0s(),e.j41(23,"span",26),e.EFF(24),e.k0s()(),e.DNE(25,b,5,1,"div",24)(26,k,5,1,"div",24),e.k0s(),e.j41(27,"ion-button",27),e.bIt("click",function(){const i=e.eBV(t).$implicit,l=e.XpG(3);return e.Njj(l.selectAllocationForReturn(i))}),e.nrm(28,"ion-icon",28),e.EFF(29," Process Return "),e.k0s()()()}if(2&n){const t=s.$implicit,o=e.XpG(3);e.R7$(4),e.JRh(t.asset_name),e.R7$(),e.Y8G("color",o.getStatusColor(t.allocation_status)),e.R7$(),e.SpI(" ",e.bMT(7,9,t.allocation_status)," "),e.R7$(8),e.Lme("",t.employee_name," (",t.employee_code,")"),e.R7$(5),e.JRh(t.asset_tag),e.R7$(5),e.JRh(o.formatDate(t.allocation_date)),e.R7$(),e.vxM(t.expected_return_date?25:-1),e.R7$(),e.vxM(t.allocation_notes?26:-1)}}function y(n,s){if(1&n&&e.Z7z(0,O,30,11,"ion-card",20,u),2&n){const t=e.XpG(2);e.Dyx(t.activeAllocations)}}function j(n,s){if(1&n&&e.DNE(0,M,7,0,"ion-card")(1,y,2,0),2&n){const t=e.XpG();e.vxM(0===t.activeAllocations.length?0:1)}}function R(n,s){1&n&&(e.j41(0,"ion-card")(1,"ion-card-content",18),e.nrm(2,"ion-icon",29),e.j41(3,"h3"),e.EFF(4,"Select an Asset to Return"),e.k0s(),e.j41(5,"p"),e.EFF(6,'Go to Active tab and click "Process Return" on any allocation'),e.k0s()()())}function x(n,s){if(1&n){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3,"Return Asset"),e.k0s()(),e.j41(4,"ion-card-content")(5,"div",30)(6,"div",31)(7,"span",25),e.EFF(8,"Asset:"),e.k0s(),e.j41(9,"span",26),e.EFF(10),e.k0s()(),e.j41(11,"div",31)(12,"span",25),e.EFF(13,"Employee:"),e.k0s(),e.j41(14,"span",26),e.EFF(15),e.k0s()(),e.j41(16,"div",31)(17,"span",25),e.EFF(18,"Allocated Since:"),e.k0s(),e.j41(19,"span",26),e.EFF(20),e.k0s()()(),e.j41(21,"form",7)(22,"ion-item")(23,"ion-label",8),e.EFF(24,"Return Condition *"),e.k0s(),e.j41(25,"ion-select",32)(26,"ion-select-option",33),e.EFF(27,"New"),e.k0s(),e.j41(28,"ion-select-option",34),e.EFF(29,"Good"),e.k0s(),e.j41(30,"ion-select-option",35),e.EFF(31,"Fair"),e.k0s(),e.j41(32,"ion-select-option",36),e.EFF(33,"Poor"),e.k0s(),e.j41(34,"ion-select-option",37),e.EFF(35,"Damaged"),e.k0s()()(),e.j41(36,"ion-item")(37,"ion-label",8),e.EFF(38,"Return Notes"),e.k0s(),e.nrm(39,"ion-textarea",38),e.k0s(),e.j41(40,"div",15)(41,"ion-button",16),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.returnAsset())}),e.nrm(42,"ion-icon",17),e.EFF(43," Confirm Return "),e.k0s()()()()()}if(2&n){const t=e.XpG(2);e.R7$(10),e.JRh(t.selectedAllocation.asset_name),e.R7$(5),e.JRh(t.selectedAllocation.employee_name),e.R7$(5),e.JRh(t.formatDate(t.selectedAllocation.allocation_date)),e.R7$(),e.Y8G("formGroup",t.returnForm),e.R7$(20),e.Y8G("disabled",t.returnForm.invalid)}}function D(n,s){if(1&n&&e.DNE(0,R,7,0,"ion-card")(1,x,44,5,"ion-card"),2&n){const t=e.XpG();e.vxM(t.selectedAllocation?1:0)}}let T=(()=>{class n{constructor(t,o,i,l,d,$){this.fb=t,this.assetsService=o,this.employeeService=i,this.router=l,this.errorHandler=d,this.loadingController=$,this.selectedView="allocate",this.availableAssets=[],this.employees=[],this.activeAllocations=[],this.selectedAllocation=null,this.isLoading=!1,(0,F.d)({saveOutline:m.oc8,arrowBackOutline:m.hGB,checkmarkDoneOutline:m.u8Q})}ngOnInit(){this.initForms(),this.loadData()}initForms(){this.allocationForm=this.fb.group({asset_id:["",c.k0.required],employee_id:["",c.k0.required],allocation_date:[(new Date).toISOString().split("T")[0],c.k0.required],expected_return_date:[""],allocation_notes:[""]}),this.returnForm=this.fb.group({return_condition:["good",c.k0.required],return_notes:[""]})}loadData(){this.loadAvailableAssets(),this.loadEmployees(),this.loadActiveAllocations()}loadAvailableAssets(){this.assetsService.getAssets("available").subscribe({next:t=>{this.availableAssets=t.assets},error:t=>console.error("Error loading assets:",t)})}loadEmployees(){this.employeeService.getEmployees().subscribe({next:t=>{this.employees=t.filter(o=>"Working"===o.EmploymentStatus)},error:t=>console.error("Error loading employees:",t)})}loadActiveAllocations(){this.assetsService.getAllocations("active").subscribe({next:t=>{this.activeAllocations=t.allocations},error:t=>console.error("Error loading allocations:",t)})}onViewChange(t){this.selectedView=t.detail.value,this.selectedAllocation=null,this.returnForm.reset({return_condition:"good"})}allocateAsset(){var t=this;return(0,_.A)(function*(){if(t.allocationForm.invalid)return void(yield t.errorHandler.handleWarning("Please fill all required fields"));const o=yield t.loadingController.create({message:"Allocating asset..."});var i;yield o.present(),t.assetsService.allocateAsset(t.allocationForm.value).subscribe({next:(i=(0,_.A)(function*(l){yield o.dismiss(),yield t.errorHandler.handleSuccess(l.message),t.allocationForm.reset({allocation_date:(new Date).toISOString().split("T")[0]}),t.loadData()}),function(d){return i.apply(this,arguments)}),error:function(){var i=(0,_.A)(function*(l){yield o.dismiss(),yield t.errorHandler.handleError(l,"Failed to allocate asset")});return function(d){return i.apply(this,arguments)}}()})})()}selectAllocationForReturn(t){this.selectedAllocation=t,this.selectedView="return"}returnAsset(){var t=this;return(0,_.A)(function*(){if(!t.selectedAllocation||t.returnForm.invalid)return void(yield t.errorHandler.handleWarning("Please select an asset and fill return details"));const o=yield t.loadingController.create({message:"Processing return..."});var i;yield o.present(),t.assetsService.returnAsset(t.selectedAllocation.id,t.returnForm.value).subscribe({next:(i=(0,_.A)(function*(l){yield o.dismiss(),yield t.errorHandler.handleSuccess(l.message),t.selectedAllocation=null,t.returnForm.reset({return_condition:"good"}),t.selectedView="active",t.loadData()}),function(d){return i.apply(this,arguments)}),error:function(){var i=(0,_.A)(function*(l){yield o.dismiss(),yield t.errorHandler.handleError(l,"Failed to return asset")});return function(d){return i.apply(this,arguments)}}()})})()}formatDate(t){return t?new Date(t).toLocaleDateString():"N/A"}getStatusColor(t){return"active"===t?"success":"medium"}static{this.\u0275fac=function(o){return new(o||n)(e.rXU(c.ok),e.rXU(A.T),e.rXU(f.O),e.rXU(C.Ix),e.rXU(v.c),e.rXU(a.Xi))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-asset-allocation"]],standalone:!0,features:[e.aNF],decls:21,vars:5,consts:[["slot","start"],["defaultHref","/admin/assets"],[1,"page-container"],[3,"ngModelChange","ionChange","ngModel"],["value","allocate"],["value","active"],["value","return"],[3,"formGroup"],["position","stacked"],["formControlName","asset_id","placeholder","Select Asset"],[3,"value"],["formControlName","employee_id","placeholder","Select Employee"],["type","date","formControlName","allocation_date"],["type","date","formControlName","expected_return_date"],["formControlName","allocation_notes","rows","3","placeholder","Any special notes..."],[1,"button-container"],["expand","block",3,"click","disabled"],["slot","start","name","checkmark-done-outline"],[1,"empty-state"],["name","cube-outline","size","large"],[1,"allocation-card"],[1,"allocation-header"],[3,"color"],[1,"allocation-details"],[1,"detail-row"],[1,"label"],[1,"value"],["expand","block","fill","outline",3,"click"],["slot","start","name","arrow-back-outline"],["name","arrow-back-outline","size","large"],[1,"return-info"],[1,"info-row"],["formControlName","return_condition"],["value","new"],["value","good"],["value","fair"],["value","poor"],["value","damaged"],["formControlName","return_notes","rows","4","placeholder","Condition details, any issues..."]],template:function(o,i){1&o&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-back-button",1),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Asset Allocation"),e.k0s()()(),e.j41(6,"ion-content")(7,"div",2)(8,"ion-segment",3),e.mxI("ngModelChange",function(d){return e.DH7(i.selectedView,d)||(i.selectedView=d),d}),e.bIt("ionChange",function(d){return i.onViewChange(d)}),e.j41(9,"ion-segment-button",4)(10,"ion-label"),e.EFF(11,"Allocate"),e.k0s()(),e.j41(12,"ion-segment-button",5)(13,"ion-label"),e.EFF(14),e.k0s()(),e.j41(15,"ion-segment-button",6)(16,"ion-label"),e.EFF(17,"Return"),e.k0s()()(),e.DNE(18,P,34,2,"ion-card")(19,j,2,1)(20,D,2,1),e.k0s()()),2&o&&(e.R7$(8),e.R50("ngModel",i.selectedView),e.R7$(6),e.SpI("Active (",i.activeAllocations.length,")"),e.R7$(4),e.vxM("allocate"===i.selectedView?18:-1),e.R7$(),e.vxM("active"===i.selectedView?19:-1),e.R7$(),e.vxM("return"===i.selectedView?20:-1))},dependencies:[p.MD,p.PV,c.X1,c.qT,c.BC,c.cb,c.j4,c.JD,c.YN,c.vS,a.W9,a.eU,a.BC,a.ai,a.QW,a.el,a.b_,a.I9,a.ME,a.tN,a.Jm,a.iq,a.uz,a.he,a.$w,a.nc,a.Nm,a.Ip,a.Gp,a.eP,a.In],styles:[".page-container[_ngcontent-%COMP%]{padding:1rem}ion-segment[_ngcontent-%COMP%]{margin-bottom:1rem}ion-item[_ngcontent-%COMP%]{margin-bottom:1rem}.button-container[_ngcontent-%COMP%]{margin-top:1.5rem}.allocation-card[_ngcontent-%COMP%]{margin-bottom:1rem}.allocation-card[_ngcontent-%COMP%]   .allocation-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.allocation-card[_ngcontent-%COMP%]   .allocation-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.125rem}.allocation-card[_ngcontent-%COMP%]   .allocation-details[_ngcontent-%COMP%]{margin-bottom:1rem}.allocation-card[_ngcontent-%COMP%]   .allocation-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.5rem 0;border-bottom:1px solid var(--border-color)}.allocation-card[_ngcontent-%COMP%]   .allocation-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.allocation-card[_ngcontent-%COMP%]   .allocation-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:500;color:var(--text-secondary)}.allocation-card[_ngcontent-%COMP%]   .allocation-details[_ngcontent-%COMP%]   .detail-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:var(--text-primary);text-align:right}.return-info[_ngcontent-%COMP%]{background:var(--ion-color-light);padding:1rem;border-radius:8px;margin-bottom:1.5rem}.return-info[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:.5rem 0}.return-info[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid var(--border-color)}.return-info[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-weight:600;color:var(--text-secondary)}.return-info[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:var(--text-primary)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:3rem 1rem}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:4rem;color:var(--ion-color-medium);margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:1rem 0 .5rem;color:var(--text-primary);font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--text-secondary);margin:0}"]})}}return n})()}}]);