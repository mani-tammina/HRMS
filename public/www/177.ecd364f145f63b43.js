"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[177],{6177:(P,p,a)=>{a.r(p),a.d(p,{UsersPage:()=>$});var c=a(467),g=a(4341),s=a(9907),u=a(177),h=a(2951),m=a(5873),e=a(4438),f=a(6354),_=a(5312),b=a(1626);let C=(()=>{class r{constructor(t){this.http=t,this.apiUrl=`${_.c.apiUrl}/auth`}getUsers(){return this.http.get(`${this.apiUrl}/users`).pipe((0,f.T)(t=>t.users||t))}getUser(t){return this.http.get(`${this.apiUrl}/users/${t}`)}updateUserRole(t,n){return this.http.put(`${this.apiUrl}/users/${t}/role`,{role:n})}makeHR(t){return this.http.post(`${this.apiUrl}/users/${t}/make-hr`,{})}makeManager(t){return this.http.post(`${this.apiUrl}/users/${t}/make-manager`,{})}makeAdmin(t){return this.http.post(`${this.apiUrl}/users/${t}/make-admin`,{})}makeEmployee(t){return this.http.post(`${this.apiUrl}/users/${t}/make-employee`,{})}bulkUpdateRoles(t){return this.http.post(`${this.apiUrl}/users/bulk-update-roles`,{updates:t})}static{this.\u0275fac=function(n){return new(n||r)(e.KVO(b.Qq))}}static{this.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var k=a(3799);function y(r,d){if(1&r&&(e.j41(0,"span",24),e.EFF(1),e.k0s()),2&r){const t=e.XpG().$implicit;e.R7$(),e.SpI(" #",t.EmployeeNumber," ")}}function U(r,d){if(1&r){const t=e.RV6();e.j41(0,"ion-item",17),e.nrm(1,"ion-icon",18),e.j41(2,"ion-label")(3,"h2"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s(),e.j41(7,"p",19)(8,"ion-badge",20),e.EFF(9),e.nI1(10,"uppercase"),e.k0s(),e.DNE(11,y,2,1,"span",21),e.k0s()(),e.j41(12,"div",22)(13,"ion-button",23),e.bIt("click",function(){const o=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.toggleRole(o,"admin"))}),e.EFF(14," Admin "),e.k0s(),e.j41(15,"ion-button",23),e.bIt("click",function(){const o=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.toggleRole(o,"hr"))}),e.EFF(16," HR "),e.k0s(),e.j41(17,"ion-button",23),e.bIt("click",function(){const o=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.toggleRole(o,"manager"))}),e.EFF(18," Manager "),e.k0s(),e.j41(19,"ion-button",23),e.bIt("click",function(){const o=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.toggleRole(o,"employee"))}),e.EFF(20," Employee "),e.k0s()()()}if(2&r){const t=d.$implicit,n=e.XpG(2);e.R7$(),e.Y8G("name",n.roleIcons[t.role]||"person-outline")("color",n.roleColors[t.role]),e.R7$(3),e.JRh(t.full_name||t.username),e.R7$(2),e.JRh(t.email||t.username),e.R7$(2),e.Y8G("color",n.roleColors[t.role]),e.R7$(),e.SpI(" ",e.bMT(10,19,t.role)," "),e.R7$(2),e.Y8G("ngIf",t.employee_id),e.R7$(2),e.Y8G("fill","admin"===t.role?"solid":"outline")("color","admin"===t.role?"danger":"medium")("disabled",n.isLoading),e.R7$(2),e.Y8G("fill","hr"===t.role?"solid":"outline")("color","hr"===t.role?"warning":"medium")("disabled",n.isLoading),e.R7$(2),e.Y8G("fill","manager"===t.role?"solid":"outline")("color","manager"===t.role?"primary":"medium")("disabled",n.isLoading),e.R7$(2),e.Y8G("fill","employee"===t.role?"solid":"outline")("color","employee"===t.role?"success":"medium")("disabled",n.isLoading)}}function R(r,d){if(1&r&&(e.j41(0,"ion-list"),e.DNE(1,U,21,21,"ion-item",16),e.k0s()),2&r){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.filteredUsers)}}function v(r,d){if(1&r&&(e.j41(0,"div",25),e.nrm(1,"ion-icon",26),e.j41(2,"h2"),e.EFF(3,"No Users Found"),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s()()),2&r){const t=e.XpG();e.R7$(5),e.JRh(t.searchTerm?"Try a different search term":"No users available")}}function M(r,d){1&r&&(e.j41(0,"div",27),e.nrm(1,"ion-spinner",28),e.j41(2,"p"),e.EFF(3,"Loading users..."),e.k0s()())}let $=(()=>{class r{constructor(t,n,o,i){this.userService=t,this.router=n,this.alertController=o,this.toastController=i,this.users=[],this.filteredUsers=[],this.searchTerm="",this.isLoading=!1,this.roleColors={admin:"danger",hr:"warning",manager:"primary",employee:"success"},this.roleIcons={admin:"shield-outline",hr:"briefcase-outline",manager:"people-outline",employee:"person-outline"},(0,h.d)({personOutline:m.wAZ,shieldOutline:m.uLY,briefcaseOutline:m.vOb,peopleOutline:m.wx_,checkmarkCircleOutline:m.gz2,refreshOutline:m.mVv})}ngOnInit(){this.loadUsers()}loadUsers(){this.isLoading=!0,this.userService.getUsers().subscribe({next:t=>{this.users=t,this.filteredUsers=t,this.isLoading=!1},error:t=>{console.error("Error loading users:",t),this.isLoading=!1,this.showToast("Error loading users","danger")}})}handleRefresh(t){this.loadUsers(),setTimeout(()=>t.target.complete(),1e3)}filterUsers(t){const n=t.target.value.toLowerCase();this.filteredUsers=n?this.users.filter(o=>o.username.toLowerCase().includes(n)||o.full_name?.toLowerCase().includes(n)||o.email?.toLowerCase().includes(n)||o.role.toLowerCase().includes(n)):this.users}toggleRole(t,n){var o=this;return(0,c.A)(function*(){t.role!==n?yield(yield o.alertController.create({header:"Confirm Role Change",message:`Change ${t.full_name||t.username} from ${t.role.toUpperCase()} to ${n.toUpperCase()}?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Confirm",handler:()=>{o.updateRole(t,n)}}]})).present():o.showToast(`User is already ${n}`,"warning")})()}changeUserRole(t){var n=this;return(0,c.A)(function*(){yield(yield n.alertController.create({header:"Change User Role",subHeader:`Current: ${t.role}`,message:`Select new role for ${t.username||t.full_name}`,inputs:[{name:"admin",type:"radio",label:"Admin",value:"admin",checked:"admin"===t.role},{name:"hr",type:"radio",label:"HR",value:"hr",checked:"hr"===t.role},{name:"manager",type:"radio",label:"Manager",value:"manager",checked:"manager"===t.role},{name:"employee",type:"radio",label:"Employee",value:"employee",checked:"employee"===t.role}],buttons:[{text:"Cancel",role:"cancel"},{text:"Update",handler:i=>{n.updateRole(t,i)}}]})).present()})()}updateRole(t,n){if(!n||n===t.role)return;let o;switch(n){case"admin":o=this.userService.makeAdmin(t.id);break;case"hr":o=this.userService.makeHR(t.id);break;case"manager":o=this.userService.makeManager(t.id);break;case"employee":o=this.userService.makeEmployee(t.id);break;default:o=this.userService.updateUserRole(t.id,n)}o.subscribe({next:()=>{this.showToast(`User role updated to ${n}`,"success"),this.loadUsers()},error:i=>{console.error("Error updating role:",i),this.showToast("Error updating user role","danger")}})}quickActionMakeHR(t){var n=this;return(0,c.A)(function*(){(yield n.confirmAction(t,"HR"))&&n.userService.makeHR(t.id).subscribe({next:()=>{n.showToast(`${t.username} is now HR`,"success"),n.loadUsers()},error:()=>n.showToast("Error updating role","danger")})})()}quickActionMakeManager(t){var n=this;return(0,c.A)(function*(){(yield n.confirmAction(t,"Manager"))&&n.userService.makeManager(t.id).subscribe({next:()=>{n.showToast(`${t.username} is now a Manager`,"success"),n.loadUsers()},error:()=>n.showToast("Error updating role","danger")})})()}quickActionMakeEmployee(t){var n=this;return(0,c.A)(function*(){(yield n.confirmAction(t,"Employee"))&&n.userService.makeEmployee(t.id).subscribe({next:()=>{n.showToast(`${t.username} is now an Employee`,"success"),n.loadUsers()},error:()=>n.showToast("Error updating role","danger")})})()}confirmAction(t,n){var o=this;return(0,c.A)(function*(){return new Promise(function(){var i=(0,c.A)(function*(l){yield(yield o.alertController.create({header:"Confirm Role Change",message:`Change ${t.username||t.full_name} from ${t.role} to ${n}?`,buttons:[{text:"Cancel",role:"cancel",handler:()=>l(!1)},{text:"Confirm",handler:()=>l(!0)}]})).present()});return function(l){return i.apply(this,arguments)}}())})()}showToast(t){var n=this;return(0,c.A)(function*(o,i="primary"){yield(yield n.toastController.create({message:o,duration:2e3,color:i,position:"top"})).present()}).apply(this,arguments)}getRoleStats(){return{total:this.users.length,admin:this.users.filter(t=>"admin"===t.role).length,hr:this.users.filter(t=>"hr"===t.role).length,manager:this.users.filter(t=>"manager"===t.role).length,employee:this.users.filter(t=>"employee"===t.role).length}}static{this.\u0275fac=function(n){return new(n||r)(e.rXU(C),e.rXU(k.Ix),e.rXU(s.hG),e.rXU(s.K_))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-users"]],standalone:!0,features:[e.aNF],decls:45,vars:9,consts:[["color","primary"],["slot","start"],["defaultHref","/admin/dashboard"],["slot","end"],[3,"click"],["slot","icon-only","name","refresh-outline"],["placeholder","Search users...","animated","",3,"ngModelChange","ionInput","ngModel"],["slot","fixed",3,"ionRefresh"],[1,"stats-grid"],[1,"stat-item"],["color","danger"],["color","warning"],["color","medium"],[4,"ngIf"],["class","empty-state",4,"ngIf"],["class","loading-state",4,"ngIf"],["lines","full",4,"ngFor","ngForOf"],["lines","full"],["slot","start",3,"name","color"],[1,"ion-text-wrap"],[3,"color"],["class","user-meta",4,"ngIf"],["slot","end",1,"role-buttons"],["size","small",3,"click","fill","color","disabled"],[1,"user-meta"],[1,"empty-state"],["name","people-outline","color","medium"],[1,"loading-state"],["name","crescent","color","primary"]],template:function(n,o){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"User Management"),e.k0s(),e.j41(6,"ion-buttons",3)(7,"ion-button",4),e.bIt("click",function(){return o.loadUsers()}),e.nrm(8,"ion-icon",5),e.k0s()()(),e.j41(9,"ion-toolbar")(10,"ion-searchbar",6),e.mxI("ngModelChange",function(l){return e.DH7(o.searchTerm,l)||(o.searchTerm=l),l}),e.bIt("ionInput",function(l){return o.filterUsers(l)}),e.k0s()()(),e.j41(11,"ion-content")(12,"ion-refresher",7),e.bIt("ionRefresh",function(l){return o.handleRefresh(l)}),e.nrm(13,"ion-refresher-content"),e.k0s(),e.j41(14,"ion-card")(15,"ion-card-content")(16,"div",8)(17,"div",9)(18,"ion-badge",0),e.EFF(19),e.k0s(),e.j41(20,"ion-label"),e.EFF(21,"Total Users"),e.k0s()(),e.j41(22,"div",9)(23,"ion-badge",10),e.EFF(24),e.k0s(),e.j41(25,"ion-label"),e.EFF(26,"Admins"),e.k0s()(),e.j41(27,"div",9)(28,"ion-badge",11),e.EFF(29),e.k0s(),e.j41(30,"ion-label"),e.EFF(31,"HR"),e.k0s()(),e.j41(32,"div",9)(33,"ion-badge",0),e.EFF(34),e.k0s(),e.j41(35,"ion-label"),e.EFF(36,"Managers"),e.k0s()(),e.j41(37,"div",9)(38,"ion-badge",12),e.EFF(39),e.k0s(),e.j41(40,"ion-label"),e.EFF(41,"Employees"),e.k0s()()()()(),e.DNE(42,R,2,1,"ion-list",13)(43,v,6,1,"div",14)(44,M,4,0,"div",15),e.k0s()),2&n&&(e.R7$(10),e.R50("ngModel",o.searchTerm),e.R7$(9),e.JRh(o.getRoleStats().total),e.R7$(5),e.JRh(o.getRoleStats().admin),e.R7$(5),e.JRh(o.getRoleStats().hr),e.R7$(5),e.JRh(o.getRoleStats().manager),e.R7$(5),e.JRh(o.getRoleStats().employee),e.R7$(3),e.Y8G("ngIf",!o.isLoading&&o.filteredUsers.length>0),e.R7$(),e.Y8G("ngIf",!o.isLoading&&0===o.filteredUsers.length),e.R7$(),e.Y8G("ngIf",o.isLoading))},dependencies:[u.MD,u.Sq,u.bT,u.Pc,g.YN,g.BC,g.vS,s.W9,s.eU,s.BC,s.ai,s.QW,s.el,s.S1,s.nf,s.uz,s.he,s.In,s.iq,s.To,s.Ki,s.b_,s.I9,s.Jm,s.w2],styles:[".stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:16px;text-align:center}.stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:18px;padding:8px 12px}.stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:11px;color:var(--ion-color-medium)}.user-meta[_ngcontent-%COMP%]{font-size:11px;color:var(--ion-color-medium);margin-left:8px}.role-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px;margin-right:8px}.role-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:0;--padding-start: 8px;--padding-end: 8px;font-size:11px;min-width:70px}.quick-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-top:12px}.quick-actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:0}.empty-state[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:80px;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 8px;font-size:20px;font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{transform:scale(1.5);margin-bottom:20px}"]})}}return r})()}}]);