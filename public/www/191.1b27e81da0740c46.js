"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[191],{2191:(F,h,l)=>{l.r(h),l.d(h,{AdminComplianceDashboardPage:()=>P});var _=l(467),i=l(7843),d=l(177),m=l(4341),g=l(2951),r=l(5873),t=l(4438),u=l(4086);function f(o,c){if(1&o&&(t.j41(0,"div",12)(1,"ion-card")(2,"ion-card-content")(3,"div",13),t.EFF(4),t.k0s(),t.j41(5,"div",14),t.EFF(6,"Projects"),t.k0s()()(),t.j41(7,"ion-card")(8,"ion-card-content")(9,"div",13),t.EFF(10),t.k0s(),t.j41(11,"div",14),t.EFF(12,"Employees"),t.k0s()()(),t.j41(13,"ion-card")(14,"ion-card-content")(15,"div",13),t.EFF(16),t.k0s(),t.j41(17,"div",14),t.EFF(18,"Compliant"),t.k0s()()(),t.j41(19,"ion-card")(20,"ion-card-content")(21,"div",13),t.EFF(22),t.k0s(),t.j41(23,"div",14),t.EFF(24,"Missing"),t.k0s()()()()),2&o){const e=t.XpG();t.R7$(4),t.JRh(e.statistics.total_projects),t.R7$(6),t.JRh(e.statistics.total_employees_tracked),t.R7$(6),t.JRh(e.statistics.total_compliant),t.R7$(6),t.JRh(e.statistics.total_missing)}}function D(o,c){if(1&o&&(t.j41(0,"ion-item")(1,"ion-label")(2,"h2"),t.EFF(3),t.k0s(),t.j41(4,"p"),t.EFF(5),t.k0s(),t.j41(6,"p"),t.EFF(7),t.k0s()(),t.j41(8,"ion-badge",15),t.EFF(9),t.k0s()()),2&o){const e=c.$implicit,n=t.XpG();t.R7$(3),t.JRh(e.project_name),t.R7$(2),t.JRh(e.client_name),t.R7$(2),t.Lme("Compliant: ",e.compliant_count,"/",e.total_employees,""),t.R7$(),t.Y8G("color",n.getStatusColor(e.traffic_light_status)),t.R7$(),t.SpI(" ",e.traffic_light_status," ")}}function C(o,c){1&o&&(t.j41(0,"div",16),t.nrm(1,"ion-icon",17),t.j41(2,"h3"),t.EFF(3,"No Data Available"),t.k0s(),t.j41(4,"p"),t.EFF(5,"Select a date to view compliance data"),t.k0s()())}function b(o,c){1&o&&(t.j41(0,"div",18),t.nrm(1,"ion-spinner"),t.k0s())}function E(o,c){if(1&o){const e=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t.EFF(3,"Select Date"),t.k0s(),t.j41(4,"ion-buttons",3)(5,"ion-button",4),t.bIt("click",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.showDatePicker=!1)}),t.EFF(6,"Close"),t.k0s()()()(),t.j41(7,"ion-content")(8,"ion-datetime",19),t.mxI("ngModelChange",function(a){t.eBV(e);const s=t.XpG();return t.DH7(s.selectedDate,a)||(s.selectedDate=a),t.Njj(a)}),t.bIt("ionChange",function(){t.eBV(e);const a=t.XpG();return t.Njj(a.loadDashboard())}),t.k0s()()}if(2&o){const e=t.XpG();t.R7$(8),t.R50("ngModel",e.selectedDate)}}let P=(()=>{class o{constructor(e,n,a,s){this.adminTimesheetService=e,this.toastController=n,this.alertController=a,this.loadingController=s,this.dashboardData=[],this.filteredData=[],this.statistics={total_projects:0,total_employees_tracked:0,total_compliant:0,total_update_only:0,total_missing:0},this.selectedDate=(new Date).toISOString(),this.selectedStatus="all",this.searchText="",this.showFilters=!1,this.showDatePicker=!1,this.viewMode="summary",this.isLoading=!1,this.loading=!1,(0,g.d)({checkmarkCircleOutline:r.gz2,alertCircleOutline:r.ndb,closeCircleOutline:r.p9N,eyeOutline:r.ov$,searchOutline:r.jBE,filterOutline:r.PyO,calendarOutline:r.RXF,statsChartOutline:r.IEp,peopleOutline:r.wx_,briefcaseOutline:r.vOb})}ngOnInit(){this.loadDashboard()}loadDashboard(){this.isLoading=!0,this.loading=!0;const e=new Date(this.selectedDate).toISOString().split("T")[0];this.adminTimesheetService.getDashboard(e,e).subscribe({next:n=>{this.dashboardData=n.dashboard,this.statistics=n.statistics,this.applyFilters(),this.isLoading=!1,this.loading=!1},error:n=>{console.error("Error loading dashboard:",n),this.showToast("Failed to load compliance dashboard","danger"),this.isLoading=!1,this.loading=!1}})}handleRefresh(e){this.loadDashboard(),setTimeout(()=>{e.target.complete()},1e3)}openDatePicker(){this.showDatePicker=!0}getStatusColor(e){switch(e){case"green":return"success";case"yellow":return"warning";case"red":return"danger";default:return"medium"}}applyFilters(){this.filteredData=this.dashboardData.filter(e=>{if("all"!==this.selectedStatus&&e.traffic_light_status!==this.selectedStatus)return!1;if(this.searchText){const n=this.searchText.toLowerCase();return e.project_name.toLowerCase().includes(n)||e.client_name.toLowerCase().includes(n)}return!0})}onDateChange(e){this.selectedDate=e.detail.value,this.loadDashboard()}onStatusChange(e){this.selectedStatus=e.detail.value,this.applyFilters()}onSearchChange(e){this.searchText=e.detail.value,this.applyFilters()}getTrafficLightColor(e){return{green:"success",yellow:"warning",red:"danger"}[e]||"medium"}getTrafficLightIcon(e){return{green:"checkmark-circle-outline",yellow:"alert-circle-outline",red:"close-circle-outline"}[e]||"help-circle-outline"}getCompliancePercentage(e){return 0===e.total_employees?0:Math.round(e.compliant_count/e.total_employees*100)}viewProjectDetails(e){console.log("View project details:",e)}viewNonCompliantEmployees(){var e=this;return(0,_.A)(function*(){const n=new Date(e.selectedDate).toISOString().split("T")[0],a=yield e.loadingController.create({message:"Loading non-compliant employees..."});yield a.present(),e.adminTimesheetService.getNonCompliantEmployees(n).subscribe({next:s=>{a.dismiss(),console.log("Non-compliant employees:",s.nonCompliantEmployees)},error:s=>{a.dismiss(),console.error("Error loading non-compliant employees:",s),e.showToast("Failed to load non-compliant employees","danger")}})})()}showToast(e){var n=this;return(0,_.A)(function*(a,s="primary"){yield(yield n.toastController.create({message:a,duration:3e3,position:"top",color:s})).present()}).apply(this,arguments)}getTotalCompliance(){const e=this.statistics.total_employees_tracked;return 0===e?0:Math.round(this.statistics.total_compliant/e*100)}toggleFilters(){this.showFilters=!this.showFilters}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(u.p),t.rXU(i.K_),t.rXU(i.hG),t.rXU(i.Xi))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-admin-compliance-dashboard"]],standalone:!0,features:[t.aNF],decls:19,vars:5,consts:[["color","primary"],["slot","start"],["defaultHref","/tabs/home"],["slot","end"],[3,"click"],["slot","icon-only","name","calendar-outline"],["slot","fixed",3,"ionRefresh"],["class","stats-container",4,"ngIf"],[4,"ngFor","ngForOf"],["class","empty-state",4,"ngIf"],["class","loading-container",4,"ngIf"],[3,"didDismiss","isOpen"],[1,"stats-container"],[1,"stat-value"],[1,"stat-label"],["slot","end",3,"color"],[1,"empty-state"],["name","stats-chart-outline","size","large"],[1,"loading-container"],[3,"ngModelChange","ionChange","ngModel"]],template:function(n,a){1&n&&(t.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),t.nrm(3,"ion-back-button",2),t.k0s(),t.j41(4,"ion-title"),t.EFF(5,"Compliance Dashboard"),t.k0s(),t.j41(6,"ion-buttons",3)(7,"ion-button",4),t.bIt("click",function(){return a.openDatePicker()}),t.nrm(8,"ion-icon",5),t.k0s()()()(),t.j41(9,"ion-content")(10,"ion-refresher",6),t.bIt("ionRefresh",function(p){return a.handleRefresh(p)}),t.nrm(11,"ion-refresher-content"),t.k0s(),t.DNE(12,f,25,4,"div",7),t.j41(13,"ion-list"),t.DNE(14,D,10,6,"ion-item",8),t.k0s(),t.DNE(15,C,6,0,"div",9)(16,b,2,0,"div",10),t.k0s(),t.j41(17,"ion-modal",11),t.bIt("didDismiss",function(){return a.showDatePicker=!1}),t.DNE(18,E,9,1,"ng-template"),t.k0s()),2&n&&(t.R7$(12),t.Y8G("ngIf",a.statistics),t.R7$(2),t.Y8G("ngForOf",a.dashboardData),t.R7$(),t.Y8G("ngIf",!a.loading&&0===a.dashboardData.length),t.R7$(),t.Y8G("ngIf",a.loading),t.R7$(),t.Y8G("isOpen",a.showDatePicker))},dependencies:[d.MD,d.Sq,d.bT,m.YN,m.BC,m.vS,i.W9,i.eU,i.BC,i.ai,i.QW,i.el,i.b_,i.I9,i.Jm,i.iq,i.nf,i.uz,i.he,i.In,i.A9,i.Sb,i.w2,i.To,i.Ki],styles:[".stats-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px;padding:16px}.stat-value[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:var(--ion-color-primary);text-align:center;margin-bottom:4px}.stat-label[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium);text-align:center;text-transform:uppercase;letter-spacing:.5px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px 24px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;color:var(--ion-color-medium);margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:var(--ion-color-dark);margin:0 0 8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:14px;color:var(--ion-color-medium);margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:48px}.loading-container[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{width:48px;height:48px}"]})}}return o})()}}]);