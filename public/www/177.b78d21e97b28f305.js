"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[177],{6177:(P,p,a)=>{a.r(p),a.d(p,{UsersPage:()=>v});var c=a(467),g=a(4341),o=a(9907),u=a(177),h=a(2951),m=a(5873),e=a(4438),f=a(5312),_=a(1626);let k=(()=>{class s{constructor(t){this.http=t,this.apiUrl=`${f.c.apiUrl}/auth`}getUsers(){return this.http.get(`${this.apiUrl}/users`)}getUser(t){return this.http.get(`${this.apiUrl}/users/${t}`)}updateUserRole(t,n){return this.http.put(`${this.apiUrl}/users/${t}/role`,{role:n})}makeHR(t){return this.http.post(`${this.apiUrl}/users/${t}/make-hr`,{})}makeManager(t){return this.http.post(`${this.apiUrl}/users/${t}/make-manager`,{})}makeAdmin(t){return this.http.post(`${this.apiUrl}/users/${t}/make-admin`,{})}makeEmployee(t){return this.http.post(`${this.apiUrl}/users/${t}/make-employee`,{})}bulkUpdateRoles(t){return this.http.post(`${this.apiUrl}/users/bulk-update-roles`,{updates:t})}static{this.\u0275fac=function(n){return new(n||s)(e.KVO(_.Qq))}}static{this.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var U=a(3799);function b(s,d){if(1&s&&(e.j41(0,"span",23),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&s){const t=e.XpG().$implicit;e.R7$(),e.SpI(" Last login: ",e.i5U(2,1,t.last_login,"short")," ")}}function F(s,d){if(1&s){const t=e.RV6();e.j41(0,"ion-item",17),e.nrm(1,"ion-icon",18),e.j41(2,"ion-label")(3,"h2"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s(),e.j41(7,"p",19)(8,"ion-badge",20),e.EFF(9),e.nI1(10,"uppercase"),e.k0s(),e.DNE(11,b,3,4,"span",21),e.k0s()(),e.j41(12,"ion-button",22),e.bIt("click",function(){const r=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.changeUserRole(r))}),e.EFF(13," Change Role "),e.k0s()()}if(2&s){const t=d.$implicit,n=e.XpG(2);e.R7$(),e.Y8G("name",n.roleIcons[t.role]||"person-outline")("color",n.roleColors[t.role]),e.R7$(3),e.JRh(t.full_name||t.username),e.R7$(2),e.JRh(t.email||t.username),e.R7$(2),e.Y8G("color",n.roleColors[t.role]),e.R7$(),e.SpI(" ",e.bMT(10,7,t.role)," "),e.R7$(2),e.Y8G("ngIf",t.last_login)}}function C(s,d){if(1&s&&(e.j41(0,"ion-list"),e.DNE(1,F,14,9,"ion-item",16),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.filteredUsers)}}function R(s,d){if(1&s){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-content")(2,"h3"),e.EFF(3,"Quick Test Actions (First User)"),e.k0s(),e.j41(4,"p",19),e.EFF(5," Testing user: "),e.j41(6,"strong"),e.EFF(7),e.k0s(),e.EFF(8," (Current role: "),e.j41(9,"ion-badge",20),e.EFF(10),e.k0s(),e.EFF(11,") "),e.k0s(),e.j41(12,"div",24)(13,"ion-button",25),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.quickActionMakeHR(r.filteredUsers[0]))}),e.nrm(14,"ion-icon",26),e.EFF(15," Make HR "),e.k0s(),e.j41(16,"ion-button",27),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.quickActionMakeManager(r.filteredUsers[0]))}),e.nrm(17,"ion-icon",28),e.EFF(18," Make Manager "),e.k0s(),e.j41(19,"ion-button",29),e.bIt("click",function(){e.eBV(t);const r=e.XpG();return e.Njj(r.quickActionMakeEmployee(r.filteredUsers[0]))}),e.nrm(20,"ion-icon",30),e.EFF(21," Make Employee "),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(7),e.JRh(t.filteredUsers[0].full_name||t.filteredUsers[0].username),e.R7$(2),e.Y8G("color",t.roleColors[t.filteredUsers[0].role||"employee"]),e.R7$(),e.JRh(t.filteredUsers[0].role)}}function y(s,d){if(1&s&&(e.j41(0,"div",31),e.nrm(1,"ion-icon",32),e.j41(2,"h2"),e.EFF(3,"No Users Found"),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s()()),2&s){const t=e.XpG();e.R7$(5),e.JRh(t.searchTerm?"Try a different search term":"No users available")}}function M(s,d){1&s&&(e.j41(0,"div",33),e.nrm(1,"ion-spinner",34),e.j41(2,"p"),e.EFF(3,"Loading users..."),e.k0s()())}let v=(()=>{class s{constructor(t,n,r,i){this.userService=t,this.router=n,this.alertController=r,this.toastController=i,this.users=[],this.filteredUsers=[],this.searchTerm="",this.isLoading=!1,this.roleColors={admin:"danger",hr:"warning",manager:"primary",employee:"medium"},this.roleIcons={admin:"shield-outline",hr:"briefcase-outline",manager:"people-outline",employee:"person-outline"},(0,h.d)({personOutline:m.wAZ,shieldOutline:m.uLY,briefcaseOutline:m.vOb,peopleOutline:m.wx_,checkmarkCircleOutline:m.gz2,refreshOutline:m.mVv})}ngOnInit(){this.loadUsers()}loadUsers(){this.isLoading=!0,this.userService.getUsers().subscribe({next:t=>{this.users=t,this.filteredUsers=t,this.isLoading=!1},error:t=>{console.error("Error loading users:",t),this.isLoading=!1,this.showToast("Error loading users","danger")}})}handleRefresh(t){this.loadUsers(),setTimeout(()=>t.target.complete(),1e3)}filterUsers(t){const n=t.target.value.toLowerCase();this.filteredUsers=n?this.users.filter(r=>r.username.toLowerCase().includes(n)||r.full_name?.toLowerCase().includes(n)||r.email?.toLowerCase().includes(n)||r.role.toLowerCase().includes(n)):this.users}changeUserRole(t){var n=this;return(0,c.A)(function*(){yield(yield n.alertController.create({header:"Change User Role",subHeader:`Current: ${t.role}`,message:`Select new role for ${t.username||t.full_name}`,inputs:[{name:"admin",type:"radio",label:"Admin",value:"admin",checked:"admin"===t.role},{name:"hr",type:"radio",label:"HR",value:"hr",checked:"hr"===t.role},{name:"manager",type:"radio",label:"Manager",value:"manager",checked:"manager"===t.role},{name:"employee",type:"radio",label:"Employee",value:"employee",checked:"employee"===t.role}],buttons:[{text:"Cancel",role:"cancel"},{text:"Update",handler:i=>{n.updateRole(t,i)}}]})).present()})()}updateRole(t,n){if(!n||n===t.role)return;let r;switch(n){case"admin":r=this.userService.makeAdmin(t.id);break;case"hr":r=this.userService.makeHR(t.id);break;case"manager":r=this.userService.makeManager(t.id);break;case"employee":r=this.userService.makeEmployee(t.id);break;default:r=this.userService.updateUserRole(t.id,n)}r.subscribe({next:()=>{this.showToast(`User role updated to ${n}`,"success"),this.loadUsers()},error:i=>{console.error("Error updating role:",i),this.showToast("Error updating user role","danger")}})}quickActionMakeHR(t){var n=this;return(0,c.A)(function*(){(yield n.confirmAction(t,"HR"))&&n.userService.makeHR(t.id).subscribe({next:()=>{n.showToast(`${t.username} is now HR`,"success"),n.loadUsers()},error:()=>n.showToast("Error updating role","danger")})})()}quickActionMakeManager(t){var n=this;return(0,c.A)(function*(){(yield n.confirmAction(t,"Manager"))&&n.userService.makeManager(t.id).subscribe({next:()=>{n.showToast(`${t.username} is now a Manager`,"success"),n.loadUsers()},error:()=>n.showToast("Error updating role","danger")})})()}quickActionMakeEmployee(t){var n=this;return(0,c.A)(function*(){(yield n.confirmAction(t,"Employee"))&&n.userService.makeEmployee(t.id).subscribe({next:()=>{n.showToast(`${t.username} is now an Employee`,"success"),n.loadUsers()},error:()=>n.showToast("Error updating role","danger")})})()}confirmAction(t,n){var r=this;return(0,c.A)(function*(){return new Promise(function(){var i=(0,c.A)(function*(l){yield(yield r.alertController.create({header:"Confirm Role Change",message:`Change ${t.username||t.full_name} from ${t.role} to ${n}?`,buttons:[{text:"Cancel",role:"cancel",handler:()=>l(!1)},{text:"Confirm",handler:()=>l(!0)}]})).present()});return function(l){return i.apply(this,arguments)}}())})()}showToast(t){var n=this;return(0,c.A)(function*(r,i="primary"){yield(yield n.toastController.create({message:r,duration:2e3,color:i,position:"top"})).present()}).apply(this,arguments)}getRoleStats(){return{total:this.users.length,admin:this.users.filter(t=>"admin"===t.role).length,hr:this.users.filter(t=>"hr"===t.role).length,manager:this.users.filter(t=>"manager"===t.role).length,employee:this.users.filter(t=>"employee"===t.role).length}}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(k),e.rXU(U.Ix),e.rXU(o.hG),e.rXU(o.K_))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-users"]],standalone:!0,features:[e.aNF],decls:46,vars:10,consts:[["color","primary"],["slot","start"],["defaultHref","/admin/dashboard"],["slot","end"],[3,"click"],["slot","icon-only","name","refresh-outline"],["placeholder","Search users...","animated","",3,"ngModelChange","ionInput","ngModel"],["slot","fixed",3,"ionRefresh"],[1,"stats-grid"],[1,"stat-item"],["color","danger"],["color","warning"],["color","medium"],[4,"ngIf"],["class","empty-state",4,"ngIf"],["class","loading-state",4,"ngIf"],["lines","full",4,"ngFor","ngForOf"],["lines","full"],["slot","start",3,"name","color"],[1,"ion-text-wrap"],[3,"color"],["class","user-meta",4,"ngIf"],["slot","end","fill","clear","size","small",3,"click"],[1,"user-meta"],[1,"quick-actions"],["expand","block","color","warning",3,"click"],["name","briefcase-outline","slot","start"],["expand","block","color","primary",3,"click"],["name","people-outline","slot","start"],["expand","block","color","medium",3,"click"],["name","person-outline","slot","start"],[1,"empty-state"],["name","people-outline","color","medium"],[1,"loading-state"],["name","crescent","color","primary"]],template:function(n,r){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"User Management"),e.k0s(),e.j41(6,"ion-buttons",3)(7,"ion-button",4),e.bIt("click",function(){return r.loadUsers()}),e.nrm(8,"ion-icon",5),e.k0s()()(),e.j41(9,"ion-toolbar")(10,"ion-searchbar",6),e.mxI("ngModelChange",function(l){return e.DH7(r.searchTerm,l)||(r.searchTerm=l),l}),e.bIt("ionInput",function(l){return r.filterUsers(l)}),e.k0s()()(),e.j41(11,"ion-content")(12,"ion-refresher",7),e.bIt("ionRefresh",function(l){return r.handleRefresh(l)}),e.nrm(13,"ion-refresher-content"),e.k0s(),e.j41(14,"ion-card")(15,"ion-card-content")(16,"div",8)(17,"div",9)(18,"ion-badge",0),e.EFF(19),e.k0s(),e.j41(20,"ion-label"),e.EFF(21,"Total Users"),e.k0s()(),e.j41(22,"div",9)(23,"ion-badge",10),e.EFF(24),e.k0s(),e.j41(25,"ion-label"),e.EFF(26,"Admins"),e.k0s()(),e.j41(27,"div",9)(28,"ion-badge",11),e.EFF(29),e.k0s(),e.j41(30,"ion-label"),e.EFF(31,"HR"),e.k0s()(),e.j41(32,"div",9)(33,"ion-badge",0),e.EFF(34),e.k0s(),e.j41(35,"ion-label"),e.EFF(36,"Managers"),e.k0s()(),e.j41(37,"div",9)(38,"ion-badge",12),e.EFF(39),e.k0s(),e.j41(40,"ion-label"),e.EFF(41,"Employees"),e.k0s()()()()(),e.DNE(42,C,2,1,"ion-list",13)(43,R,22,3,"ion-card",13)(44,y,6,1,"div",14)(45,M,4,0,"div",15),e.k0s()),2&n&&(e.R7$(10),e.R50("ngModel",r.searchTerm),e.R7$(9),e.JRh(r.getRoleStats().total),e.R7$(5),e.JRh(r.getRoleStats().admin),e.R7$(5),e.JRh(r.getRoleStats().hr),e.R7$(5),e.JRh(r.getRoleStats().manager),e.R7$(5),e.JRh(r.getRoleStats().employee),e.R7$(3),e.Y8G("ngIf",!r.isLoading&&r.filteredUsers.length>0),e.R7$(),e.Y8G("ngIf",r.filteredUsers.length>0),e.R7$(),e.Y8G("ngIf",!r.isLoading&&0===r.filteredUsers.length),e.R7$(),e.Y8G("ngIf",r.isLoading))},dependencies:[u.MD,u.Sq,u.bT,u.Pc,u.vh,g.YN,g.BC,g.vS,o.W9,o.eU,o.BC,o.ai,o.QW,o.el,o.S1,o.nf,o.uz,o.he,o.In,o.iq,o.To,o.Ki,o.b_,o.I9,o.Jm,o.w2],styles:[".stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:16px;text-align:center}.stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:18px;padding:8px 12px}.stats-grid[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:11px;color:var(--ion-color-medium)}.user-meta[_ngcontent-%COMP%]{font-size:11px;color:var(--ion-color-medium);margin-left:8px}.quick-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-top:12px}.quick-actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin:0}.empty-state[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:80px;margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 8px;font-size:20px;font-weight:600}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%], .loading-state[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{transform:scale(1.5);margin-bottom:20px}"]})}}return s})()}}]);