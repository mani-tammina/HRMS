"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[625],{9625:(E,g,c)=>{c.r(g),c.d(g,{AttendancePage:()=>A});var d=c(467),a=c(7820),u=c(177),_=c(4341),m=c(5312),h=c(2951),s=c(5873),n=c(4438),f=c(1963),P=c(1626);function k(i,l){if(1&i&&(n.j41(0,"div",20),n.nrm(1,"ion-icon",21),n.j41(2,"span"),n.EFF(3),n.nI1(4,"number"),n.k0s()()),2&i){const t=n.XpG();n.R7$(3),n.SpI("Work Hours: ",n.i5U(4,1,null==t.todayAttendance?null:t.todayAttendance.total_hours,"1.1-1"),"h")}}function M(i,l){if(1&i&&(n.j41(0,"div",22)(1,"ion-badge",23),n.EFF(2),n.k0s()()),2&i){const t=n.XpG();n.R7$(),n.Y8G("color","Office"===(null==t.todayAttendance?null:t.todayAttendance.work_mode)?"primary":"tertiary"),n.R7$(),n.SpI(" ",null==t.todayAttendance?null:t.todayAttendance.work_mode," ")}}function p(i,l){if(1&i&&(n.j41(0,"p"),n.EFF(1),n.nI1(2,"number"),n.k0s()),2&i){const t=n.XpG().$implicit;n.R7$(),n.SpI("",n.i5U(2,1,t.total_hours,"1.1-1")," hours")}}function O(i,l){if(1&i&&(n.j41(0,"p")(1,"ion-badge",28),n.EFF(2),n.k0s()()),2&i){const t=n.XpG().$implicit;n.R7$(),n.Y8G("color","Office"===t.work_mode?"primary":"tertiary"),n.R7$(),n.SpI(" ",t.work_mode," ")}}function y(i,l){if(1&i&&(n.j41(0,"ion-item",24),n.nrm(1,"ion-icon",25),n.j41(2,"ion-label")(3,"h3"),n.EFF(4),n.nI1(5,"date"),n.k0s(),n.j41(6,"p"),n.EFF(7),n.nI1(8,"date"),n.nI1(9,"date"),n.k0s(),n.DNE(10,p,3,4,"p",26)(11,O,3,2,"p",26),n.k0s(),n.j41(12,"ion-badge",27),n.EFF(13),n.k0s()()),2&i){const t=l.$implicit,o=n.XpG();n.R7$(),n.Y8G("color",o.getStatusColor(t.status)),n.R7$(3),n.JRh(n.i5U(5,8,t.attendance_date,"MMM d, y")),n.R7$(3),n.Lme("",n.i5U(8,11,t.check_in,"shortTime")," - ",t.check_out?n.i5U(9,14,t.check_out,"shortTime"):"Not checked out",""),n.R7$(3),n.Y8G("ngIf",t.total_hours),n.R7$(),n.Y8G("ngIf",t.work_mode),n.R7$(),n.Y8G("color",o.getStatusColor(t.status)),n.R7$(),n.SpI(" ",t.status," ")}}function C(i,l){if(1&i){const t=n.RV6();n.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n.EFF(3,"Select Work Mode"),n.k0s(),n.j41(4,"ion-buttons",29)(5,"ion-button",30),n.bIt("click",function(){n.eBV(t);const e=n.XpG();return n.Njj(e.closeWorkModeModal())}),n.nrm(6,"ion-icon",31),n.k0s()()()(),n.j41(7,"ion-content",32)(8,"ion-text",33)(9,"p"),n.EFF(10,"Choose where you're working from today:"),n.k0s()(),n.j41(11,"ion-radio-group",34),n.mxI("ngModelChange",function(e){n.eBV(t);const r=n.XpG();return n.DH7(r.selectedWorkMode,e)||(r.selectedWorkMode=e),n.Njj(e)}),n.j41(12,"ion-item"),n.nrm(13,"ion-icon",35),n.j41(14,"ion-label")(15,"h2"),n.EFF(16,"Office"),n.k0s(),n.j41(17,"p"),n.EFF(18,"Working from office location"),n.k0s()(),n.nrm(19,"ion-radio",36),n.k0s(),n.j41(20,"ion-item"),n.nrm(21,"ion-icon",37),n.j41(22,"ion-label")(23,"h2"),n.EFF(24,"Work From Home (WFH)"),n.k0s(),n.j41(25,"p"),n.EFF(26,"Working from home"),n.k0s()(),n.nrm(27,"ion-radio",38),n.k0s(),n.j41(28,"ion-item"),n.nrm(29,"ion-icon",39),n.j41(30,"ion-label")(31,"h2"),n.EFF(32,"Remote"),n.k0s(),n.j41(33,"p"),n.EFF(34,"Working from any remote location"),n.k0s()(),n.nrm(35,"ion-radio",40),n.k0s(),n.j41(36,"ion-item"),n.nrm(37,"ion-icon",41),n.j41(38,"ion-label")(39,"h2"),n.EFF(40,"Hybrid"),n.k0s(),n.j41(41,"p"),n.EFF(42,"Mixed work mode"),n.k0s()(),n.nrm(43,"ion-radio",42),n.k0s()(),n.j41(44,"ion-button",43),n.bIt("click",function(){n.eBV(t);const e=n.XpG();return n.Njj(e.confirmPunchIn())}),n.nrm(45,"ion-icon",12),n.EFF(46," Confirm Punch In "),n.k0s()()}if(2&i){const t=n.XpG();n.R7$(11),n.R50("ngModel",t.selectedWorkMode),n.R7$(33),n.Y8G("disabled",t.isLoading)}}let A=(()=>{class i{constructor(t,o,e){this.attendanceService=t,this.toastController=o,this.http=e,this.todayAttendance=null,this.todayStatus=null,this.recentAttendance=[],this.isLoading=!1,this.canPunchIn=!0,this.canPunchOut=!1,this.selectedWorkMode="Office",this.showWorkModeModal=!1,(0,h.d)({logInOutline:s.oPd,logOutOutline:s.z_V,timeOutline:s.CVk,calendarOutline:s.RXF,businessOutline:s.FL4,homeOutline:s.Ud0,globeOutline:s.OQB,close:s.VNx})}ngOnInit(){this.loadData(),this.checkWFHStatus()}ionViewWillEnter(){this.loadData(),this.checkWFHStatus()}checkWFHStatus(){this.http.get(`${m.c.apiUrl}/leaves/wfh-check-today`).subscribe({next:t=>{t.has_wfh?(this.selectedWorkMode=t.work_mode,console.log("Approved WFH/Remote found for today, defaulting to:",t.work_mode)):this.selectedWorkMode="Office"},error:t=>{console.error("Error checking WFH status:",t),this.selectedWorkMode="Office"}})}loadData(){console.log("AttendancePage: Loading attendance data..."),this.attendanceService.getTodayStatus().subscribe({next:e=>{console.log("AttendancePage: Today status:",e),this.todayStatus=e,this.todayAttendance=e.attendance,this.canPunchIn=!1!==e.can_punch_in,this.canPunchOut=!0===e.can_punch_out},error:e=>{console.error("AttendancePage: Error loading today status:",e),this.showToast("Failed to load today's attendance","danger")}});const t=(new Date).toISOString().split("T")[0],o=new Date(Date.now()-2592e6).toISOString().split("T")[0];console.log("AttendancePage: Loading recent attendance from",o,"to",t),this.attendanceService.getAttendance(o,t).subscribe({next:e=>{console.log("AttendancePage: Recent attendance loaded:",e),this.recentAttendance=e},error:e=>{console.error("AttendancePage: Error loading recent attendance:",e),this.showToast("Failed to load attendance history","danger")}})}handleRefresh(t){this.loadData(),setTimeout(()=>t.target.complete(),1e3)}punchIn(){var t=this;return(0,d.A)(function*(){var o;t.isLoading=!0,console.log("AttendancePage: Punching in with work mode:",t.selectedWorkMode),t.attendanceService.punchIn(t.selectedWorkMode).subscribe({next:(o=(0,d.A)(function*(e){console.log("AttendancePage: Punch-in response:",e),t.isLoading=!1,t.showWorkModeModal=!1,yield t.showToast(e.message||"Punched in successfully!","success"),t.loadData()}),function(r){return o.apply(this,arguments)}),error:function(){var o=(0,d.A)(function*(e){console.error("AttendancePage: Punch-in error:",e),t.isLoading=!1,yield t.showToast(e.error?.error||e.error?.message||"Punch-in failed","danger")});return function(r){return o.apply(this,arguments)}}()})})()}openWorkModeModal(){this.http.get(`${m.c.apiUrl}/leaves/wfh-check-today`).subscribe({next:t=>{t.has_wfh&&(this.selectedWorkMode=t.work_mode),this.showWorkModeModal=!0},error:t=>{console.error("Error checking WFH status:",t),this.showWorkModeModal=!0}})}closeWorkModeModal(){this.showWorkModeModal=!1,this.selectedWorkMode="Office"}confirmPunchIn(){this.punchIn()}punchOut(){var t=this;return(0,d.A)(function*(){var o;t.isLoading=!0,console.log("AttendancePage: Punching out..."),t.attendanceService.punchOut().subscribe({next:(o=(0,d.A)(function*(e){console.log("AttendancePage: Punch-out response:",e),t.isLoading=!1,yield t.showToast(e.message||"Punched out successfully!","success"),t.loadData()}),function(r){return o.apply(this,arguments)}),error:function(){var o=(0,d.A)(function*(e){console.error("AttendancePage: Punch-out error:",e),t.isLoading=!1,yield t.showToast(e.error?.error||e.error?.message||"Punch-out failed","danger")});return function(r){return o.apply(this,arguments)}}()})})()}getStatusColor(t){return{present:"success",late:"warning",absent:"danger","half-day":"medium"}[t]||"medium"}showToast(t,o){var e=this;return(0,d.A)(function*(){(yield e.toastController.create({message:t,duration:3e3,color:o,position:"top"})).present()})()}static{this.\u0275fac=function(o){return new(o||i)(n.rXU(f.$),n.rXU(a.K_),n.rXU(P.Qq))}}static{this.\u0275cmp=n.VBU({type:i,selectors:[["app-attendance"]],standalone:!0,features:[n.aNF],decls:47,vars:15,consts:[[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[1,"attendance-container"],[1,"today-attendance-card"],[1,"attendance-info"],[1,"time-info"],["name","log-in-outline","color","success"],[1,"label"],[1,"time"],["name","log-out-outline","color","danger"],[1,"action-buttons"],["expand","block",3,"click","disabled"],["slot","start","name","log-in-outline"],["expand","block","color","danger",3,"click","disabled"],["slot","start","name","log-out-outline"],["class","work-hours",4,"ngIf"],["class","work-mode",4,"ngIf"],[1,"section-title"],["lines","full",4,"ngFor","ngForOf"],[3,"didDismiss","isOpen"],[1,"work-hours"],["name","time-outline","color","primary"],[1,"work-mode"],[3,"color"],["lines","full"],["slot","start","name","calendar-outline",3,"color"],[4,"ngIf"],["slot","end",3,"color"],[2,"font-size","0.7rem",3,"color"],["slot","end"],[3,"click"],["name","close"],[1,"ion-padding"],["color","medium"],[3,"ngModelChange","ngModel"],["name","business-outline","slot","start","color","primary"],["slot","end","value","Office"],["name","home-outline","slot","start","color","success"],["slot","end","value","WFH"],["name","globe-outline","slot","start","color","tertiary"],["slot","end","value","Remote"],["name","business-outline","slot","start","color","warning"],["slot","end","value","Hybrid"],["expand","block",1,"ion-margin-top",3,"click","disabled"]],template:function(o,e){1&o&&(n.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),n.EFF(3,"Attendance Tracking"),n.k0s()()(),n.j41(4,"ion-content",0)(5,"ion-refresher",1),n.bIt("ionRefresh",function(F){return e.handleRefresh(F)}),n.nrm(6,"ion-refresher-content"),n.k0s(),n.j41(7,"div",2)(8,"ion-card",3)(9,"ion-card-header")(10,"ion-card-title"),n.EFF(11,"Today's Attendance"),n.k0s()(),n.j41(12,"ion-card-content")(13,"div",4)(14,"div",5),n.nrm(15,"ion-icon",6),n.j41(16,"div")(17,"p",7),n.EFF(18,"Check In"),n.k0s(),n.j41(19,"p",8),n.EFF(20),n.nI1(21,"date"),n.k0s()()(),n.j41(22,"div",5),n.nrm(23,"ion-icon",9),n.j41(24,"div")(25,"p",7),n.EFF(26,"Check Out"),n.k0s(),n.j41(27,"p",8),n.EFF(28),n.nI1(29,"date"),n.k0s()()()(),n.j41(30,"div",10)(31,"ion-button",11),n.bIt("click",function(){return e.openWorkModeModal()}),n.nrm(32,"ion-icon",12),n.EFF(33," Punch In "),n.k0s(),n.j41(34,"ion-button",13),n.bIt("click",function(){return e.punchOut()}),n.nrm(35,"ion-icon",14),n.EFF(36," Punch Out "),n.k0s()(),n.DNE(37,k,5,4,"div",15)(38,M,3,2,"div",16),n.k0s()(),n.j41(39,"div",17)(40,"h2"),n.EFF(41,"Recent Attendance"),n.k0s()(),n.j41(42,"ion-card")(43,"ion-list"),n.DNE(44,y,14,17,"ion-item",18),n.k0s()()(),n.j41(45,"ion-modal",19),n.bIt("didDismiss",function(){return e.closeWorkModeModal()}),n.DNE(46,C,47,2,"ng-template"),n.k0s()()),2&o&&(n.R7$(4),n.Y8G("fullscreen",!0),n.R7$(16),n.JRh(null!=e.todayAttendance&&e.todayAttendance.check_in?n.i5U(21,9,null==e.todayAttendance?null:e.todayAttendance.check_in,"shortTime"):"--:--"),n.R7$(8),n.JRh(null!=e.todayAttendance&&e.todayAttendance.check_out?n.i5U(29,12,null==e.todayAttendance?null:e.todayAttendance.check_out,"shortTime"):"--:--"),n.R7$(3),n.Y8G("disabled",e.isLoading||!e.canPunchIn),n.R7$(3),n.Y8G("disabled",e.isLoading||!e.canPunchOut),n.R7$(3),n.Y8G("ngIf",null==e.todayAttendance?null:e.todayAttendance.total_hours),n.R7$(),n.Y8G("ngIf",null==e.todayAttendance?null:e.todayAttendance.work_mode),n.R7$(6),n.Y8G("ngForOf",e.recentAttendance),n.R7$(),n.Y8G("isOpen",e.showWorkModeModal))},dependencies:[u.MD,u.Sq,u.bT,u.QX,u.vh,_.YN,_.BC,_.vS,a.W9,a.eU,a.BC,a.ai,a.b_,a.I9,a.ME,a.tN,a.Jm,a.iq,a.nf,a.uz,a.he,a.In,a.To,a.Ki,a.Sb,a.QW,a.f0,a.KO,a.IO],styles:[".attendance-container[_ngcontent-%COMP%]{padding:1rem;max-width:1200px;margin:0 auto}.today-attendance-card[_ngcontent-%COMP%]{background:var(--gradient-primary);color:#fff}.today-attendance-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{color:#fff}.today-attendance-card[_ngcontent-%COMP%]   .attendance-info[_ngcontent-%COMP%]{display:flex;justify-content:space-around;margin-bottom:1.5rem}.today-attendance-card[_ngcontent-%COMP%]   .attendance-info[_ngcontent-%COMP%]   .time-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.today-attendance-card[_ngcontent-%COMP%]   .attendance-info[_ngcontent-%COMP%]   .time-info[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:2rem}.today-attendance-card[_ngcontent-%COMP%]   .attendance-info[_ngcontent-%COMP%]   .time-info[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:.8rem;color:var(--ion-color-medium);margin:0 0 .25rem}.today-attendance-card[_ngcontent-%COMP%]   .attendance-info[_ngcontent-%COMP%]   .time-info[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;margin:0}.today-attendance-card[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem}.today-attendance-card[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1}.today-attendance-card[_ngcontent-%COMP%]   .work-hours[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;background:var(--ion-color-light);border-radius:8px}.today-attendance-card[_ngcontent-%COMP%]   .work-hours[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5rem}.today-attendance-card[_ngcontent-%COMP%]   .work-hours[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:600;color:var(--ion-color-primary)}.today-attendance-card[_ngcontent-%COMP%]   .work-mode[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-top:.5rem}.today-attendance-card[_ngcontent-%COMP%]   .work-mode[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:.9rem}.section-title[_ngcontent-%COMP%]{margin:1.5rem 0 1rem}.section-title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;margin:0}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.25rem}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem;color:var(--ion-color-medium)}"]})}}return i})()}}]);