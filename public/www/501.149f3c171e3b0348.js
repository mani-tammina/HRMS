"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[501],{501:(I,g,a)=>{a.r(g),a.d(g,{VerificationQueuePage:()=>F});var _=a(467),n=a(7820),d=a(177),m=a(4341),f=a(2951),c=a(5873),e=a(4438),p=a(3799),k=a(4086);function C(s,u){if(1&s){const t=e.RV6();e.j41(0,"ion-card",14)(1,"ion-card-content")(2,"div",15)(3,"ion-button",16),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.bulkApprove())}),e.nrm(4,"ion-icon",17),e.EFF(5),e.k0s(),e.j41(6,"ion-button",18),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.bulkReject())}),e.nrm(7,"ion-icon",19),e.EFF(8),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(5),e.SpI(" Verify (",t.selectedItems.size,") "),e.R7$(3),e.SpI(" Reject (",t.selectedItems.size,") ")}}function P(s,u){1&s&&(e.j41(0,"ion-chip",29),e.nrm(1,"ion-icon",30),e.j41(2,"ion-label"),e.EFF(3,"Has Work Updates"),e.k0s()())}function b(s,u){if(1&s){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-checkbox",21),e.bIt("ionChange",function(){const i=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.toggleSelection(i.client_timesheet_id))}),e.k0s(),e.j41(2,"ion-label")(3,"h2"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s(),e.j41(7,"p")(8,"strong"),e.EFF(9,"Client:"),e.k0s(),e.EFF(10),e.k0s(),e.j41(11,"p")(12,"strong"),e.EFF(13,"Month/Year:"),e.k0s(),e.EFF(14),e.k0s(),e.j41(15,"p")(16,"strong"),e.EFF(17,"File:"),e.k0s(),e.EFF(18),e.k0s(),e.j41(19,"div",22)(20,"ion-chip",23),e.nrm(21,"ion-icon",24),e.j41(22,"ion-label"),e.EFF(23),e.k0s()(),e.DNE(24,P,4,0,"ion-chip",25),e.k0s(),e.j41(25,"p",26),e.EFF(26),e.nI1(27,"date"),e.k0s()(),e.j41(28,"ion-button",27),e.bIt("click",function(){const i=e.eBV(t).$implicit,r=e.XpG(2);return e.Njj(r.viewDetails(i.client_timesheet_id))}),e.nrm(29,"ion-icon",28),e.EFF(30," View & Verify "),e.k0s()()}if(2&s){const t=u.$implicit,o=e.XpG(2);e.R7$(),e.Y8G("checked",o.selectedItems.has(t.client_timesheet_id)),e.R7$(3),e.Lme("",t.first_name," ",t.last_name,""),e.R7$(2),e.Lme("",t.employee_code," \u2022 ",t.project_name,""),e.R7$(4),e.SpI(" ",t.client_name,""),e.R7$(4),e.Lme(" ",t.month,"/",t.year,""),e.R7$(4),e.Lme(" ",t.file_name," (",(t.file_size/1024).toFixed(2)," KB)"),e.R7$(2),e.Y8G("color",t.is_verified?"success":"warning"),e.R7$(),e.Y8G("name",t.is_verified?"checkmark-circle-outline":"time-outline"),e.R7$(2),e.JRh(t.is_verified?"Verified":"Pending Verification"),e.R7$(),e.Y8G("ngIf",t.work_update_id),e.R7$(2),e.SpI(" Uploaded: ",e.i5U(27,15,t.uploaded_at,"short")," ")}}function E(s,u){if(1&s&&(e.j41(0,"ion-list"),e.DNE(1,b,31,18,"ion-item",20),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.filteredQueue)}}function M(s,u){1&s&&(e.j41(0,"div",31),e.nrm(1,"ion-icon",32),e.j41(2,"p"),e.EFF(3,"No client timesheets in queue"),e.k0s()())}let F=(()=>{class s{constructor(t,o,i,r,l){this.router=t,this.adminTimesheetService=o,this.toastController=i,this.alertController=r,this.loadingController=l,this.queueItems=[],this.selectedItems=new Set,this.filterStatus="pending",this.searchTerm="",this.isLoading=!1,(0,f.d)({checkmarkCircleOutline:c.gz2,closeCircleOutline:c.p9N,warningOutline:c.bO5,eyeOutline:c.ov$,filterOutline:c.PyO,checkmarkDoneOutline:c.u8Q})}ngOnInit(){console.log("VerificationQueuePage ngOnInit called"),this.loadQueue()}ionViewWillEnter(){console.log("VerificationQueuePage ionViewWillEnter called"),this.loadQueue()}loadQueue(){console.log("loadQueue called with filterStatus:",this.filterStatus),this.isLoading=!0,this.adminTimesheetService.getVerificationQueue(this.filterStatus).subscribe({next:t=>{console.log("Verification queue loaded:",t),this.queueItems=t.verificationQueue,this.isLoading=!1},error:t=>{console.error("Error loading verification queue:",t),this.showToast("Failed to load verification queue","danger"),this.isLoading=!1}})}handleRefresh(t){this.loadQueue(),setTimeout(()=>t.target.complete(),1e3)}onFilterChange(t){this.filterStatus=t.detail.value,this.loadQueue()}toggleSelection(t){this.selectedItems.has(t)?this.selectedItems.delete(t):this.selectedItems.add(t)}toggleSelectAll(){this.selectedItems.size===this.filteredQueue.length?this.selectedItems.clear():this.filteredQueue.forEach(t=>this.selectedItems.add(t.client_timesheet_id))}get filteredQueue(){if(!this.searchTerm)return this.queueItems;const t=this.searchTerm.toLowerCase();return this.queueItems.filter(o=>o.first_name.toLowerCase().includes(t)||o.last_name.toLowerCase().includes(t)||o.employee_code.toLowerCase().includes(t)||o.project_name.toLowerCase().includes(t)||o.client_name.toLowerCase().includes(t)||o.file_name.toLowerCase().includes(t))}viewDetails(t){this.router.navigate(["/admin/timesheet/client-timesheet",t])}bulkApprove(){var t=this;return(0,_.A)(function*(){0!==t.selectedItems.size?yield(yield t.alertController.create({header:"Bulk Approve",message:`Approve ${t.selectedItems.size} selected client timesheet(s)?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Approve",handler:()=>t.executeBulkAction(!0)}]})).present():t.showToast("Please select items to approve","warning")})()}bulkReject(){var t=this;return(0,_.A)(function*(){0!==t.selectedItems.size?yield(yield t.alertController.create({header:"Bulk Reject",message:`Reject ${t.selectedItems.size} selected client timesheet(s)?`,inputs:[{name:"notes",type:"textarea",placeholder:"Add notes for rejection...",attributes:{required:!0}}],buttons:[{text:"Cancel",role:"cancel"},{text:"Reject",handler:i=>i.notes?t.executeBulkAction(!1,i.notes):(t.showToast("Please provide notes for rejection","warning"),!1)}]})).present():t.showToast("Please select items to reject","warning")})()}executeBulkAction(t,o){var i=this;return(0,_.A)(function*(){const r=yield i.loadingController.create({message:"Processing bulk action..."});yield r.present();const l=Array.from(i.selectedItems).map(h=>i.adminTimesheetService.verifyClientTimesheet({clientTimesheetId:h,isVerified:t,notes:o}).toPromise());try{yield Promise.all(l),r.dismiss(),i.showToast(`${i.selectedItems.size} items ${t?"verified":"rejected"} successfully`,"success"),i.selectedItems.clear(),i.loadQueue()}catch(h){r.dismiss(),console.error("Error in bulk action:",h),i.showToast("Failed to complete bulk action","danger")}})()}showToast(t){var o=this;return(0,_.A)(function*(i,r="primary"){yield(yield o.toastController.create({message:i,duration:3e3,position:"top",color:r})).present()}).apply(this,arguments)}static{this.\u0275fac=function(o){return new(o||s)(e.rXU(p.Ix),e.rXU(k.p),e.rXU(n.K_),e.rXU(n.hG),e.rXU(n.Xi))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-verification-queue"]],standalone:!0,features:[e.aNF],decls:38,vars:7,consts:[["color","primary"],["slot","start"],["defaultHref","/admin/timesheet/dashboard"],[3,"click"],["name","checkmark-done-outline"],["slot","end"],["slot","fixed",3,"ionRefresh"],[3,"ngModelChange","ionChange","ngModel"],["value","pending"],["value","verified"],["placeholder","Search by employee, project, file...","animated","",3,"ngModelChange","ngModel"],["class","bulk-actions-card",4,"ngIf"],[4,"ngIf"],["class","empty-state",4,"ngIf"],[1,"bulk-actions-card"],[1,"bulk-actions"],["size","small","color","success",3,"click"],["name","checkmark-circle-outline","slot","start"],["size","small","color","danger",3,"click"],["name","close-circle-outline","slot","start"],[4,"ngFor","ngForOf"],["slot","start",3,"ionChange","checked"],[1,"chips"],[3,"color"],[3,"name"],["color","tertiary",4,"ngIf"],[1,"submission-time"],["slot","end","fill","outline","size","small",3,"click"],["name","eye-outline"],["color","tertiary"],["name","document-text-outline"],[1,"empty-state"],["name","checkmark-circle-outline","size","large","color","success"]],template:function(o,i){1&o&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Verification Queue"),e.k0s()(),e.j41(6,"ion-toolbar")(7,"ion-buttons",1)(8,"ion-button",3),e.bIt("click",function(){return i.toggleSelectAll()}),e.nrm(9,"ion-icon",4),e.EFF(10," Select All "),e.k0s()(),e.j41(11,"ion-buttons",5)(12,"ion-badge",0),e.EFF(13),e.k0s()()()(),e.j41(14,"ion-content")(15,"ion-refresher",6),e.bIt("ionRefresh",function(l){return i.handleRefresh(l)}),e.nrm(16,"ion-refresher-content"),e.k0s(),e.j41(17,"ion-card")(18,"ion-card-content")(19,"ion-item")(20,"ion-label"),e.EFF(21,"Status Filter"),e.k0s(),e.j41(22,"ion-select",7),e.mxI("ngModelChange",function(l){return e.DH7(i.filterStatus,l)||(i.filterStatus=l),l}),e.bIt("ionChange",function(l){return i.onFilterChange(l)}),e.j41(23,"ion-select-option",8),e.EFF(24,"Pending"),e.k0s(),e.j41(25,"ion-select-option",9),e.EFF(26,"Verified"),e.k0s()()(),e.j41(27,"ion-searchbar",10),e.mxI("ngModelChange",function(l){return e.DH7(i.searchTerm,l)||(i.searchTerm=l),l}),e.k0s()()(),e.DNE(28,C,9,2,"ion-card",11),e.j41(29,"ion-card")(30,"ion-card-header")(31,"ion-card-title"),e.EFF(32," Client Timesheet Uploads "),e.j41(33,"ion-badge",0),e.EFF(34),e.k0s()()(),e.j41(35,"ion-card-content"),e.DNE(36,E,2,1,"ion-list",12)(37,M,4,0,"div",13),e.k0s()()()),2&o&&(e.R7$(13),e.JRh(i.selectedItems.size),e.R7$(9),e.R50("ngModel",i.filterStatus),e.R7$(5),e.R50("ngModel",i.searchTerm),e.R7$(),e.Y8G("ngIf",i.selectedItems.size>0),e.R7$(6),e.JRh(i.filteredQueue.length),e.R7$(2),e.Y8G("ngIf",i.filteredQueue.length>0),e.R7$(),e.Y8G("ngIf",0===i.filteredQueue.length))},dependencies:[d.MD,d.Sq,d.bT,d.vh,m.YN,m.BC,m.vS,n.W9,n.eU,n.BC,n.ai,n.QW,n.el,n.b_,n.I9,n.ME,n.tN,n.Jm,n.iq,n.nf,n.uz,n.he,n.In,n.Nm,n.Ip,n.eY,n.S1,n.ZB,n.To,n.Ki],styles:[".bulk-actions-card[_ngcontent-%COMP%]{margin:16px;background-color:var(--ion-color-light)}.bulk-actions-card[_ngcontent-%COMP%]   .bulk-actions[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}.bulk-actions-card[_ngcontent-%COMP%]   .bulk-actions[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1;min-width:120px}.description[_ngcontent-%COMP%]{font-size:.9em;color:var(--ion-color-medium);margin-top:4px}.chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:4px;margin-top:8px}.chips[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{margin:0;height:24px;font-size:.75em}.chips[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1em;margin-right:2px}.submission-time[_ngcontent-%COMP%]{font-size:.85em;color:var(--ion-color-medium);margin-top:4px;font-style:italic}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;margin-bottom:16px;opacity:.5}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:1.1em}ion-checkbox[_ngcontent-%COMP%]{margin-right:12px}ion-card[_ngcontent-%COMP%]{margin:16px;box-shadow:0 2px 8px #0000001a}ion-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 8px;margin-bottom:8px;border-bottom:1px solid var(--ion-color-light)}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]:last-child{border-bottom:none}"]})}}return s})()}}]);