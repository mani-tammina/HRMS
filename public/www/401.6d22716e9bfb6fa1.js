"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[401],{6401:(O,f,r)=>{r.r(f),r.d(f,{LeaveRequestPage:()=>I});var c=r(467),s=r(4341),o=r(7820),v=r(177),h=r(2951),g=r(5873),e=r(4438),y=r(7599),b=r(3799);function L(i,d){1&i&&(e.j41(0,"ion-card")(1,"ion-card-content",5),e.nrm(2,"ion-spinner",6),e.j41(3,"p"),e.EFF(4,"Loading leave balance..."),e.k0s()()())}function E(i,d){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const a=e.XpG().$implicit;e.R7$(),e.SpI(" | Pending: ",a.pending_days,"")}}function B(i,d){if(1&i&&(e.j41(0,"ion-item",9)(1,"ion-label")(2,"h4"),e.EFF(3),e.k0s(),e.j41(4,"p",10),e.EFF(5),e.j41(6,"span",11),e.EFF(7),e.k0s(),e.DNE(8,E,2,1,"span",4),e.k0s()(),e.j41(9,"ion-badge",12),e.EFF(10),e.k0s()()),2&i){const a=d.$implicit;e.R7$(3),e.Lme("",a.type_name," (",a.type_code,")"),e.R7$(2),e.Lme(" Used: ",a.used_days," / ",a.allocated_days," | "),e.R7$(2),e.SpI("",a.available_days," remaining"),e.R7$(),e.Y8G("ngIf",a.pending_days>0),e.R7$(),e.Y8G("color",a.available_days>0?"success":"danger"),e.R7$(),e.SpI(" ",a.available_days," ")}}function R(i,d){if(1&i&&(e.j41(0,"ion-card")(1,"ion-card-content")(2,"h3",7),e.EFF(3,"Your Leave Balance"),e.k0s(),e.j41(4,"ion-list"),e.DNE(5,B,11,8,"ion-item",8),e.k0s()()()),2&i){const a=e.XpG();e.R7$(5),e.Y8G("ngForOf",a.leaveBalances)}}function T(i,d){if(1&i&&(e.j41(0,"ion-select-option",24),e.EFF(1),e.k0s()),2&i){const a=d.$implicit;e.Y8G("value",a.id),e.R7$(),e.Lme(" ",a.type_name," - ",a.available_days," days available ")}}function P(i,d){1&i&&(e.j41(0,"span"),e.EFF(1," | Paid Leave"),e.k0s())}function F(i,d){if(1&i&&(e.j41(0,"ion-card",25)(1,"ion-card-content",26)(2,"div",27),e.nrm(3,"ion-icon",28),e.j41(4,"div")(5,"strong"),e.EFF(6),e.k0s(),e.nrm(7,"br"),e.j41(8,"small",29),e.EFF(9),e.DNE(10,P,2,0,"span",4),e.k0s()()()()()),2&i){const a=e.XpG(2);e.R7$(6),e.JRh(a.selectedLeaveBalance.type_name),e.R7$(3),e.Lme(" Available: ",a.selectedLeaveBalance.available_days," days | Used: ",a.selectedLeaveBalance.used_days," days "),e.R7$(),e.Y8G("ngIf",a.selectedLeaveBalance.is_paid)}}function D(i,d){1&i&&e.nrm(0,"ion-spinner",30)}function x(i,d){if(1&i){const a=e.RV6();e.j41(0,"ion-card")(1,"ion-card-content")(2,"form",13),e.bIt("ngSubmit",function(){e.eBV(a);const t=e.XpG();return e.Njj(t.onSubmit())}),e.j41(3,"ion-item"),e.nrm(4,"ion-icon",14),e.j41(5,"ion-select",15),e.DNE(6,T,2,3,"ion-select-option",16),e.k0s()(),e.DNE(7,F,11,4,"ion-card",17),e.j41(8,"ion-item"),e.nrm(9,"ion-icon",18)(10,"ion-input",19),e.k0s(),e.j41(11,"ion-item"),e.nrm(12,"ion-icon",18)(13,"ion-input",20),e.k0s(),e.j41(14,"ion-item"),e.nrm(15,"ion-textarea",21),e.k0s(),e.j41(16,"ion-button",22),e.DNE(17,D,1,0,"ion-spinner",23),e.EFF(18),e.k0s()()()()}if(2&i){const a=e.XpG();e.R7$(2),e.Y8G("formGroup",a.leaveForm),e.R7$(4),e.Y8G("ngForOf",a.availableLeaveTypes),e.R7$(),e.Y8G("ngIf",a.selectedLeaveBalance),e.R7$(9),e.Y8G("disabled",a.isLoading||0===a.availableLeaveTypes.length),e.R7$(),e.Y8G("ngIf",a.isLoading),e.R7$(),e.SpI(" ",a.isLoading?"Submitting...":"Submit Request"," ")}}let I=(()=>{class i{constructor(a,n,t,l,_){this.fb=a,this.leaveService=n,this.router=t,this.toastController=l,this.alertController=_,this.isLoading=!1,this.isLoadingBalance=!0,this.leaveBalances=[],this.availableLeaveTypes=[],this.selectedLeaveBalance=null,(0,h.d)({calendarOutline:g.RXF,documentTextOutline:g.pXZ,informationCircleOutline:g.jdS}),this.leaveForm=this.fb.group({leaveType:["",s.k0.required],startDate:["",s.k0.required],endDate:["",s.k0.required],reason:["",[s.k0.required,s.k0.minLength(10)]]}),this.leaveForm.get("leaveType")?.valueChanges.subscribe(m=>{this.onLeaveTypeChange(m)})}ngOnInit(){this.loadLeaveBalance()}loadLeaveBalance(){var a=this;return(0,c.A)(function*(){var n;console.log("Loading leave balance..."),a.isLoadingBalance=!0,a.leaveService.getEmployeeLeaveBalance().subscribe({next:n=>{console.log("Leave balances loaded:",n),a.leaveBalances=n,0===n.length?a.promptInitializeBalance():a.availableLeaveTypes=n.map(t=>({id:t.leave_type_id,type_name:t.type_name,type_code:t.type_code,is_paid:t.is_paid,available_days:t.available_days,allocated_days:t.allocated_days})),a.isLoadingBalance=!1},error:(n=(0,c.A)(function*(t){console.error("Error loading leave balance:",t),a.isLoadingBalance=!1,404===t.status||t.error?.message?.includes("not found")?(yield a.showToast("Leave balance not initialized","warning"),a.promptInitializeBalance()):yield a.showToast("Failed to load leave balance","danger")}),function(l){return n.apply(this,arguments)})})})()}promptInitializeBalance(){var a=this;return(0,c.A)(function*(){yield(yield a.alertController.create({header:"Initialize Leave Balance",message:"Your leave balance has not been initialized. Would you like to initialize it now based on your leave plan?",buttons:[{text:"Cancel",role:"cancel"},{text:"Initialize",handler:()=>{a.initializeBalance()}}]})).present()})()}initializeBalance(){var a=this;return(0,c.A)(function*(){const n=yield a.showLoading("Initializing leave balance...");var t;a.leaveService.initializeLeaveBalance().subscribe({next:(t=(0,c.A)(function*(l){console.log("Balance initialized:",l),n.dismiss(),yield a.showToast(l.message||"Leave balance initialized successfully","success"),a.loadLeaveBalance()}),function(_){return t.apply(this,arguments)}),error:function(){var t=(0,c.A)(function*(l){console.error("Error initializing balance:",l),n.dismiss(),yield a.showToast(l.error?.error||"Failed to initialize leave balance","danger")});return function(_){return t.apply(this,arguments)}}()})})()}onLeaveTypeChange(a){a?(this.selectedLeaveBalance=this.leaveBalances.find(n=>n.leave_type_id===a)||null,console.log("Selected leave balance:",this.selectedLeaveBalance)):this.selectedLeaveBalance=null}showLoading(a){var n=this;return(0,c.A)(function*(){const t=yield n.alertController.create({message:a,backdropDismiss:!1});return yield t.present(),t})()}onSubmit(){var a=this;return(0,c.A)(function*(){if(a.leaveForm.invalid)return void(yield a.showToast("Please fill all required fields","warning"));const n=a.leaveForm.value,t=new Date(n.startDate),l=new Date(n.endDate),_=Math.ceil((l.getTime()-t.getTime())/864e5)+1;if(a.selectedLeaveBalance&&_>a.selectedLeaveBalance.available_days)return void(yield a.showToast(`Insufficient balance! You have ${a.selectedLeaveBalance.available_days} days available for ${a.selectedLeaveBalance.type_name}`,"warning"));a.isLoading=!0;const m={leave_type_id:n.leaveType,start_date:n.startDate,end_date:n.endDate,number_of_days:_,reason:n.reason};var p;console.log("Submitting leave request:",m),a.leaveService.requestLeave(m).subscribe({next:(p=(0,c.A)(function*(u){console.log("Leave request submitted:",u),a.isLoading=!1,yield a.showToast(u.message||"Leave request submitted successfully!","success"),a.router.navigate(["/tabs/leaves"])}),function(C){return p.apply(this,arguments)}),error:function(){var p=(0,c.A)(function*(u){console.error("Error submitting leave:",u),a.isLoading=!1,yield a.showToast(u.error?.error||"Failed to submit leave request","danger")});return function(C){return p.apply(this,arguments)}}()})})()}showToast(a,n){var t=this;return(0,c.A)(function*(){(yield t.toastController.create({message:a,duration:3e3,color:n,position:"top"})).present()})()}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(s.ok),e.rXU(y.P),e.rXU(b.Ix),e.rXU(o.K_),e.rXU(o.hG))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-leave-request"]],standalone:!0,features:[e.aNF],decls:11,vars:4,consts:[["slot","start"],["defaultHref","/tabs/leaves"],[3,"fullscreen"],[1,"page-content"],[4,"ngIf"],[1,"loading-state"],["name","crescent","color","primary"],[2,"margin-top","0"],["lines","none",4,"ngFor","ngForOf"],["lines","none"],[2,"color","var(--ion-color-medium)","font-size","0.9em"],[2,"color","var(--ion-color-success)","font-weight","600"],["slot","end",3,"color"],[3,"ngSubmit","formGroup"],["name","document-text-outline","slot","start"],["label","Leave Type","labelPlacement","floating","formControlName","leaveType","placeholder","Select leave type"],[3,"value",4,"ngFor","ngForOf"],["color","light","style","margin: 12px 0;",4,"ngIf"],["name","calendar-outline","slot","start"],["label","Start Date","labelPlacement","floating","type","date","formControlName","startDate"],["label","End Date","labelPlacement","floating","type","date","formControlName","endDate"],["label","Reason","labelPlacement","floating","formControlName","reason","rows","4","placeholder","Enter reason for leave (minimum 10 characters)"],["expand","block","type","submit",1,"submit-button",3,"disabled"],["name","crescent","style","margin-right: 8px;",4,"ngIf"],[3,"value"],["color","light",2,"margin","12px 0"],[2,"padding","12px"],[2,"display","flex","align-items","center","gap","8px"],["name","information-circle-outline","color","primary"],[2,"color","var(--ion-color-medium)"],["name","crescent",2,"margin-right","8px"]],template:function(n,t){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-back-button",1),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Request Leave"),e.k0s()()(),e.j41(6,"ion-content",2)(7,"div",3),e.DNE(8,L,5,0,"ion-card",4)(9,R,6,1,"ion-card",4)(10,x,19,6,"ion-card",4),e.k0s()()),2&n&&(e.R7$(6),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("ngIf",t.isLoadingBalance),e.R7$(),e.Y8G("ngIf",!t.isLoadingBalance&&t.leaveBalances.length>0),e.R7$(),e.Y8G("ngIf",!t.isLoadingBalance))},dependencies:[v.MD,v.Sq,v.bT,s.X1,s.qT,s.BC,s.cb,s.j4,s.JD,o.W9,o.eU,o.BC,o.ai,o.QW,o.el,o.b_,o.I9,o.uz,o.he,o.$w,o.nc,o.Nm,o.Ip,o.Jm,o.iq,o.In,o.w2,o.nf],styles:[".page-content[_ngcontent-%COMP%]{padding:1rem;max-width:800px;margin:0 auto}ion-card[_ngcontent-%COMP%]{box-shadow:var(--shadow-md)}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:1.5rem}ion-item[_ngcontent-%COMP%]{--padding-start: 0;margin-bottom:1rem;--background: transparent;--border-color: var(--border-color)}.submit-button[_ngcontent-%COMP%]{margin-top:1.5rem;height:48px;font-weight:600;--box-shadow: var(--shadow-sm)}"]})}}return i})()}}]);