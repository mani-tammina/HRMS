"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8973],{8973:(I,u,r)=>{r.r(u),r.d(u,{ClientTimesheetVerificationPage:()=>M});var _=r(467),m=r(177),o=r(7820),h=r(4341),p=r(2951),l=r(5873),g=r(5312),e=r(4438),f=r(3799),F=r(4086);function T(i,s){1&i&&(e.j41(0,"div",5)(1,"p"),e.EFF(2,"Loading timesheet details..."),e.k0s()())}function v(i,s){if(1&i&&(e.j41(0,"ion-item")(1,"ion-label")(2,"h3"),e.EFF(3,"Total Work Update Hours"),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s()()()),2&i){const t=e.XpG(3);e.R7$(5),e.SpI("",t.summary.totalWorkUpdateHours," hours")}}function k(i,s){if(1&i&&(e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3,"Summary"),e.k0s()(),e.j41(4,"ion-card-content")(5,"ion-list")(6,"ion-item")(7,"ion-label")(8,"h3"),e.EFF(9,"Total Working Days"),e.k0s(),e.j41(10,"p"),e.EFF(11),e.k0s()()(),e.j41(12,"ion-item")(13,"ion-label")(14,"h3"),e.EFF(15,"Total Internal Hours (Project Timesheets)"),e.k0s(),e.j41(16,"p"),e.EFF(17),e.k0s()()(),e.DNE(18,v,6,1,"ion-item",4),e.k0s()()()),2&i){const t=e.XpG(2);e.R7$(11),e.SpI("",t.summary.totalDays," days"),e.R7$(6),e.SpI("",t.summary.totalInternalHours," hours"),e.R7$(),e.Y8G("ngIf",t.summary.totalWorkUpdateHours>0)}}function C(i,s){if(1&i&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.nI1(3,"date"),e.k0s(),e.j41(4,"td"),e.EFF(5),e.k0s(),e.j41(6,"td"),e.EFF(7),e.k0s()()),2&i){const t=s.$implicit;e.R7$(2),e.JRh(e.i5U(3,3,t.date,"mediumDate")),e.R7$(3),e.JRh(t.total_hours),e.R7$(2),e.JRh(t.status)}}function E(i,s){if(1&i&&(e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.nrm(3,"ion-icon",15),e.EFF(4," Project Timesheets (Internal) "),e.k0s(),e.j41(5,"ion-card-subtitle"),e.EFF(6),e.k0s()(),e.j41(7,"ion-card-content")(8,"div",16)(9,"table",17)(10,"thead")(11,"tr")(12,"th"),e.EFF(13,"Date"),e.k0s(),e.j41(14,"th"),e.EFF(15,"Hours"),e.k0s(),e.j41(16,"th"),e.EFF(17,"Status"),e.k0s()()(),e.j41(18,"tbody"),e.DNE(19,C,8,6,"tr",18),e.k0s()()()()()),2&i){const t=e.XpG(2);e.R7$(6),e.SpI("",t.projectTimesheets.length," day(s)"),e.R7$(13),e.Y8G("ngForOf",t.projectTimesheets)}}function j(i,s){if(1&i&&(e.j41(0,"ion-item")(1,"ion-label")(2,"h3"),e.EFF(3),e.nI1(4,"date"),e.k0s(),e.j41(5,"p")(6,"strong"),e.EFF(7,"Hours:"),e.k0s(),e.EFF(8),e.k0s(),e.j41(9,"p")(10,"strong"),e.EFF(11,"Shift:"),e.k0s(),e.EFF(12),e.k0s(),e.j41(13,"p",20),e.EFF(14),e.k0s()()()),2&i){const t=s.$implicit;e.R7$(3),e.JRh(e.i5U(4,5,t.update_date,"mediumDate")),e.R7$(5),e.SpI(" ",t.hours_worked,""),e.R7$(4),e.Lme(" ",t.shift_start_time," - ",t.shift_end_time,""),e.R7$(2),e.JRh(t.work_description)}}function P(i,s){if(1&i&&(e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.nrm(3,"ion-icon",19),e.EFF(4," Work Updates "),e.k0s(),e.j41(5,"ion-card-subtitle"),e.EFF(6),e.k0s()(),e.j41(7,"ion-card-content")(8,"ion-list"),e.DNE(9,j,15,8,"ion-item",18),e.k0s()()()),2&i){const t=e.XpG(2);e.R7$(6),e.SpI("",t.workUpdates.length," update(s)"),e.R7$(3),e.Y8G("ngForOf",t.workUpdates)}}function x(i,s){if(1&i&&(e.j41(0,"ion-note"),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" Previous notes: ",t.clientTimesheet.verification_notes," ")}}function b(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-content")(2,"div",21)(3,"ion-button",22),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.verify())}),e.nrm(4,"ion-icon",23),e.EFF(5," Verify & Approve "),e.k0s(),e.j41(6,"ion-button",24),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.reject())}),e.nrm(7,"ion-icon",25),e.EFF(8," Reject "),e.k0s()()()()}}function O(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-content")(2,"p",26),e.nrm(3,"ion-icon",27),e.EFF(4," This timesheet has been verified "),e.k0s(),e.j41(5,"ion-button",28),e.bIt("click",function(){e.eBV(t);const n=e.XpG(2);return e.Njj(n.goBack())}),e.EFF(6," Back to Queue "),e.k0s()()()}}function R(i,s){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e.nrm(4,"ion-icon",6),e.EFF(5),e.k0s(),e.j41(6,"ion-card-subtitle"),e.EFF(7),e.k0s()(),e.j41(8,"ion-card-content")(9,"ion-list")(10,"ion-item")(11,"ion-label")(12,"h3"),e.EFF(13,"Client"),e.k0s(),e.j41(14,"p"),e.EFF(15),e.k0s()()(),e.j41(16,"ion-item")(17,"ion-label")(18,"h3"),e.EFF(19,"Period"),e.k0s(),e.j41(20,"p"),e.EFF(21),e.k0s()()(),e.j41(22,"ion-item")(23,"ion-label")(24,"h3"),e.EFF(25,"Uploaded File"),e.k0s(),e.j41(26,"p"),e.EFF(27),e.k0s(),e.j41(28,"p",7),e.EFF(29),e.nI1(30,"date"),e.k0s()(),e.j41(31,"ion-button",8),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.downloadFile())}),e.nrm(32,"ion-icon",9),e.EFF(33," Download "),e.k0s()(),e.j41(34,"ion-item")(35,"ion-label")(36,"h3"),e.EFF(37,"Status"),e.k0s(),e.j41(38,"p"),e.EFF(39),e.k0s()()()()()(),e.j41(40,"ion-card")(41,"ion-card-header")(42,"ion-card-title"),e.nrm(43,"ion-icon",10),e.EFF(44," Client Timesheet File "),e.k0s()(),e.j41(45,"ion-card-content")(46,"div",11)(47,"p"),e.EFF(48,"Click the button below to open and review the client timesheet:"),e.k0s(),e.j41(49,"ion-button",12),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.downloadFile())}),e.nrm(50,"ion-icon",13),e.EFF(51," Open Client Timesheet File "),e.k0s()()()(),e.DNE(52,k,19,3,"ion-card",4)(53,E,20,2,"ion-card",4)(54,P,10,2,"ion-card",4),e.j41(55,"ion-card")(56,"ion-card-header")(57,"ion-card-title"),e.EFF(58,"Verification Notes"),e.k0s()(),e.j41(59,"ion-card-content")(60,"ion-textarea",14),e.mxI("ngModelChange",function(n){e.eBV(t);const c=e.XpG();return e.DH7(c.verificationNotes,n)||(c.verificationNotes=n),e.Njj(n)}),e.k0s(),e.DNE(61,x,2,1,"ion-note",4),e.k0s()(),e.DNE(62,b,9,0,"ion-card",4)(63,O,7,0,"ion-card",4),e.k0s()}if(2&i){const t=e.XpG();e.R7$(5),e.Lme(" ",t.clientTimesheet.first_name," ",t.clientTimesheet.last_name," "),e.R7$(2),e.Lme(" ",t.clientTimesheet.employee_code," \u2022 ",t.clientTimesheet.project_name," "),e.R7$(8),e.JRh(t.clientTimesheet.client_name),e.R7$(6),e.Lme("",null==t.summary?null:t.summary.month,"/",null==t.summary?null:t.summary.year,""),e.R7$(6),e.JRh(t.clientTimesheet.file_name),e.R7$(2),e.Lme("",(t.clientTimesheet.file_size/1024).toFixed(2)," KB \u2022 ",e.i5U(30,23,t.clientTimesheet.uploaded_at,"short"),""),e.R7$(9),e.AVh("text-success",t.clientTimesheet.is_verified)("text-warning",!t.clientTimesheet.is_verified),e.R7$(),e.SpI(" ",t.clientTimesheet.is_verified?"Verified":"Pending Verification"," "),e.R7$(13),e.Y8G("ngIf",t.summary),e.R7$(),e.Y8G("ngIf",t.projectTimesheets.length>0),e.R7$(),e.Y8G("ngIf",t.workUpdates.length>0),e.R7$(6),e.R50("ngModel",t.verificationNotes),e.Y8G("readonly",t.clientTimesheet.is_verified),e.R7$(),e.Y8G("ngIf",t.clientTimesheet.verification_notes),e.R7$(),e.Y8G("ngIf",!t.clientTimesheet.is_verified),e.R7$(),e.Y8G("ngIf",t.clientTimesheet.is_verified)}}let M=(()=>{class i{constructor(t,a,n,c,d,y){this.route=t,this.router=a,this.adminTimesheetService=n,this.toastController=c,this.loadingController=d,this.alertController=y,this.clientTimesheetId=0,this.clientTimesheet=null,this.projectTimesheets=[],this.workUpdates=[],this.summary=null,this.verificationNotes="",this.isLoading=!1,(0,p.d)({documentTextOutline:l.pXZ,checkmarkCircleOutline:l.gz2,closeCircleOutline:l.p9N,downloadOutline:l.fPB,calendarOutline:l.RXF,timeOutline:l.CVk,personOutline:l.wAZ})}ngOnInit(){this.clientTimesheetId=Number(this.route.snapshot.paramMap.get("id")),this.loadDetails()}loadDetails(){this.isLoading=!0,this.adminTimesheetService.getClientTimesheetDetails(this.clientTimesheetId).subscribe({next:t=>{this.clientTimesheet=t.clientTimesheet,this.projectTimesheets=t.projectTimesheets,this.workUpdates=t.workUpdates,this.summary=t.summary,this.verificationNotes=this.clientTimesheet.verification_notes||"",this.isLoading=!1},error:t=>{console.error("Error loading details:",t),this.showToast("Failed to load timesheet details","danger"),this.isLoading=!1}})}getFileUrl(){return`${g.c.apiUrl.replace("/api","")}/${this.clientTimesheet.file_path.replace(/\\/g,"/")}`}downloadFile(){window.open(this.getFileUrl(),"_blank")}verify(){var t=this;return(0,_.A)(function*(){yield(yield t.alertController.create({header:"Verify Client Timesheet",message:"Confirm that this client timesheet has been reviewed and verified?",inputs:[{name:"notes",type:"textarea",placeholder:"Add verification notes (optional)",value:t.verificationNotes}],buttons:[{text:"Cancel",role:"cancel"},{text:"Verify",handler:n=>t.executeVerification(!0,n.notes)}]})).present()})()}reject(){var t=this;return(0,_.A)(function*(){yield(yield t.alertController.create({header:"Reject Client Timesheet",message:"Please provide a reason for rejection:",inputs:[{name:"notes",type:"textarea",placeholder:"Reason for rejection (required)",value:t.verificationNotes,attributes:{required:!0}}],buttons:[{text:"Cancel",role:"cancel"},{text:"Reject",cssClass:"danger",handler:n=>n.notes&&n.notes.trim()?t.executeVerification(!1,n.notes):(t.showToast("Please provide a reason for rejection","warning"),!1)}]})).present()})()}executeVerification(t,a){var n=this;return(0,_.A)(function*(){const c=yield n.loadingController.create({message:t?"Verifying...":"Rejecting..."});yield c.present(),n.adminTimesheetService.verifyClientTimesheet({clientTimesheetId:n.clientTimesheetId,isVerified:t,notes:a}).subscribe({next:d=>{c.dismiss(),n.showToast(d.message,"success"),n.router.navigate(["/verification-queue"])},error:d=>{c.dismiss(),console.error("Error verifying timesheet:",d),n.showToast("Failed to update verification status","danger")}})})()}showToast(t){var a=this;return(0,_.A)(function*(n,c="primary"){yield(yield a.toastController.create({message:n,duration:3e3,position:"top",color:c})).present()}).apply(this,arguments)}goBack(){this.router.navigate(["/verification-queue"])}static{this.\u0275fac=function(a){return new(a||i)(e.rXU(f.nX),e.rXU(f.Ix),e.rXU(F.p),e.rXU(o.K_),e.rXU(o.Xi),e.rXU(o.hG))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-client-timesheet-verification"]],standalone:!0,features:[e.aNF],decls:9,vars:2,consts:[["color","primary"],["slot","start"],["defaultHref","/verification-queue"],["class","loading-container",4,"ngIf"],[4,"ngIf"],[1,"loading-container"],["name","person-outline"],[1,"file-info"],["slot","end","fill","outline","size","small",3,"click"],["name","download-outline"],["name","document-text-outline"],[1,"file-preview"],["expand","block","color","secondary",3,"click"],["name","download-outline","slot","start"],["placeholder","Add notes about the verification...","rows","4",3,"ngModelChange","ngModel","readonly"],["name","calendar-outline"],[1,"table-container"],[1,"timesheet-table"],[4,"ngFor","ngForOf"],["name","time-outline"],[1,"description"],[1,"action-buttons"],["expand","block","color","success",3,"click"],["name","checkmark-circle-outline","slot","start"],["expand","block","color","danger",3,"click"],["name","close-circle-outline","slot","start"],[1,"text-center","text-success"],["name","checkmark-circle-outline"],["expand","block","fill","outline",3,"click"]],template:function(a,n){1&a&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Client Timesheet Verification"),e.k0s()()(),e.j41(6,"ion-content"),e.DNE(7,T,3,0,"div",3)(8,R,64,26,"div",4),e.k0s()),2&a&&(e.R7$(7),e.Y8G("ngIf",n.isLoading),e.R7$(),e.Y8G("ngIf",!n.isLoading&&n.clientTimesheet))},dependencies:[m.MD,m.Sq,m.bT,m.vh,h.YN,h.BC,h.vS,o.W9,o.eU,o.BC,o.ai,o.QW,o.el,o.b_,o.I9,o.ME,o.tN,o.HW,o.Jm,o.iq,o.nf,o.uz,o.he,o.nc,o.JI],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:200px}.file-info[_ngcontent-%COMP%]{font-size:.85em;color:var(--ion-color-medium);margin-top:4px}.text-success[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:500}.text-warning[_ngcontent-%COMP%]{color:var(--ion-color-warning);font-weight:500}.text-center[_ngcontent-%COMP%]{text-align:center;padding:16px;font-size:1.1em}.text-center[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:2em;vertical-align:middle;margin-right:8px}.file-preview[_ngcontent-%COMP%]{padding:16px 0}.file-preview[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:16px}.table-container[_ngcontent-%COMP%]{overflow-x:auto;margin:16px 0}.timesheet-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.timesheet-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background:var(--ion-color-light)}.timesheet-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:12px 8px;text-align:left;font-weight:600;border-bottom:2px solid var(--ion-color-medium)}.timesheet-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-bottom:1px solid var(--ion-color-light)}.timesheet-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:var(--ion-color-light)}.timesheet-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px 8px}.description[_ngcontent-%COMP%]{white-space:pre-wrap;margin-top:8px;color:var(--ion-color-medium-shade)}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}"]})}}return i})()}}]);