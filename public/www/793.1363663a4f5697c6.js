"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[793],{1793:(S,m,r)=>{r.r(m),r.d(m,{AdminPayrollPage:()=>D});var g=r(467),_=r(177),u=r(4341),l=r(7843),f=r(2951),d=r(5873),e=r(4438),h=r(2061),y=r(8010);function P(o,s){if(1&o){const n=e.RV6();e.j41(0,"ion-button",15),e.bIt("click",function(){e.eBV(n);const t=e.XpG(2);return e.Njj(t.saveDefaults())}),e.nrm(1,"ion-icon",16),e.EFF(2," Save Defaults "),e.k0s()}}function M(o,s){if(1&o){const n=e.RV6();e.j41(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e.EFF(4,"Payroll Defaults"),e.k0s()(),e.j41(5,"ion-card-content")(6,"ion-list")(7,"ion-item")(8,"ion-label",12),e.EFF(9,"PF Percentage (%)"),e.k0s(),e.j41(10,"ion-input",13),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.defaults.pf_percent,t)||(i.defaults.pf_percent=t),e.Njj(t)}),e.k0s()(),e.j41(11,"ion-item")(12,"ion-label",12),e.EFF(13,"ESI Percentage (%)"),e.k0s(),e.j41(14,"ion-input",13),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.defaults.esi_percent,t)||(i.defaults.esi_percent=t),e.Njj(t)}),e.k0s()(),e.j41(15,"ion-item")(16,"ion-label",12),e.EFF(17,"Professional Tax (Rs)"),e.k0s(),e.j41(18,"ion-input",13),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.defaults.professional_tax,t)||(i.defaults.professional_tax=t),e.Njj(t)}),e.k0s()(),e.j41(19,"ion-item")(20,"ion-label",12),e.EFF(21,"Variable Pay Percentage (%)"),e.k0s(),e.j41(22,"ion-input",13),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.defaults.variable_pay_percent,t)||(i.defaults.variable_pay_percent=t),e.Njj(t)}),e.k0s()()(),e.DNE(23,P,3,0,"ion-button",14),e.k0s()()()}if(2&o){const n=e.XpG();e.R7$(10),e.R50("ngModel",n.defaults.pf_percent),e.Y8G("readonly",!n.isAdmin),e.R7$(4),e.R50("ngModel",n.defaults.esi_percent),e.Y8G("readonly",!n.isAdmin),e.R7$(4),e.R50("ngModel",n.defaults.professional_tax),e.Y8G("readonly",!n.isAdmin),e.R7$(4),e.R50("ngModel",n.defaults.variable_pay_percent),e.Y8G("readonly",!n.isAdmin),e.R7$(),e.Y8G("ngIf",n.isAdmin)}}function v(o,s){if(1&o&&(e.j41(0,"ion-select-option",21),e.EFF(1),e.k0s()),2&o){const n=s.$implicit;e.Y8G("value",n.value),e.R7$(),e.SpI(" ",n.name," ")}}function C(o,s){if(1&o&&(e.j41(0,"ion-select-option",21),e.EFF(1),e.k0s()),2&o){const n=s.$implicit;e.Y8G("value",n),e.R7$(),e.SpI(" ",n," ")}}function F(o,s){if(1&o){const n=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3,"Generate New Payroll"),e.k0s()(),e.j41(4,"ion-card-content")(5,"ion-item")(6,"ion-label"),e.EFF(7,"Month"),e.k0s(),e.j41(8,"ion-select",18),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG(2);return e.DH7(i.selectedMonth,t)||(i.selectedMonth=t),e.Njj(t)}),e.DNE(9,v,2,2,"ion-select-option",19),e.k0s()(),e.j41(10,"ion-item")(11,"ion-label"),e.EFF(12,"Year"),e.k0s(),e.j41(13,"ion-select",18),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG(2);return e.DH7(i.selectedYear,t)||(i.selectedYear=t),e.Njj(t)}),e.DNE(14,C,2,2,"ion-select-option",19),e.k0s()(),e.j41(15,"ion-button",15),e.bIt("click",function(){e.eBV(n);const t=e.XpG(2);return e.Njj(t.generatePayroll())}),e.nrm(16,"ion-icon",20),e.EFF(17," Generate Payroll "),e.k0s()()()}if(2&o){const n=e.XpG(2);e.R7$(8),e.R50("ngModel",n.selectedMonth),e.R7$(),e.Y8G("ngForOf",n.months),e.R7$(4),e.R50("ngModel",n.selectedYear),e.R7$(),e.Y8G("ngForOf",n.years)}}function E(o,s){1&o&&(e.j41(0,"div",22),e.nrm(1,"ion-spinner",23),e.j41(2,"p"),e.EFF(3,"Loading payroll runs..."),e.k0s()())}function R(o,s){if(1&o&&(e.j41(0,"ion-card")(1,"ion-card-header")(2,"div",25)(3,"div")(4,"ion-card-title"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.k0s()(),e.j41(8,"ion-badge",26),e.EFF(9),e.k0s()()(),e.j41(10,"ion-card-content")(11,"div",27)(12,"div",28)(13,"span",29),e.EFF(14,"Employees:"),e.k0s(),e.j41(15,"span",30),e.EFF(16),e.k0s()(),e.j41(17,"div",28)(18,"span",29),e.EFF(19,"Total Gross:"),e.k0s(),e.j41(20,"span",30),e.EFF(21),e.nI1(22,"number"),e.k0s()(),e.j41(23,"div",28)(24,"span",29),e.EFF(25,"Total Net:"),e.k0s(),e.j41(26,"span",30),e.EFF(27),e.nI1(28,"number"),e.k0s()()(),e.j41(29,"p",31),e.EFF(30),e.nI1(31,"date"),e.k0s()()()),2&o){const n=s.$implicit,a=e.XpG(3);e.R7$(5),e.Lme("",a.getMonthName(n.payroll_month)," ",n.payroll_year,""),e.R7$(2),e.SpI("Run ID: #",n.id,""),e.R7$(),e.Y8G("color",a.getRunStatusColor(n.status)),e.R7$(),e.JRh(n.status),e.R7$(7),e.JRh(n.total_employees),e.R7$(5),e.SpI("Rs ",e.bMT(22,9,n.total_gross),""),e.R7$(6),e.SpI("Rs ",e.bMT(28,11,n.total_net),""),e.R7$(3),e.SpI("Generated: ",e.bMT(31,13,n.generated_at),"")}}function x(o,s){if(1&o&&(e.j41(0,"ion-list"),e.DNE(1,R,32,15,"ion-card",24),e.k0s()),2&o){const n=e.XpG(2);e.R7$(),e.Y8G("ngForOf",n.payrollRuns)}}function O(o,s){1&o&&(e.j41(0,"ion-card")(1,"ion-card-content",32),e.nrm(2,"ion-icon",33),e.j41(3,"h3"),e.EFF(4,"No Payroll Runs"),e.k0s(),e.j41(5,"p"),e.EFF(6,"No payroll runs found"),e.k0s()()())}function b(o,s){if(1&o&&(e.j41(0,"div"),e.DNE(1,F,18,4,"ion-card",11)(2,E,4,0,"div",17)(3,x,2,1,"ion-list",11)(4,O,7,0,"ion-card",11),e.k0s()),2&o){const n=e.XpG();e.R7$(),e.Y8G("ngIf",n.isAdmin),e.R7$(),e.Y8G("ngIf",n.isLoading),e.R7$(),e.Y8G("ngIf",!n.isLoading&&n.payrollRuns.length>0),e.R7$(),e.Y8G("ngIf",!n.isLoading&&0===n.payrollRuns.length)}}function j(o,s){1&o&&(e.j41(0,"div",22),e.nrm(1,"ion-spinner",23),e.j41(2,"p"),e.EFF(3,"Loading salary slips..."),e.k0s()())}function k(o,s){if(1&o&&(e.j41(0,"ion-card")(1,"ion-card-header")(2,"div",34)(3,"div")(4,"ion-card-title"),e.EFF(5),e.k0s(),e.j41(6,"p"),e.EFF(7),e.k0s()(),e.j41(8,"ion-badge",26),e.EFF(9),e.k0s()()(),e.j41(10,"ion-card-content")(11,"div",35)(12,"div",36)(13,"span",29),e.EFF(14,"Gross:"),e.k0s(),e.j41(15,"span",30),e.EFF(16),e.nI1(17,"number"),e.k0s()(),e.j41(18,"div",36)(19,"span",29),e.EFF(20,"Deductions:"),e.k0s(),e.j41(21,"span",37),e.EFF(22),e.nI1(23,"number"),e.k0s()(),e.j41(24,"div",38)(25,"span",29)(26,"strong"),e.EFF(27,"Net:"),e.k0s()(),e.j41(28,"span",30)(29,"strong"),e.EFF(30),e.nI1(31,"number"),e.k0s()()()()()()),2&o){const n=s.$implicit,a=e.XpG(3);e.R7$(5),e.JRh(n.employee_name),e.R7$(2),e.E5c("",n.employee_code," - ",a.getMonthName(n.month)," ",n.year,""),e.R7$(),e.Y8G("color",a.getRunStatusColor(n.status)),e.R7$(),e.JRh(n.status),e.R7$(7),e.SpI("Rs ",e.bMT(17,9,n.gross_salary),""),e.R7$(6),e.SpI("-Rs ",e.bMT(23,11,n.total_deductions),""),e.R7$(8),e.SpI("Rs ",e.bMT(31,13,n.net_salary),"")}}function A(o,s){if(1&o&&(e.j41(0,"ion-list"),e.DNE(1,k,32,15,"ion-card",24),e.k0s()),2&o){const n=e.XpG(2);e.R7$(),e.Y8G("ngForOf",n.allSlips)}}function I(o,s){1&o&&(e.j41(0,"ion-card")(1,"ion-card-content",32),e.nrm(2,"ion-icon",33),e.j41(3,"h3"),e.EFF(4,"No Salary Slips"),e.k0s(),e.j41(5,"p"),e.EFF(6,"No salary slips found"),e.k0s()()())}function T(o,s){if(1&o&&(e.j41(0,"div"),e.DNE(1,j,4,0,"div",17)(2,A,2,1,"ion-list",11)(3,I,7,0,"ion-card",11),e.k0s()),2&o){const n=e.XpG();e.R7$(),e.Y8G("ngIf",n.isLoading),e.R7$(),e.Y8G("ngIf",!n.isLoading&&n.allSlips.length>0),e.R7$(),e.Y8G("ngIf",!n.isLoading&&0===n.allSlips.length)}}let D=(()=>{class o{constructor(n,a,t,i,c){this.payrollService=n,this.authService=a,this.alertController=t,this.toastController=i,this.loadingController=c,this.segment="defaults",this.isLoading=!1,this.isAdmin=!1,this.isHR=!1,this.defaults={pf_percent:12,esi_percent:.75,professional_tax:200,variable_pay_percent:10},this.payrollRuns=[],this.selectedMonth=(new Date).getMonth()+1,this.selectedYear=(new Date).getFullYear(),this.months=[{value:1,name:"January"},{value:2,name:"February"},{value:3,name:"March"},{value:4,name:"April"},{value:5,name:"May"},{value:6,name:"June"},{value:7,name:"July"},{value:8,name:"August"},{value:9,name:"September"},{value:10,name:"October"},{value:11,name:"November"},{value:12,name:"December"}],this.years=[],this.allSlips=[],(0,f.d)({settingsOutline:d.s8q,cashOutline:d.A3w,documentTextOutline:d.pXZ,playCircleOutline:d.xrt,checkmarkCircleOutline:d.gz2,downloadOutline:d.fPB,refreshOutline:d.mVv,saveOutline:d.oc8});const G=(new Date).getFullYear();for(let p=0;p<3;p++)this.years.push(G-p)}ngOnInit(){this.authService.currentUser$.subscribe(n=>{this.isAdmin="admin"===n?.role,this.isHR="hr"===n?.role}),this.loadData()}loadData(){"defaults"===this.segment?this.loadDefaults():"runs"===this.segment?this.loadPayrollRuns():"slips"===this.segment&&this.loadAllSlips()}onSegmentChange(n){this.segment=n.detail.value,this.loadData()}handleRefresh(n){this.loadData(),setTimeout(()=>n.target.complete(),1e3)}loadDefaults(){this.isLoading=!0,this.payrollService.getPayrollDefaults().subscribe({next:n=>{n&&n.id&&(this.defaults=n,this.defaultsId=n.id),this.isLoading=!1},error:n=>{console.error("Error loading defaults:",n),this.isLoading=!1,this.showToast("Error loading payroll defaults","danger")}})}saveDefaults(){var n=this;return(0,g.A)(function*(){if(!n.isAdmin)return void n.showToast("Only admins can update payroll defaults","warning");const a=yield n.loadingController.create({message:"Saving defaults..."});yield a.present(),(n.defaultsId?n.payrollService.updatePayrollDefaults(n.defaultsId,n.defaults):n.payrollService.createPayrollDefaults(n.defaults)).subscribe({next:i=>{a.dismiss(),!n.defaultsId&&i.id&&(n.defaultsId=i.id),n.showToast("Payroll defaults saved successfully","success")},error:i=>{a.dismiss(),console.error("Error saving defaults:",i),n.showToast("Error saving defaults","danger")}})})()}loadPayrollRuns(){this.isLoading=!0,this.payrollService.getAllPayrollRuns().subscribe({next:n=>{this.payrollRuns=n,this.isLoading=!1},error:n=>{console.error("Error loading payroll runs:",n),this.isLoading=!1,this.showToast("Error loading payroll runs","danger")}})}generatePayroll(){var n=this;return(0,g.A)(function*(){n.isAdmin?yield(yield n.alertController.create({header:"Generate Payroll",message:`Generate payroll for ${n.getMonthName(n.selectedMonth)} ${n.selectedYear}?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Generate",handler:()=>{n.executeGeneratePayroll()}}]})).present():n.showToast("Only admins can generate payroll","warning")})()}executeGeneratePayroll(){var n=this;return(0,g.A)(function*(){const a=yield n.loadingController.create({message:"Generating payroll..."});yield a.present(),n.payrollService.generatePayroll(n.selectedMonth,n.selectedYear).subscribe({next:t=>{a.dismiss(),n.showToast("Payroll generated successfully","success"),n.loadPayrollRuns()},error:t=>{a.dismiss(),console.error("Error generating payroll:",t),n.showToast(t.error?.error||"Error generating payroll","danger")}})})()}getRunStatusColor(n){switch(n?.toLowerCase()){case"paid":return"success";case"finalized":return"warning";default:return"medium"}}loadAllSlips(){this.isLoading=!0,this.payrollService.getAllPayslips().subscribe({next:n=>{this.allSlips=n.slips||[],this.isLoading=!1},error:n=>{console.error("Error loading slips:",n),this.isLoading=!1,this.showToast("Error loading salary slips","danger")}})}getMonthName(n){return this.months.find(a=>a.value===n)?.name||n.toString()}showToast(n){var a=this;return(0,g.A)(function*(t,i="success"){yield(yield a.toastController.create({message:t,duration:3e3,color:i,position:"top"})).present()}).apply(this,arguments)}static{this.\u0275fac=function(a){return new(a||o)(e.rXU(h.P),e.rXU(y.u),e.rXU(l.hG),e.rXU(l.K_),e.rXU(l.Xi))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-admin-payroll"]],standalone:!0,features:[e.aNF],decls:26,vars:4,consts:[["color","primary"],["slot","start"],["defaultHref","/admin/dashboard"],["slot","end"],[3,"click"],["slot","icon-only","name","refresh-outline"],[3,"ngModelChange","ionChange","ngModel"],["value","defaults"],["value","runs"],["value","slips"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],["position","stacked"],["type","number",3,"ngModelChange","ngModel","readonly"],["expand","block","class","ion-margin-top",3,"click",4,"ngIf"],["expand","block",1,"ion-margin-top",3,"click"],["name","save-outline","slot","start"],["class","loading-container",4,"ngIf"],["interface","popover",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["name","play-circle-outline","slot","start"],[3,"value"],[1,"loading-container"],["name","crescent","color","primary"],[4,"ngFor","ngForOf"],[1,"run-header"],[3,"color"],[1,"run-stats"],[1,"stat-item"],[1,"label"],[1,"value"],[1,"date-info"],[1,"empty-state"],["name","document-text-outline","size","large"],[1,"slip-header"],[1,"salary-details"],[1,"salary-row"],[1,"value","deduction"],[1,"salary-row","net"]],template:function(a,t){1&a&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Payroll Management"),e.k0s(),e.j41(6,"ion-buttons",3)(7,"ion-button",4),e.bIt("click",function(){return t.loadData()}),e.nrm(8,"ion-icon",5),e.k0s()()(),e.j41(9,"ion-toolbar")(10,"ion-segment",6),e.mxI("ngModelChange",function(c){return e.DH7(t.segment,c)||(t.segment=c),c}),e.bIt("ionChange",function(c){return t.onSegmentChange(c)}),e.j41(11,"ion-segment-button",7)(12,"ion-label"),e.EFF(13,"Settings"),e.k0s()(),e.j41(14,"ion-segment-button",8)(15,"ion-label"),e.EFF(16,"Runs"),e.k0s()(),e.j41(17,"ion-segment-button",9)(18,"ion-label"),e.EFF(19,"All Slips"),e.k0s()()()()(),e.j41(20,"ion-content")(21,"ion-refresher",10),e.bIt("ionRefresh",function(c){return t.handleRefresh(c)}),e.nrm(22,"ion-refresher-content"),e.k0s(),e.DNE(23,M,24,9,"div",11)(24,b,5,4,"div",11)(25,T,4,3,"div",11),e.k0s()),2&a&&(e.R7$(10),e.R50("ngModel",t.segment),e.R7$(13),e.Y8G("ngIf","defaults"===t.segment),e.R7$(),e.Y8G("ngIf","runs"===t.segment),e.R7$(),e.Y8G("ngIf","slips"===t.segment))},dependencies:[_.MD,_.Sq,_.bT,_.QX,_.vh,u.YN,u.BC,u.vS,l.W9,l.eU,l.BC,l.ai,l.QW,l.el,l.b_,l.I9,l.ME,l.tN,l.Gp,l.eP,l.nf,l.uz,l.he,l.In,l.Jm,l.iq,l.$w,l.To,l.Ki,l.w2,l.Nm,l.Ip],styles:[".loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 20px;text-align:center}.loading-container[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-bottom:16px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:80px;color:var(--ion-color-medium);margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:16px 0 8px;color:var(--ion-color-dark)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:0}.run-header[_ngcontent-%COMP%], .slip-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}.run-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], .slip-header[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex:1}.run-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%], .slip-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:18px;margin-bottom:4px}.run-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .slip-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium);margin:0}.run-stats[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}.run-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:4px 0}.run-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:14px}.run-stats[_ngcontent-%COMP%]   .stat-item[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500;font-size:14px}.date-info[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium);margin:8px 0 0}.salary-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.salary-details[_ngcontent-%COMP%]   .salary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:4px 0}.salary-details[_ngcontent-%COMP%]   .salary-row[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:14px}.salary-details[_ngcontent-%COMP%]   .salary-row[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{font-weight:500;font-size:14px}.salary-details[_ngcontent-%COMP%]   .salary-row[_ngcontent-%COMP%]   .value.deduction[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.salary-details[_ngcontent-%COMP%]   .salary-row.net[_ngcontent-%COMP%]{border-top:1px solid var(--ion-color-light);padding-top:8px;margin-top:4px}.salary-details[_ngcontent-%COMP%]   .salary-row.net[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{color:var(--ion-color-success);font-size:16px}"]})}}return o})()}}]);