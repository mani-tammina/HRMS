"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6087],{6087:(N,h,l)=>{l.r(h),l.d(h,{TeamCompliancePage:()=>G});var d=l(467),p=l(177),_=l(4341),a=l(7820),u=l(2951),m=l(5873),f=l(6233),e=l(4438),g=l(1626),C=l(5312);let v=(()=>{class i{constructor(n){this.http=n,this.apiUrl=`${C.c.apiUrl}/compliance`}getMyComplianceStatus(){return this.http.get(`${this.apiUrl}/my-status`)}getMyComplianceHistory(n,t){let o=new g.Nl;return n&&(o=o.set("start_date",n)),t&&(o=o.set("end_date",t)),this.http.get(`${this.apiUrl}/my-history`,{params:o})}getAdminDashboard(){return this.http.get(`${this.apiUrl}/admin/dashboard`)}getNonCompliantEmployees(n){let t=new g.Nl;return n&&(t=t.set("date",n)),this.http.get(`${this.apiUrl}/admin/non-compliant`,{params:t})}sendReminders(n,t){return this.http.post(`${this.apiUrl}/admin/send-reminders`,{date:n,employee_ids:t})}bulkApproveTimesheets(n,t){return this.http.post(`${this.apiUrl}/admin/bulk-approve`,{timesheet_ids:n,notes:t})}bulkValidateClientTimesheets(n){return this.http.post(`${this.apiUrl}/admin/bulk-validate-client-timesheets`,{validations:n})}closeMonth(n,t){return this.http.post(`${this.apiUrl}/admin/close-month`,{month:n,year:t})}reopenMonth(n,t,o){return this.http.post(`${this.apiUrl}/admin/reopen-month`,{month:n,year:t,reason:o})}getPeriodStatus(n,t){return this.http.get(`${this.apiUrl}/period-status/${n}/${t}`)}getMonthlyReport(n,t){let o=new g.Nl;return n&&(o=o.set("month",n.toString())),t&&(o=o.set("year",t.toString())),this.http.get(`${this.apiUrl}/admin/monthly-report`,{params:o})}static{this.\u0275fac=function(t){return new(t||i)(e.KVO(g.Qq))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var y=l(6119);function P(i,r){1&i&&e.nrm(0,"app-loading")}function T(i,r){if(1&i&&(e.j41(0,"ion-badge",30),e.EFF(1),e.k0s()),2&i){const n=e.XpG(3);e.R7$(),e.SpI(" ",n.nonCompliantEmployees.length," ")}}function x(i,r){if(1&i){const n=e.RV6();e.j41(0,"div",31)(1,"ion-button",32),e.bIt("click",function(){e.eBV(n);const o=e.XpG(3);return e.Njj(o.sendBulkReminders())}),e.nrm(2,"ion-icon",33),e.EFF(3),e.k0s()()}if(2&i){const n=e.XpG(3);e.R7$(3),e.SpI(" Send Reminders to All (",n.nonCompliantEmployees.length,") ")}}function M(i,r){if(1&i&&(e.j41(0,"span",40),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&i){const n=e.XpG(2).$implicit;e.R7$(),e.SpI(" Last: ",e.i5U(2,1,n.last_reminder_sent,"short")," ")}}function b(i,r){if(1&i&&(e.j41(0,"p",37)(1,"ion-badge",38),e.EFF(2),e.k0s(),e.DNE(3,M,3,4,"span",39),e.k0s()),2&i){const n=e.XpG().$implicit,t=e.XpG(4);e.R7$(),e.Y8G("color",t.getReminderBadgeColor(n.reminder_count)),e.R7$(),e.SpI(" ",n.reminder_count," reminder(s) sent "),e.R7$(),e.Y8G("ngIf",n.last_reminder_sent)}}function O(i,r){if(1&i){const n=e.RV6();e.j41(0,"ion-item")(1,"ion-label")(2,"h3"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s(),e.DNE(6,b,4,3,"p",35),e.k0s(),e.j41(7,"ion-button",36),e.bIt("click",function(){const o=e.eBV(n).$implicit,s=e.XpG(4);return e.Njj(s.sendReminder(o))}),e.nrm(8,"ion-icon",33),e.EFF(9," Remind "),e.k0s()()}if(2&i){const n=r.$implicit;e.R7$(3),e.JRh(n.name),e.R7$(2),e.Lme("",n.EmployeeNumber," \u2022 ",n.department,""),e.R7$(),e.Y8G("ngIf",n.reminder_count>0)}}function R(i,r){if(1&i&&(e.j41(0,"ion-list"),e.DNE(1,O,10,4,"ion-item",34),e.k0s()),2&i){const n=e.XpG(3);e.R7$(),e.Y8G("ngForOf",n.filteredEmployees)}}function k(i,r){1&i&&(e.j41(0,"p"),e.EFF(1,"All team members are compliant! \u{1f389}"),e.k0s())}function F(i,r){1&i&&(e.j41(0,"p"),e.EFF(1,"No matching employees found"),e.k0s())}function E(i,r){if(1&i&&(e.j41(0,"div",41),e.nrm(1,"ion-icon",42),e.DNE(2,k,2,0,"p",11)(3,F,2,0,"p",11),e.k0s()),2&i){const n=e.XpG(3);e.R7$(2),e.Y8G("ngIf",!n.searchTerm),e.R7$(),e.Y8G("ngIf",n.searchTerm)}}function $(i,r){if(1&i){const n=e.RV6();e.j41(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e.nrm(4,"ion-icon",14),e.EFF(5),e.nI1(6,"date"),e.k0s()(),e.j41(7,"ion-card-content")(8,"ion-grid")(9,"ion-row")(10,"ion-col",15)(11,"div",16)(12,"div",17),e.EFF(13),e.k0s(),e.j41(14,"div",18),e.EFF(15,"Total Team"),e.k0s()()(),e.j41(16,"ion-col",15)(17,"div",16)(18,"div",19),e.EFF(19),e.k0s(),e.j41(20,"div",18),e.nrm(21,"ion-icon",20),e.EFF(22," Pending "),e.k0s()()()()(),e.j41(23,"div",21)(24,"ion-button",22),e.nrm(25,"ion-icon",23),e.j41(26,"input",24),e.bIt("change",function(o){e.eBV(n);const s=e.XpG(2);return e.Njj(s.onDateChange(o))}),e.k0s()()()()(),e.j41(27,"ion-card")(28,"ion-card-header")(29,"ion-card-title"),e.nrm(30,"ion-icon",25),e.EFF(31," Non-Compliant Team Members "),e.DNE(32,T,2,1,"ion-badge",26),e.k0s()(),e.j41(33,"ion-card-content")(34,"ion-searchbar",27),e.mxI("ngModelChange",function(o){e.eBV(n);const s=e.XpG(2);return e.DH7(s.searchTerm,o)||(s.searchTerm=o),e.Njj(o)}),e.k0s(),e.DNE(35,x,4,1,"div",28)(36,R,2,1,"ion-list",11)(37,E,4,2,"div",29),e.k0s()()()}if(2&i){const n=e.XpG(2);e.R7$(5),e.SpI(" Team Compliance - ",e.i5U(6,9,n.selectedDate,"mediumDate")," "),e.R7$(8),e.JRh(n.todayStats.total),e.R7$(6),e.JRh(n.todayStats.pending),e.R7$(7),e.Y8G("value",n.selectedDate),e.R7$(6),e.Y8G("ngIf",n.nonCompliantEmployees.length>0),e.R7$(2),e.R50("ngModel",n.searchTerm),e.R7$(),e.Y8G("ngIf",n.nonCompliantEmployees.length>0),e.R7$(),e.Y8G("ngIf",n.filteredEmployees.length>0),e.R7$(),e.Y8G("ngIf",0===n.filteredEmployees.length)}}function S(i,r){if(1&i&&(e.j41(0,"ion-item")(1,"ion-label")(2,"h3"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s()(),e.j41(6,"ion-badge",45),e.EFF(7),e.k0s()()),2&i){const n=r.$implicit;e.R7$(3),e.JRh(n.name),e.R7$(2),e.JRh(n.department),e.R7$(2),e.SpI(" ",n.reminder_count||0," reminders ")}}function j(i,r){if(1&i&&(e.j41(0,"ion-list"),e.DNE(1,S,8,3,"ion-item",34),e.k0s()),2&i){const n=e.XpG(3);e.R7$(),e.Y8G("ngForOf",n.nonCompliantEmployees.slice(0,5))}}function I(i,r){if(1&i&&(e.j41(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e.nrm(4,"ion-icon",43),e.EFF(5),e.k0s()(),e.j41(6,"ion-card-content")(7,"div",44),e.nrm(8,"ion-icon",14),e.j41(9,"p"),e.EFF(10,"Detailed historical compliance data coming soon"),e.k0s()(),e.DNE(11,j,2,1,"ion-list",11),e.k0s()()()),2&i){const n=e.XpG(2);e.R7$(5),e.SpI(" ","week"===n.selectedSegment?"This Week":"This Month"," Summary "),e.R7$(6),e.Y8G("ngIf",n.nonCompliantEmployees.length>0)}}function D(i,r){if(1&i&&(e.j41(0,"div",13),e.DNE(1,$,38,12,"div",11)(2,I,12,2,"div",11),e.k0s()),2&i){const n=e.XpG();e.R7$(),e.Y8G("ngIf","today"===n.selectedSegment),e.R7$(),e.Y8G("ngIf","today"!==n.selectedSegment)}}let G=(()=>{class i{constructor(n,t,o,s){this.complianceService=n,this.errorHandler=t,this.alertController=o,this.toastController=s,this.isLoading=!0,this.selectedDate=(new Date).toISOString().split("T")[0],this.selectedSegment="today",this.nonCompliantEmployees=[],this.todayStats={total:0,submitted:0,pending:0,compliance_rate:0},this.teamHistory=[],this.searchTerm="",(0,u.d)({statsChartOutline:m.IEp,peopleOutline:m.wx_,checkmarkCircleOutline:m.gz2,alertCircleOutline:m.ndb,sendOutline:m.NF$,refreshOutline:m.mVv,calendarOutline:m.RXF,timeOutline:m.CVk})}ngOnInit(){this.loadData()}loadData(){"today"===this.selectedSegment?this.loadTodayCompliance():this.loadTeamHistory()}loadTodayCompliance(){var t,n=this;this.isLoading=!0,this.complianceService.getNonCompliantEmployees(this.selectedDate).subscribe({next:t=>{this.nonCompliantEmployees=t.employees||[];const o=t.employees?.length||0;this.todayStats={total:o,submitted:0,pending:o,compliance_rate:o>0?0/o*100:100},this.isLoading=!1},error:(t=(0,d.A)(function*(o){yield n.errorHandler.handleError(o,"Failed to load team compliance"),n.isLoading=!1}),function(s){return t.apply(this,arguments)})})}loadTeamHistory(){this.isLoading=!0;const n=new Date,t=new Date;"week"===this.selectedSegment?t.setDate(n.getDate()-7):"month"===this.selectedSegment&&t.setMonth(n.getMonth()-1),this.loadTodayCompliance()}handleRefresh(n){this.loadData(),setTimeout(()=>n.target.complete(),1e3)}onSegmentChange(){this.loadData()}onDateChange(n){this.selectedDate=n.detail.value,"today"===this.selectedSegment&&this.loadTodayCompliance()}sendReminder(n){var t=this;return(0,d.A)(function*(){yield(yield t.alertController.create({header:"Send Reminder",message:`Send timesheet reminder to ${n.name}?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Send",handler:()=>t.confirmSendReminder(n)}]})).present()})()}confirmSendReminder(n){var t=this;return(0,d.A)(function*(){try{yield t.complianceService.sendReminders(t.selectedDate,[n.id]).toPromise(),yield(yield t.toastController.create({message:`Reminder sent to ${n.name}`,duration:2e3,color:"success"})).present(),t.loadTodayCompliance()}catch(o){yield t.errorHandler.handleError(o,"Failed to send reminder")}})()}sendBulkReminders(){var n=this;return(0,d.A)(function*(){0!==n.nonCompliantEmployees.length&&(yield(yield n.alertController.create({header:"Send Bulk Reminders",message:`Send reminders to all ${n.nonCompliantEmployees.length} non-compliant team members?`,buttons:[{text:"Cancel",role:"cancel"},{text:"Send All",handler:()=>n.confirmBulkReminders()}]})).present())})()}confirmBulkReminders(){var n=this;return(0,d.A)(function*(){try{const t=n.nonCompliantEmployees.map(c=>c.id),o=yield n.complianceService.sendReminders(n.selectedDate,t).toPromise();yield(yield n.toastController.create({message:o.message||"Reminders sent successfully",duration:3e3,color:"success"})).present(),n.loadTodayCompliance()}catch(t){yield n.errorHandler.handleError(t,"Failed to send reminders")}})()}get filteredEmployees(){if(!this.searchTerm)return this.nonCompliantEmployees;const n=this.searchTerm.toLowerCase();return this.nonCompliantEmployees.filter(t=>t.name?.toLowerCase().includes(n)||t.EmployeeNumber?.toLowerCase().includes(n)||t.department?.toLowerCase().includes(n))}getComplianceRateColor(n){return n>=95?"success":n>=80?"warning":"danger"}getReminderBadgeColor(n){return 0===n?"medium":n<=2?"warning":"danger"}static{this.\u0275fac=function(t){return new(t||i)(e.rXU(v),e.rXU(y.c),e.rXU(a.hG),e.rXU(a.K_))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-team-compliance"]],standalone:!0,features:[e.aNF],decls:23,vars:5,consts:[[3,"translucent"],["color","primary"],["slot","end"],[3,"click"],["name","refresh-outline","slot","icon-only"],[3,"ngModelChange","ionChange","ngModel"],["value","today"],["value","week"],["value","month"],[3,"fullscreen"],["slot","fixed",3,"ionRefresh"],[4,"ngIf"],["class","content-container",4,"ngIf"],[1,"content-container"],["name","stats-chart-outline"],["size","6"],[1,"stat-box"],[1,"stat-value"],[1,"stat-label"],[1,"stat-value","danger"],["name","alert-circle-outline","color","danger"],[1,"date-picker"],["fill","outline","size","small"],["name","calendar-outline","slot","start"],["type","date",1,"date-input",3,"change","value"],["name","people-outline"],["color","danger",4,"ngIf"],["placeholder","Search by name, emp number, or department","debounce","300",3,"ngModelChange","ngModel"],["class","bulk-actions",4,"ngIf"],["class","empty-state",4,"ngIf"],["color","danger"],[1,"bulk-actions"],["expand","block",3,"click"],["name","send-outline","slot","start"],[4,"ngFor","ngForOf"],["class","reminder-info",4,"ngIf"],["slot","end","fill","outline","size","small",3,"click"],[1,"reminder-info"],[3,"color"],["class","last-reminder",4,"ngIf"],[1,"last-reminder"],[1,"empty-state"],["name","checkmark-circle-outline","color","success"],["name","time-outline"],[1,"info-message"],["slot","end","color","warning"]],template:function(t,o){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),e.EFF(3,"Team Compliance"),e.k0s(),e.j41(4,"ion-buttons",2)(5,"ion-button",3),e.bIt("click",function(){return o.loadData()}),e.nrm(6,"ion-icon",4),e.k0s()()(),e.j41(7,"ion-toolbar")(8,"ion-segment",5),e.mxI("ngModelChange",function(c){return e.DH7(o.selectedSegment,c)||(o.selectedSegment=c),c}),e.bIt("ionChange",function(){return o.onSegmentChange()}),e.j41(9,"ion-segment-button",6)(10,"ion-label"),e.EFF(11,"Today"),e.k0s()(),e.j41(12,"ion-segment-button",7)(13,"ion-label"),e.EFF(14,"This Week"),e.k0s()(),e.j41(15,"ion-segment-button",8)(16,"ion-label"),e.EFF(17,"This Month"),e.k0s()()()()(),e.j41(18,"ion-content",9)(19,"ion-refresher",10),e.bIt("ionRefresh",function(c){return o.handleRefresh(c)}),e.nrm(20,"ion-refresher-content"),e.k0s(),e.DNE(21,P,1,0,"app-loading",11)(22,D,3,2,"div",12),e.k0s()),2&t&&(e.Y8G("translucent",!0),e.R7$(8),e.R50("ngModel",o.selectedSegment),e.R7$(10),e.Y8G("fullscreen",!0),e.R7$(3),e.Y8G("ngIf",o.isLoading),e.R7$(),e.Y8G("ngIf",!o.isLoading))},dependencies:[p.MD,p.Sq,p.bT,p.vh,_.YN,_.BC,_.vS,a.W9,a.eU,a.BC,a.ai,a.QW,a.b_,a.I9,a.ME,a.tN,a.lO,a.ln,a.hU,a.nf,a.uz,a.he,a.In,a.Jm,a.iq,a.To,a.Ki,a.Gp,a.eP,a.S1,f.q],styles:["ion-content[_ngcontent-%COMP%]{--background: var(--ion-color-light)}.content-container[_ngcontent-%COMP%]{padding:16px}.stat-box[_ngcontent-%COMP%]{text-align:center;padding:16px;border-radius:8px;background:var(--ion-color-light-tint)}.stat-box[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:32px;font-weight:700;margin-bottom:4px}.stat-box[_ngcontent-%COMP%]   .stat-value.success[_ngcontent-%COMP%]{color:var(--ion-color-success)}.stat-box[_ngcontent-%COMP%]   .stat-value.warning[_ngcontent-%COMP%]{color:var(--ion-color-warning)}.stat-box[_ngcontent-%COMP%]   .stat-value.danger[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.stat-box[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:12px;color:var(--ion-color-medium);display:flex;align-items:center;justify-content:center;gap:4px}.stat-box[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.date-picker[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:center}.date-picker[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{position:relative}.date-picker[_ngcontent-%COMP%]   .date-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;cursor:pointer}.bulk-actions[_ngcontent-%COMP%]{padding:12px 0}.reminder-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;margin-top:4px;font-size:12px}.reminder-info[_ngcontent-%COMP%]   .last-reminder[_ngcontent-%COMP%]{color:var(--ion-color-medium)}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:48px 24px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:64px;opacity:.5}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:var(--ion-color-medium);margin-top:16px}.info-message[_ngcontent-%COMP%]{text-align:center;padding:32px 16px}.info-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:var(--ion-color-medium);opacity:.5}.info-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:12px;color:var(--ion-color-medium)}ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:18px}ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px}ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:8px}ion-item[_ngcontent-%COMP%]{--padding-start: 16px;--inner-padding-end: 16px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:600;margin-bottom:4px}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px;color:var(--ion-color-medium)}@media (max-width: 768px){.stat-box[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{font-size:24px}.stat-box[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{font-size:11px}}ion-toolbar[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{margin-left:4px}"]})}}return i})()}}]);