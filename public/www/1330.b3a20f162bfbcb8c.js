"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1330],{1330:(z,f,d)=>{d.r(f),d.d(f,{TimesheetsPage:()=>V});var g=d(467),p=d(177),u=d(4341),l=d(7820),T=d(2951),h=d(5873),e=d(4438),j=d(5312),k=d(1626);let b=(()=>{class s{constructor(t){this.http=t,this.apiUrl=`${j.c.apiUrl}/timesheets`}checkAssignment(){return console.log("TimesheetService: Checking assignment status"),this.http.get(`${this.apiUrl}/assignment-status`)}submitRegularTimesheet(t){return console.log("TimesheetService: Submitting regular timesheet",t),this.http.post(`${this.apiUrl}/regular/submit`,t)}submitProjectTimesheet(t){return console.log("TimesheetService: Submitting project timesheet",t),this.http.post(`${this.apiUrl}/project/submit`,t)}getMyRegularTimesheets(t,i,n,o){let a={};return t&&(a.start_date=t),i&&(a.end_date=i),n&&(a.month=n.toString()),o&&(a.year=o.toString()),console.log("TimesheetService: Fetching regular timesheets",a),this.http.get(`${this.apiUrl}/regular/my-timesheets`,{params:a})}getMyProjectTimesheets(t,i,n,o,a){let m={};return t&&(m.start_date=t),i&&(m.end_date=i),n&&(m.month=n.toString()),o&&(m.year=o.toString()),a&&(m.project_id=a.toString()),console.log("TimesheetService: Fetching project timesheets",m),this.http.get(`${this.apiUrl}/project/my-timesheets`,{params:m})}getMyStats(){return this.http.get(`${this.apiUrl}/my-stats`)}uploadClientTimesheet(t){return this.http.post(`${this.apiUrl}/client-timesheet/upload`,t)}getAllTimesheetsForValidation(t,i,n){let o={};return t&&(o.startDate=t),i&&(o.endDate=i),n&&(o.employeeId=n.toString()),this.http.get(`${this.apiUrl}/admin/validate`,{params:o})}validateTimesheet(t,i,n){return this.http.put(`${this.apiUrl}/admin/validate/${t}`,{status:i,notes:n})}getAdminStats(t,i){let n={};return t&&(n.startDate=t),i&&(n.endDate=i),this.http.get(`${this.apiUrl}/admin/stats`,{params:n})}static{this.\u0275fac=function(i){return new(i||s)(e.KVO(k.Qq))}}static{this.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();function F(s,r){if(1&s){const t=e.RV6();e.j41(0,"ion-buttons",13)(1,"ion-button",10),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.openUploadModal())}),e.nrm(2,"ion-icon",14),e.k0s()()}}function w(s,r){1&s&&(e.j41(0,"ion-card",15)(1,"ion-card-content"),e.nrm(2,"ion-icon",16),e.j41(3,"span"),e.EFF(4,"You are assigned to projects - submit project timesheets"),e.k0s()()())}function M(s,r){if(1&s&&(e.j41(0,"p",31),e.nrm(1,"ion-icon",32),e.EFF(2),e.k0s()),2&s){const t=e.XpG().$implicit;e.R7$(2),e.Lme(" ",t.project_name," - ",t.client_name," ")}}function P(s,r){if(1&s&&(e.j41(0,"p",33)(1,"ion-badge",34),e.EFF(2),e.k0s(),e.EFF(3),e.k0s()),2&s){const t=e.XpG().$implicit;e.R7$(2),e.SpI(" ","project"===t.timesheet_source?"Project":"Regular"," "),e.R7$(),e.SpI(" ",t.hours_breakdown.work_mode," ")}}function C(s,r){if(1&s&&(e.j41(0,"div",25),e.nrm(1,"ion-icon",26),e.j41(2,"span"),e.EFF(3),e.k0s()()),2&s){const t=e.XpG().$implicit;e.R7$(3),e.Lme("",t.hours_breakdown.shift_start," - ",t.hours_breakdown.shift_end,"")}}function x(s,r){if(1&s&&(e.j41(0,"div",25),e.nrm(1,"ion-icon",35),e.j41(2,"span"),e.EFF(3),e.k0s()()),2&s){const t=e.XpG().$implicit;e.R7$(3),e.SpI("Regular: ",t.hours_breakdown.regular_hours,"h")}}function v(s,r){if(1&s&&(e.j41(0,"div",36)(1,"strong"),e.EFF(2,"Tasks/Work Description:"),e.k0s(),e.j41(3,"p"),e.EFF(4),e.k0s()()),2&s){const t=e.XpG().$implicit;e.R7$(4),e.JRh((null==t.hours_breakdown?null:t.hours_breakdown.tasks)||t.work_description)}}function R(s,r){if(1&s&&(e.j41(0,"div",37)(1,"strong"),e.EFF(2,"Notes:"),e.k0s(),e.j41(3,"p"),e.EFF(4),e.k0s()()),2&s){const t=e.XpG().$implicit;e.R7$(4),e.JRh(t.notes)}}function O(s,r){if(1&s&&(e.j41(0,"div",42)(1,"small"),e.EFF(2),e.k0s()()),2&s){const t=e.XpG(2).$implicit,i=e.XpG(2);e.R7$(2),e.SpI("Uploaded: ",i.formatDate(t.client_timesheet_upload_date),"")}}function E(s,r){if(1&s&&(e.j41(0,"div",38)(1,"div",39),e.nrm(2,"ion-icon",40),e.j41(3,"span"),e.EFF(4,"Client Timesheet: "),e.k0s(),e.j41(5,"ion-badge",22),e.EFF(6),e.k0s()(),e.DNE(7,O,3,1,"div",41),e.k0s()),2&s){const t=e.XpG().$implicit,i=e.XpG(2);e.R7$(5),e.Y8G("color",i.getClientTimesheetStatusColor(t.client_timesheet_status||"not_uploaded")),e.R7$(),e.SpI(" ",i.getClientTimesheetStatusLabel(t.client_timesheet_status||"not_uploaded")," "),e.R7$(),e.Y8G("ngIf",t.client_timesheet_upload_date)}}function y(s,r){if(1&s&&(e.j41(0,"div",43),e.nrm(1,"ion-icon",44),e.j41(2,"span"),e.EFF(3),e.k0s()()),2&s){const t=e.XpG().$implicit,i=e.XpG(2);e.R7$(3),e.SpI("Submitted: ",i.formatDate(t.submission_date),"")}}function S(s,r){if(1&s&&(e.j41(0,"ion-card",18)(1,"ion-card-content")(2,"div",19)(3,"div")(4,"h3"),e.EFF(5),e.k0s(),e.DNE(6,M,3,2,"p",20)(7,P,4,2,"p",21),e.k0s(),e.j41(8,"ion-badge",22),e.EFF(9),e.k0s()(),e.j41(10,"div",23),e.DNE(11,C,4,2,"div",24),e.j41(12,"div",25),e.nrm(13,"ion-icon",26),e.j41(14,"span"),e.EFF(15),e.k0s()(),e.DNE(16,x,4,1,"div",24),e.k0s(),e.DNE(17,v,5,1,"div",27)(18,R,5,1,"div",28)(19,E,8,3,"div",29)(20,y,4,1,"div",30),e.k0s()()),2&s){const t=r.$implicit,i=e.XpG(2);e.R7$(5),e.JRh(i.formatDate(t.date||t.timesheet_date)),e.R7$(),e.Y8G("ngIf","project"===t.timesheet_source&&t.project_name),e.R7$(),e.Y8G("ngIf",null==t.hours_breakdown?null:t.hours_breakdown.work_mode),e.R7$(),e.Y8G("color",i.getStatusColor(t.status)),e.R7$(),e.SpI(" ",t.status," "),e.R7$(2),e.Y8G("ngIf",(null==t.hours_breakdown?null:t.hours_breakdown.shift_start)&&(null==t.hours_breakdown?null:t.hours_breakdown.shift_end)),e.R7$(4),e.SpI("Hours Worked: ",t.total_hours||t.actual_hours_worked,"h"),e.R7$(),e.Y8G("ngIf",null==t.hours_breakdown?null:t.hours_breakdown.regular_hours),e.R7$(),e.Y8G("ngIf",(null==t.hours_breakdown?null:t.hours_breakdown.tasks)||t.work_description),e.R7$(),e.Y8G("ngIf",t.notes),e.R7$(),e.Y8G("ngIf","project"===t.timesheet_source),e.R7$(),e.Y8G("ngIf",t.submission_date)}}function G(s,r){if(1&s&&(e.j41(0,"div"),e.DNE(1,S,21,12,"ion-card",17),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.timesheets)}}function I(s,r){if(1&s){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-content",45),e.nrm(2,"ion-icon",46),e.j41(3,"h3"),e.EFF(4,"No Timesheets"),e.k0s(),e.j41(5,"p"),e.EFF(6,"You haven't submitted any timesheets yet"),e.k0s(),e.j41(7,"ion-button",10),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.openSubmitModal())}),e.nrm(8,"ion-icon",47),e.EFF(9," Submit Timesheet "),e.k0s()()()}}function $(s,r){if(1&s&&(e.j41(0,"ion-select-option",63),e.EFF(1),e.k0s()),2&s){const t=r.$implicit;e.Y8G("value",t.project_id),e.R7$(),e.Lme(" ",t.project_name," - ",t.client_name," ")}}function D(s,r){if(1&s){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-label",49),e.EFF(2,"Project *"),e.k0s(),e.j41(3,"ion-select",61),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG(2);return e.DH7(o.newTimesheet.project_id,n)||(o.newTimesheet.project_id=n),e.Njj(n)}),e.DNE(4,$,2,3,"ion-select-option",62),e.k0s()()}if(2&s){const t=e.XpG(2);e.R7$(3),e.R50("ngModel",t.newTimesheet.project_id),e.R7$(),e.Y8G("ngForOf",t.projectAssignments)}}function U(s,r){if(1&s){const t=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Submit Timesheet"),e.k0s(),e.j41(4,"ion-buttons",13)(5,"ion-button",10),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeSubmitModal())}),e.EFF(6,"Close"),e.k0s()()()(),e.j41(7,"ion-content")(8,"div",48)(9,"ion-list")(10,"ion-item")(11,"ion-label",49),e.EFF(12,"Date"),e.k0s(),e.j41(13,"ion-input",50),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.timesheet_date,n)||(o.newTimesheet.timesheet_date=n),e.Njj(n)}),e.k0s()(),e.DNE(14,D,5,2,"ion-item",8),e.j41(15,"ion-item")(16,"ion-label",49),e.EFF(17,"Work Mode"),e.k0s(),e.j41(18,"ion-select",51),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.work_mode,n)||(o.newTimesheet.work_mode=n),e.Njj(n)}),e.j41(19,"ion-select-option",52),e.EFF(20,"Office"),e.k0s(),e.j41(21,"ion-select-option",53),e.EFF(22,"Work From Home"),e.k0s(),e.j41(23,"ion-select-option",54),e.EFF(24,"Remote"),e.k0s()()(),e.j41(25,"ion-item")(26,"ion-label",49),e.EFF(27,"Shift Start Time"),e.k0s(),e.j41(28,"ion-input",55),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.shift_start_time,n)||(o.newTimesheet.shift_start_time=n),e.Njj(n)}),e.k0s()(),e.j41(29,"ion-item")(30,"ion-label",49),e.EFF(31,"Shift End Time"),e.k0s(),e.j41(32,"ion-input",55),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.shift_end_time,n)||(o.newTimesheet.shift_end_time=n),e.Njj(n)}),e.k0s()(),e.j41(33,"ion-item")(34,"ion-label",49),e.EFF(35,"Hours Worked"),e.k0s(),e.j41(36,"ion-input",56),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.actual_hours_worked,n)||(o.newTimesheet.actual_hours_worked=n),e.Njj(n)}),e.k0s()(),e.j41(37,"ion-item")(38,"ion-label",49),e.EFF(39,"Tasks Completed *"),e.k0s(),e.j41(40,"ion-textarea",57),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.tasks_completed,n)||(o.newTimesheet.tasks_completed=n),e.Njj(n)}),e.k0s()(),e.j41(41,"ion-item")(42,"ion-label",49),e.EFF(43,"Challenges Faced (Optional)"),e.k0s(),e.j41(44,"ion-textarea",58),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.challenges_faced,n)||(o.newTimesheet.challenges_faced=n),e.Njj(n)}),e.k0s()()(),e.j41(45,"div",59)(46,"ion-button",60),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.submitTimesheet())}),e.EFF(47," Submit Timesheet "),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(13),e.R50("ngModel",t.newTimesheet.timesheet_date),e.R7$(),e.Y8G("ngIf",t.hasProjectAssignment&&t.projectAssignments.length>0),e.R7$(4),e.R50("ngModel",t.newTimesheet.work_mode),e.R7$(10),e.R50("ngModel",t.newTimesheet.shift_start_time),e.R7$(4),e.R50("ngModel",t.newTimesheet.shift_end_time),e.R7$(4),e.R50("ngModel",t.newTimesheet.actual_hours_worked),e.R7$(4),e.R50("ngModel",t.newTimesheet.tasks_completed),e.R7$(4),e.R50("ngModel",t.newTimesheet.challenges_faced)}}function Y(s,r){if(1&s&&(e.j41(0,"ion-select-option",63),e.EFF(1),e.k0s()),2&s){const t=r.$implicit;e.Y8G("value",t.project_id),e.R7$(),e.Lme(" ",t.project_name," - ",t.client_name," ")}}function X(s,r){if(1&s){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-label",49),e.EFF(2,"Project *"),e.k0s(),e.j41(3,"ion-select",61),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG(2);return e.DH7(o.clientTimesheetUpload.project_id,n)||(o.clientTimesheetUpload.project_id=n),e.Njj(n)}),e.DNE(4,Y,2,3,"ion-select-option",62),e.k0s()()}if(2&s){const t=e.XpG(2);e.R7$(3),e.R50("ngModel",t.clientTimesheetUpload.project_id),e.R7$(),e.Y8G("ngForOf",t.projectAssignments)}}function A(s,r){if(1&s&&(e.j41(0,"ion-note",70),e.nrm(1,"ion-icon",71),e.EFF(2),e.k0s()),2&s){const t=e.XpG(2);e.R7$(2),e.Lme(" ",t.selectedFile.name," (",(t.selectedFile.size/1024).toFixed(2)," KB) ")}}function N(s,r){if(1&s){const t=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Upload Client Timesheet"),e.k0s(),e.j41(4,"ion-buttons",13)(5,"ion-button",10),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeUploadModal())}),e.EFF(6,"Close"),e.k0s()()()(),e.j41(7,"ion-content")(8,"div",48)(9,"ion-card")(10,"ion-card-content")(11,"p",64),e.nrm(12,"ion-icon",65),e.EFF(13," Upload the client-approved timesheet document for the selected month and project. "),e.k0s()()(),e.j41(14,"ion-list"),e.DNE(15,X,5,2,"ion-item",8),e.j41(16,"ion-item")(17,"ion-label",49),e.EFF(18,"Month *"),e.k0s(),e.j41(19,"ion-select",51),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.clientTimesheetUpload.month,n)||(o.clientTimesheetUpload.month=n),e.Njj(n)}),e.j41(20,"ion-select-option",63),e.EFF(21,"January"),e.k0s(),e.j41(22,"ion-select-option",63),e.EFF(23,"February"),e.k0s(),e.j41(24,"ion-select-option",63),e.EFF(25,"March"),e.k0s(),e.j41(26,"ion-select-option",63),e.EFF(27,"April"),e.k0s(),e.j41(28,"ion-select-option",63),e.EFF(29,"May"),e.k0s(),e.j41(30,"ion-select-option",63),e.EFF(31,"June"),e.k0s(),e.j41(32,"ion-select-option",63),e.EFF(33,"July"),e.k0s(),e.j41(34,"ion-select-option",63),e.EFF(35,"August"),e.k0s(),e.j41(36,"ion-select-option",63),e.EFF(37,"September"),e.k0s(),e.j41(38,"ion-select-option",63),e.EFF(39,"October"),e.k0s(),e.j41(40,"ion-select-option",63),e.EFF(41,"November"),e.k0s(),e.j41(42,"ion-select-option",63),e.EFF(43,"December"),e.k0s()()(),e.j41(44,"ion-item")(45,"ion-label",49),e.EFF(46,"Year *"),e.k0s(),e.j41(47,"ion-select",51),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.clientTimesheetUpload.year,n)||(o.clientTimesheetUpload.year=n),e.Njj(n)}),e.j41(48,"ion-select-option",63),e.EFF(49,"2024"),e.k0s(),e.j41(50,"ion-select-option",63),e.EFF(51,"2025"),e.k0s(),e.j41(52,"ion-select-option",63),e.EFF(53,"2026"),e.k0s()()(),e.j41(54,"ion-item")(55,"ion-label",49),e.EFF(56,"Client Timesheet File *"),e.k0s(),e.j41(57,"input",66),e.bIt("change",function(n){e.eBV(t);const o=e.XpG();return e.Njj(o.onFileSelected(n))}),e.k0s(),e.DNE(58,A,3,2,"ion-note",67),e.k0s()(),e.j41(59,"div",59)(60,"ion-button",68),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.uploadClientTimesheet())}),e.nrm(61,"ion-icon",69),e.EFF(62," Upload Client Timesheet "),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(15),e.Y8G("ngIf",t.projectAssignments.length>0),e.R7$(4),e.R50("ngModel",t.clientTimesheetUpload.month),e.R7$(),e.Y8G("value",1),e.R7$(2),e.Y8G("value",2),e.R7$(2),e.Y8G("value",3),e.R7$(2),e.Y8G("value",4),e.R7$(2),e.Y8G("value",5),e.R7$(2),e.Y8G("value",6),e.R7$(2),e.Y8G("value",7),e.R7$(2),e.Y8G("value",8),e.R7$(2),e.Y8G("value",9),e.R7$(2),e.Y8G("value",10),e.R7$(2),e.Y8G("value",11),e.R7$(2),e.Y8G("value",12),e.R7$(5),e.R50("ngModel",t.clientTimesheetUpload.year),e.R7$(),e.Y8G("value",2024),e.R7$(2),e.Y8G("value",2025),e.R7$(2),e.Y8G("value",2026),e.R7$(6),e.Y8G("ngIf",t.selectedFile),e.R7$(2),e.Y8G("disabled",!t.selectedFile)}}let V=(()=>{class s{constructor(t,i,n,o){this.timesheetService=t,this.loadingController=i,this.toastController=n,this.alertController=o,this.timesheets=[],this.hasProjectAssignment=!1,this.projectAssignments=[],this.isLoading=!1,this.selectedStatus="all",this.showSubmitModal=!1,this.showUploadModal=!1,this.selectedFile=null,this.newTimesheet={timesheet_date:(new Date).toISOString().split("T")[0],project_id:null,work_mode:"Office",shift_start_time:"09:00",shift_end_time:"18:00",actual_hours_worked:8,tasks_completed:"",challenges_faced:""},this.clientTimesheetUpload={month:(new Date).getMonth()+1,year:(new Date).getFullYear(),project_id:null},(0,T.d)({addOutline:h.EKF,timeOutline:h.CVk,checkmarkOutline:h.g1L,closeOutline:h.xfX,calendarOutline:h.RXF,briefcaseOutline:h.vOb,cloudUploadOutline:h.Fb6,documentTextOutline:h.pXZ,checkmarkDoneOutline:h.u8Q})}ngOnInit(){this.checkAssignment(),this.loadTimesheets()}ionViewWillEnter(){this.checkAssignment(),this.loadTimesheets()}checkAssignment(){console.log("Checking project assignment status..."),this.timesheetService.checkAssignment().subscribe({next:t=>{console.log("Assignment status:",t),this.hasProjectAssignment=t.has_project,this.projectAssignments=t.assignments||[],this.projectAssignments.length>0&&(this.newTimesheet.project_id=this.projectAssignments[0].project_id)},error:t=>{console.error("Error checking assignment:",t)}})}loadTimesheets(t){var i=this;return(0,g.A)(function*(){console.log("Loading timesheets..."),t||(i.isLoading=!0);const n=(new Date).toISOString().split("T")[0],o=new Date(Date.now()-2592e6).toISOString().split("T")[0];try{const[a,m]=yield Promise.all([i.timesheetService.getMyRegularTimesheets(o,n).toPromise(),i.timesheetService.getMyProjectTimesheets(o,n).toPromise()]);console.log("Regular timesheets loaded:",a?.length||0),console.log("Project timesheets loaded:",m?.length||0);let c=[...(a||[]).map(_=>({..._,timesheet_source:"regular"})),...(m||[]).map(_=>({..._,timesheet_source:"project"}))];"all"!==i.selectedStatus&&(c=c.filter(_=>_.status===i.selectedStatus)),i.timesheets=c.sort((_,B)=>new Date(B.date).getTime()-new Date(_.date).getTime()),i.isLoading=!1,t&&t.target.complete()}catch(a){console.error("Error loading timesheets:",a),i.showToast(a.error?.error||a.error?.message||"Failed to load timesheets","danger"),i.isLoading=!1,t&&t.target.complete()}})()}segmentChanged(t){this.selectedStatus=t.detail.value,this.loadTimesheets()}openSubmitModal(){this.showSubmitModal=!0}closeSubmitModal(){this.showSubmitModal=!1}submitTimesheet(){var t=this;return(0,g.A)(function*(){if(!t.newTimesheet.tasks_completed.trim())return void t.showToast("Please enter tasks completed","warning");if(t.hasProjectAssignment&&!t.newTimesheet.project_id)return void t.showToast("Please select a project","warning");const i=yield t.loadingController.create({message:"Submitting timesheet..."});yield i.present();const n=new Date(`2000-01-01 ${t.newTimesheet.shift_start_time}`),a=(new Date(`2000-01-01 ${t.newTimesheet.shift_end_time}`).getTime()-n.getTime())/36e5;console.log("Submitting timesheet data:",{hasProject:t.hasProjectAssignment,projectId:t.newTimesheet.project_id}),t.hasProjectAssignment&&t.newTimesheet.project_id?t.timesheetService.submitProjectTimesheet({date:t.newTimesheet.timesheet_date,project_id:t.newTimesheet.project_id,total_hours:a||t.newTimesheet.actual_hours_worked,hours_breakdown:{work_mode:t.newTimesheet.work_mode,shift_start:t.newTimesheet.shift_start_time,shift_end:t.newTimesheet.shift_end_time,regular_hours:t.newTimesheet.actual_hours_worked,tasks:t.newTimesheet.tasks_completed},work_description:t.newTimesheet.tasks_completed,notes:t.newTimesheet.challenges_faced}).subscribe({next:c=>{console.log("Project timesheet submitted:",c),i.dismiss(),t.showToast(c.message||"Project timesheet submitted successfully","success"),t.closeSubmitModal(),t.resetForm(),t.loadTimesheets()},error:c=>{i.dismiss(),console.error("Error submitting project timesheet:",c),t.showToast(c.error?.error||c.error?.message||c.message||"Failed to submit timesheet","danger")}}):t.timesheetService.submitRegularTimesheet({date:t.newTimesheet.timesheet_date,total_hours:a||t.newTimesheet.actual_hours_worked,hours_breakdown:{work_mode:t.newTimesheet.work_mode,shift_start:t.newTimesheet.shift_start_time,shift_end:t.newTimesheet.shift_end_time,regular_hours:t.newTimesheet.actual_hours_worked,tasks:t.newTimesheet.tasks_completed},notes:t.newTimesheet.challenges_faced}).subscribe({next:c=>{console.log("Regular timesheet submitted:",c),i.dismiss(),t.showToast(c.message||"Timesheet submitted successfully","success"),t.closeSubmitModal(),t.resetForm(),t.loadTimesheets()},error:c=>{i.dismiss(),console.error("Error submitting timesheet:",c),t.showToast(c.error?.error||c.error?.message||c.message||"Failed to submit timesheet","danger")}})})()}resetForm(){this.newTimesheet={timesheet_date:(new Date).toISOString().split("T")[0],project_id:this.projectAssignments.length>0?this.projectAssignments[0].project_id:null,work_mode:"Office",shift_start_time:"09:00",shift_end_time:"18:00",actual_hours_worked:8,tasks_completed:"",challenges_faced:""}}getStatusColor(t){switch(t?.toLowerCase()){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";default:return"medium"}}formatDate(t){return new Date(t).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}showToast(t,i){var n=this;return(0,g.A)(function*(){yield(yield n.toastController.create({message:t,duration:3e3,color:i,position:"bottom"})).present()})()}openUploadModal(){this.hasProjectAssignment?(this.clientTimesheetUpload.project_id=this.projectAssignments.length>0?this.projectAssignments[0].project_id:null,this.showUploadModal=!0):this.showToast("Client timesheet upload is only for project-assigned employees","warning")}closeUploadModal(){this.showUploadModal=!1,this.selectedFile=null}onFileSelected(t){const i=t.target.files[0];if(i){if(!["application/pdf","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/jpg","image/png"].includes(i.type))return this.showToast("Please upload Excel, PDF, or Image files only","danger"),void(t.target.value="");if(i.size>5242880)return this.showToast("File size must be less than 5MB","danger"),void(t.target.value="");this.selectedFile=i}}uploadClientTimesheet(){var t=this;return(0,g.A)(function*(){if(!t.selectedFile)return void t.showToast("Please select a file to upload","warning");if(!t.clientTimesheetUpload.project_id)return void t.showToast("Please select a project","warning");const i=yield t.loadingController.create({message:"Uploading client timesheet..."});yield i.present();const n=new FormData;var o;n.append("file",t.selectedFile),n.append("month",t.clientTimesheetUpload.month.toString()),n.append("year",t.clientTimesheetUpload.year.toString()),n.append("project_id",t.clientTimesheetUpload.project_id.toString()),t.timesheetService.uploadClientTimesheet(n).subscribe({next:(o=(0,g.A)(function*(a){yield i.dismiss(),t.showToast(a.message||"Client timesheet uploaded successfully","success"),t.closeUploadModal(),t.loadTimesheets()}),function(m){return o.apply(this,arguments)}),error:function(){var o=(0,g.A)(function*(a){yield i.dismiss(),console.error("Error uploading client timesheet:",a),t.showToast(a.error?.error||a.error?.message||"Failed to upload client timesheet","danger")});return function(m){return o.apply(this,arguments)}}()})})()}getMonthName(t){return["January","February","March","April","May","June","July","August","September","October","November","December"][t-1]}getClientTimesheetStatusColor(t){switch(t){case"validated":return"success";case"pending_validation":return"warning";case"rejected":return"danger";default:return"medium"}}getClientTimesheetStatusLabel(t){switch(t){case"validated":return"Validated";case"pending_validation":return"Pending Validation";case"rejected":return"Rejected";default:return"Not Uploaded"}}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(b),e.rXU(l.Xi),e.rXU(l.K_),e.rXU(l.hG))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-timesheets"]],standalone:!0,features:[e.aNF],decls:29,vars:7,consts:[["slot","start"],["defaultHref","/tabs/home"],["slot","end",4,"ngIf"],[3,"ngModelChange","ionChange","ngModel"],["value","all"],["value","pending"],["value","approved"],["class","info-card",4,"ngIf"],[4,"ngIf"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click"],["name","add-outline"],[3,"didDismiss","isOpen"],["slot","end"],["name","cloud-upload-outline","slot","icon-only"],[1,"info-card"],["name","checkmark-outline","color","success"],["class","timesheet-card",4,"ngFor","ngForOf"],[1,"timesheet-card"],[1,"timesheet-header"],["class","project-info",4,"ngIf"],["class","work-mode",4,"ngIf"],[3,"color"],[1,"timesheet-details"],["class","detail-row",4,"ngIf"],[1,"detail-row"],["name","time-outline"],["class","tasks-section",4,"ngIf"],["class","challenges-section",4,"ngIf"],["class","client-timesheet-status",4,"ngIf"],["class","submission-time",4,"ngIf"],[1,"project-info"],["name","briefcase-outline"],[1,"work-mode"],["color","medium",2,"font-size","11px"],["name","checkmark-outline"],[1,"tasks-section"],[1,"challenges-section"],[1,"client-timesheet-status"],[1,"status-row"],["name","document-text-outline"],["class","upload-date",4,"ngIf"],[1,"upload-date"],[1,"submission-time"],["name","calendar-outline"],[1,"empty-state"],["name","time-outline","size","large"],["name","add-outline","slot","start"],[1,"modal-content"],["position","stacked"],["type","date",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value","Office"],["value","WFH"],["value","Remote"],["type","time",3,"ngModelChange","ngModel"],["type","number",3,"ngModelChange","ngModel"],["rows","4","placeholder","Describe what you accomplished today...",3,"ngModelChange","ngModel"],["rows","3","placeholder","Any issues or blockers...",3,"ngModelChange","ngModel"],[1,"button-container"],["expand","block",3,"click"],["placeholder","Select Project",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[2,"margin-bottom","16px"],["name","information-circle-outline","color","primary"],["type","file","accept",".pdf,.xlsx,.xls,.jpg,.jpeg,.png",2,"margin-top","8px",3,"change"],["color","success","style","margin-top: 8px;",4,"ngIf"],["expand","block",3,"click","disabled"],["name","cloud-upload-outline","slot","start"],["color","success",2,"margin-top","8px"],["name","checkmark-circle-outline"]],template:function(i,n){1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-back-button",1),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"My Timesheets"),e.k0s(),e.DNE(6,F,3,0,"ion-buttons",2),e.k0s(),e.j41(7,"ion-toolbar")(8,"ion-segment",3),e.mxI("ngModelChange",function(a){return e.DH7(n.selectedStatus,a)||(n.selectedStatus=a),a}),e.bIt("ionChange",function(a){return n.segmentChanged(a)}),e.j41(9,"ion-segment-button",4)(10,"ion-label"),e.EFF(11,"All"),e.k0s()(),e.j41(12,"ion-segment-button",5)(13,"ion-label"),e.EFF(14,"Pending"),e.k0s()(),e.j41(15,"ion-segment-button",6)(16,"ion-label"),e.EFF(17,"Approved"),e.k0s()()()()(),e.j41(18,"ion-content"),e.DNE(19,w,5,0,"ion-card",7)(20,G,2,1,"div",8)(21,I,10,0,"ion-card",8),e.j41(22,"ion-fab",9)(23,"ion-fab-button",10),e.bIt("click",function(){return n.openSubmitModal()}),e.nrm(24,"ion-icon",11),e.k0s()(),e.j41(25,"ion-modal",12),e.bIt("didDismiss",function(){return n.closeSubmitModal()}),e.DNE(26,U,48,8,"ng-template"),e.k0s(),e.j41(27,"ion-modal",12),e.bIt("didDismiss",function(){return n.closeUploadModal()}),e.DNE(28,N,63,20,"ng-template"),e.k0s()()),2&i&&(e.R7$(6),e.Y8G("ngIf",n.hasProjectAssignment),e.R7$(2),e.R50("ngModel",n.selectedStatus),e.R7$(11),e.Y8G("ngIf",n.hasProjectAssignment),e.R7$(),e.Y8G("ngIf",!n.isLoading&&n.timesheets.length>0),e.R7$(),e.Y8G("ngIf",!n.isLoading&&0===n.timesheets.length),e.R7$(4),e.Y8G("isOpen",n.showSubmitModal),e.R7$(2),e.Y8G("isOpen",n.showUploadModal))},dependencies:[p.MD,p.Sq,p.bT,u.YN,u.BC,u.vS,l.W9,l.eU,l.BC,l.ai,l.QW,l.el,l.b_,l.I9,l.nf,l.uz,l.he,l.In,l.Jm,l.iq,l.Gp,l.eP,l.Q8,l.YW,l.Nm,l.Ip,l.Sb,l.nc,l.$w,l.JI],styles:[".info-card[_ngcontent-%COMP%]{margin:12px;background:rgba(var(--ion-color-success-rgb),.1);border-left:4px solid var(--ion-color-success)}.info-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.info-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5em}.timesheet-card[_ngcontent-%COMP%]{margin:12px}.timesheet-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px}.timesheet-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:1.1em;color:var(--ion-color-dark)}.timesheet-header[_ngcontent-%COMP%]   .work-mode[_ngcontent-%COMP%]{margin:0;font-size:.85em;color:var(--ion-color-medium);display:flex;align-items:center;gap:6px}.timesheet-header[_ngcontent-%COMP%]   .project-info[_ngcontent-%COMP%]{margin:4px 0 0;font-size:.85em;color:var(--ion-color-primary);display:flex;align-items:center;gap:4px;font-weight:500}.timesheet-header[_ngcontent-%COMP%]   .project-info[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1em}.timesheet-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin:16px 0;padding:12px;background:var(--ion-color-light);border-radius:8px}.detail-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.9em}.detail-row[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-size:1.2em}.tasks-section[_ngcontent-%COMP%], .challenges-section[_ngcontent-%COMP%]{margin:12px 0}.tasks-section[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .challenges-section[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:6px;color:var(--ion-color-dark)}.tasks-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .challenges-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--ion-color-medium);font-size:.9em;line-height:1.5}.client-timesheet-status[_ngcontent-%COMP%]{margin:12px 0;padding:12px;background:rgba(var(--ion-color-primary-rgb),.05);border-radius:8px;border-left:3px solid var(--ion-color-primary)}.client-timesheet-status[_ngcontent-%COMP%]   .status-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.9em;font-weight:500}.client-timesheet-status[_ngcontent-%COMP%]   .status-row[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-size:1.2em}.client-timesheet-status[_ngcontent-%COMP%]   .status-row[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{font-size:.85em}.client-timesheet-status[_ngcontent-%COMP%]   .upload-date[_ngcontent-%COMP%]{margin-top:4px;margin-left:28px}.client-timesheet-status[_ngcontent-%COMP%]   .upload-date[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.8em}.submission-time[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;margin-top:12px;padding-top:12px;border-top:1px solid var(--ion-color-light);font-size:.85em;color:var(--ion-color-medium)}.submission-time[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.1em}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:16px 0 8px;color:var(--ion-color-dark)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:24px}.modal-content[_ngcontent-%COMP%]{padding:16px}.button-container[_ngcontent-%COMP%]{margin-top:20px;padding:0 16px 16px}ion-modal[_ngcontent-%COMP%]{--height: 90%}"]})}}return s})()}}]);