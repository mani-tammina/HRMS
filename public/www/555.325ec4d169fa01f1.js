"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[555],{3555:(x,m,r)=>{r.r(m),r.d(m,{BulkUploadPage:()=>T});var p=r(467),u=r(177),g=r(4341),a=r(7820),f=r(2951),d=r(5873),e=r(4438),_=r(5312),h=r(1626);let F=(()=>{class n{constructor(t){this.http=t,this.apiUrl=`${_.c.apiUrl}/upload`}uploadEmployees(t){const o=new FormData;return o.append("file",t),this.http.post(`${this.apiUrl}/employees`,o)}uploadHolidays(t){const o=new FormData;return o.append("file",t),this.http.post(`${this.apiUrl}/holidays`,o)}uploadPayrollData(t){const o=new FormData;return o.append("file",t),this.http.post(`${this.apiUrl}/payroll`,o)}downloadTemplate(t){return this.http.get(`${this.apiUrl}/template/${t}`,{responseType:"blob"})}validateFile(t,o){const l=new FormData;return l.append("file",t),l.append("type",o),this.http.post(`${this.apiUrl}/validate`,l)}static{this.\u0275fac=function(o){return new(o||n)(e.KVO(h.Qq))}}static{this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();function k(n,c){if(1&n){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-label")(2,"h3"),e.EFF(3),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s()(),e.j41(6,"ion-button",8),e.bIt("click",function(){const l=e.eBV(t).$implicit,i=e.XpG();return i.selectedType=l.id,e.Njj(i.resetUpload())}),e.EFF(7),e.k0s()()}if(2&n){const t=c.$implicit,o=e.XpG();e.R7$(3),e.JRh(t.name),e.R7$(2),e.JRh(t.description),e.R7$(),e.Y8G("color",o.selectedType===t.id?"primary":"medium"),e.R7$(),e.SpI(" ",o.selectedType===t.id?"Selected":"Select"," ")}}function y(n,c){if(1&n){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3,"Step 2: Download Template"),e.k0s()(),e.j41(4,"ion-card-content")(5,"p"),e.EFF(6,"Download the template file for "),e.j41(7,"strong"),e.EFF(8),e.k0s()(),e.j41(9,"ion-button",9),e.bIt("click",function(){e.eBV(t);const l=e.XpG();return e.Njj(l.downloadTemplate())}),e.nrm(10,"ion-icon",10),e.EFF(11," Download Template "),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(8),e.JRh(t.getSelectedTypeName())}}function b(n,c){if(1&n){const t=e.RV6();e.j41(0,"div",19),e.nrm(1,"ion-icon",4),e.j41(2,"span"),e.EFF(3),e.k0s(),e.j41(4,"ion-button",20),e.bIt("click",function(){e.eBV(t);const l=e.XpG(2);return e.Njj(l.resetUpload())}),e.nrm(5,"ion-icon",21),e.k0s()()}if(2&n){const t=e.XpG(2);e.R7$(3),e.JRh(t.selectedFile.name)}}function v(n,c){if(1&n&&e.nrm(0,"ion-progress-bar",22),2&n){const t=e.XpG(2);e.Y8G("value",t.uploadProgress/100)}}function P(n,c){if(1&n){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3,"Step 3: Upload File"),e.k0s()(),e.j41(4,"ion-card-content")(5,"div",11)(6,"input",12),e.bIt("change",function(l){e.eBV(t);const i=e.XpG();return e.Njj(i.onFileSelected(l))}),e.k0s(),e.j41(7,"label",13),e.nrm(8,"ion-icon",14),e.j41(9,"p"),e.EFF(10,"Click to select file or drag & drop"),e.k0s(),e.j41(11,"small"),e.EFF(12,"Supported formats: Excel (.xlsx, .xls), CSV (.csv)"),e.k0s()(),e.DNE(13,b,6,1,"div",15),e.k0s(),e.j41(14,"ion-button",16),e.bIt("click",function(){e.eBV(t);const l=e.XpG();return e.Njj(l.uploadFile())}),e.nrm(15,"ion-icon",17),e.EFF(16),e.k0s(),e.DNE(17,v,1,1,"ion-progress-bar",18),e.k0s()()}if(2&n){const t=e.XpG();e.R7$(13),e.Y8G("ngIf",t.selectedFile),e.R7$(),e.Y8G("disabled",!t.selectedFile||t.isUploading),e.R7$(2),e.SpI(" ",t.isUploading?"Uploading...":"Upload File"," "),e.R7$(),e.Y8G("ngIf",t.isUploading)}}function U(n,c){if(1&n&&(e.j41(0,"ion-item")(1,"ion-label",33)(2,"p",34)(3,"strong"),e.EFF(4),e.k0s(),e.EFF(5),e.k0s()()()),2&n){const t=c.$implicit;e.R7$(4),e.SpI("Row ",t.row,":"),e.R7$(),e.SpI(" ",t.error," ")}}function C(n,c){if(1&n&&(e.j41(0,"div",32)(1,"h4"),e.EFF(2,"Errors:"),e.k0s(),e.j41(3,"ion-list"),e.DNE(4,U,6,2,"ion-item",6),e.k0s()()),2&n){const t=e.XpG(2);e.R7$(4),e.Y8G("ngForOf",t.uploadResult.errors)}}function O(n,c){if(1&n){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.nrm(3,"ion-icon",23),e.EFF(4," Upload Results "),e.k0s()(),e.j41(5,"ion-card-content")(6,"ion-grid")(7,"ion-row")(8,"ion-col",24)(9,"div",25),e.nrm(10,"ion-icon",26),e.j41(11,"span",27),e.EFF(12),e.k0s(),e.j41(13,"span",28),e.EFF(14,"Successful"),e.k0s()()(),e.j41(15,"ion-col",24)(16,"div",29),e.nrm(17,"ion-icon",21),e.j41(18,"span",27),e.EFF(19),e.k0s(),e.j41(20,"span",28),e.EFF(21,"Errors"),e.k0s()()()()(),e.DNE(22,C,5,1,"div",30),e.j41(23,"ion-button",31),e.bIt("click",function(){e.eBV(t);const l=e.XpG();return e.Njj(l.resetUpload())}),e.EFF(24," Upload Another File "),e.k0s()()()}if(2&n){const t=e.XpG();e.R7$(3),e.Y8G("name",t.uploadResult.success?"checkmark-circle-outline":"close-circle-outline")("color",t.uploadResult.success?"success":"danger"),e.R7$(9),e.JRh(t.uploadResult.successCount),e.R7$(7),e.JRh(t.uploadResult.errorCount),e.R7$(3),e.Y8G("ngIf",t.uploadResult.errors&&t.uploadResult.errors.length>0)}}let T=(()=>{class n{constructor(t,o,l,i){this.uploadService=t,this.loadingController=o,this.toastController=l,this.alertController=i,this.selectedType="",this.selectedFile=null,this.uploadProgress=0,this.isUploading=!1,this.uploadResult=null,this.uploadTypes=[{id:"employees",name:"Employees",description:"Upload employee master data (Name, Email, Department, Designation, etc.)",templateFile:"employee_upload_template.xlsx"},{id:"holidays",name:"Holidays",description:"Upload company holidays (Date, Name, Type, Location)",templateFile:"holiday_upload_template.xlsx"},{id:"payroll",name:"Payroll Data",description:"Upload payroll information (Employee ID, Salary Components, Deductions)",templateFile:"payroll_upload_template.xlsx"}],(0,f.d)({cloudUploadOutline:d.Fb6,downloadOutline:d.fPB,checkmarkCircleOutline:d.gz2,closeCircleOutline:d.p9N,documentOutline:d.elH})}ngOnInit(){}onFileSelected(t){const o=t.target.files[0];if(o){if(!["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"].includes(o.type))return void this.showToast("Please select a valid Excel or CSV file","danger");this.selectedFile=o,this.uploadResult=null}}downloadTemplate(){var t=this;return(0,p.A)(function*(){if(!t.selectedType)return void t.showToast("Please select an upload type first","warning");const o=yield t.loadingController.create({message:"Downloading template..."});yield o.present(),t.uploadService.downloadTemplate(t.selectedType).subscribe({next:l=>{const i=window.URL.createObjectURL(l),s=document.createElement("a");s.href=i,s.download=`${t.selectedType}_template.xlsx`,s.click(),window.URL.revokeObjectURL(i),o.dismiss(),t.showToast("Template downloaded successfully","success")},error:l=>{o.dismiss(),t.showToast("Failed to download template","danger")}})})()}uploadFile(){var t=this;return(0,p.A)(function*(){t.selectedType&&t.selectedFile?yield(yield t.alertController.create({header:"Confirm Upload",message:`Are you sure you want to upload ${t.selectedFile.name}? This will process the data and may update records.`,buttons:[{text:"Cancel",role:"cancel"},{text:"Upload",handler:()=>{t.processUpload()}}]})).present():t.showToast("Please select upload type and file","warning")})()}processUpload(){var t=this;return(0,p.A)(function*(){if(!t.selectedFile||!t.selectedType)return;t.isUploading=!0,t.uploadProgress=0,t.uploadResult=null;const o=yield t.loadingController.create({message:"Uploading and processing file..."});yield o.present();const l=setInterval(()=>{t.uploadProgress<90&&(t.uploadProgress+=10)},200);let i;switch(t.selectedType){case"employees":i=t.uploadService.uploadEmployees(t.selectedFile);break;case"holidays":i=t.uploadService.uploadHolidays(t.selectedFile);break;case"payroll":i=t.uploadService.uploadPayrollData(t.selectedFile);break;default:return clearInterval(l),o.dismiss(),t.isUploading=!1,void t.showToast("Invalid upload type","danger")}i.subscribe({next:s=>{clearInterval(l),t.uploadProgress=100,t.uploadResult=s,t.isUploading=!1,o.dismiss(),s.success?t.showToast(`Successfully uploaded ${s.successCount} records`,"success"):t.showToast(`Upload completed with ${s.errorCount} errors`,"warning"),t.selectedFile=null},error:s=>{clearInterval(l),t.uploadProgress=0,t.isUploading=!1,o.dismiss(),t.showToast("Upload failed: "+s.message,"danger")}})})()}resetUpload(){this.selectedFile=null,this.uploadResult=null,this.uploadProgress=0,this.isUploading=!1}getSelectedTypeName(){const t=this.uploadTypes.find(o=>o.id===this.selectedType);return t?t.name:""}showToast(t,o){var l=this;return(0,p.A)(function*(){yield(yield l.toastController.create({message:t,duration:3e3,color:o,position:"bottom"})).present()})()}static{this.\u0275fac=function(o){return new(o||n)(e.rXU(F),e.rXU(a.Xi),e.rXU(a.K_),e.rXU(a.hG))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-bulk-upload"]],standalone:!0,features:[e.aNF],decls:38,vars:4,consts:[["color","primary"],["slot","start"],["defaultHref","/admin/dashboard"],[1,"ion-padding"],["name","document-outline"],[1,"note"],[4,"ngFor","ngForOf"],[4,"ngIf"],["slot","end","fill","outline",3,"click","color"],["expand","block",3,"click"],["name","download-outline","slot","start"],[1,"upload-area"],["type","file","id","fileInput","accept",".xlsx,.xls,.csv",2,"display","none",3,"change"],["for","fileInput",1,"file-label"],["name","cloud-upload-outline"],["class","selected-file",4,"ngIf"],["expand","block",1,"upload-btn",3,"click","disabled"],["name","cloud-upload-outline","slot","start"],["color","primary",3,"value",4,"ngIf"],[1,"selected-file"],["fill","clear","size","small",3,"click"],["name","close-circle-outline"],["color","primary",3,"value"],[3,"name","color"],["size","6"],[1,"result-stat","success"],["name","checkmark-circle-outline"],[1,"stat-value"],[1,"stat-label"],[1,"result-stat","error"],["class","error-list",4,"ngIf"],["expand","block",1,"reset-btn",3,"click"],[1,"error-list"],[1,"ion-text-wrap"],[1,"error-message"]],template:function(o,l){1&o&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e.nrm(3,"ion-back-button",2),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Bulk Upload"),e.k0s()()(),e.j41(6,"ion-content",3)(7,"ion-card")(8,"ion-card-header")(9,"ion-card-title"),e.nrm(10,"ion-icon",4),e.EFF(11," Upload Instructions "),e.k0s()(),e.j41(12,"ion-card-content")(13,"ol")(14,"li"),e.EFF(15,"Select the type of data you want to upload"),e.k0s(),e.j41(16,"li"),e.EFF(17,"Download the template file for the selected type"),e.k0s(),e.j41(18,"li"),e.EFF(19,"Fill in the template with your data"),e.k0s(),e.j41(20,"li"),e.EFF(21,"Upload the completed file"),e.k0s(),e.j41(22,"li"),e.EFF(23,"Review the upload results"),e.k0s()(),e.j41(24,"p",5)(25,"strong"),e.EFF(26,"Note:"),e.k0s(),e.EFF(27," Make sure to follow the template format exactly. Invalid data will be skipped with error messages. "),e.k0s()()(),e.j41(28,"ion-card")(29,"ion-card-header")(30,"ion-card-title"),e.EFF(31,"Step 1: Select Upload Type"),e.k0s()(),e.j41(32,"ion-card-content")(33,"ion-list"),e.DNE(34,k,8,4,"ion-item",6),e.k0s()()(),e.DNE(35,y,12,1,"ion-card",7)(36,P,18,4,"ion-card",7)(37,O,25,5,"ion-card",7),e.k0s()),2&o&&(e.R7$(34),e.Y8G("ngForOf",l.uploadTypes),e.R7$(),e.Y8G("ngIf",l.selectedType),e.R7$(),e.Y8G("ngIf",l.selectedType),e.R7$(),e.Y8G("ngIf",l.uploadResult))},dependencies:[u.MD,u.Sq,u.bT,g.YN,a.W9,a.eU,a.BC,a.ai,a.QW,a.el,a.b_,a.I9,a.ME,a.tN,a.nf,a.uz,a.he,a.Jm,a.iq,a.FH,a.lO,a.ln,a.hU],styles:[".note[_ngcontent-%COMP%]{background:var(--ion-color-light);padding:1rem;border-radius:8px;margin-top:1rem;font-size:.9rem}.upload-area[_ngcontent-%COMP%]{border:2px dashed var(--ion-color-medium);border-radius:8px;padding:2rem;text-align:center;margin-bottom:1rem;transition:all .3s ease}.upload-area[_ngcontent-%COMP%]:hover{border-color:var(--ion-color-primary);background:var(--ion-color-light)}.file-label[_ngcontent-%COMP%]{cursor:pointer;display:block}.file-label[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:3rem;color:var(--ion-color-medium);margin-bottom:.5rem}.file-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-dark);font-size:1rem;margin:.5rem 0}.file-label[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.85rem}.selected-file[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;background:var(--ion-color-light);border-radius:8px;margin-top:1rem}.selected-file[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--ion-color-primary)}.selected-file[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;color:var(--ion-color-dark)}.upload-btn[_ngcontent-%COMP%]{margin-top:1rem}ion-progress-bar[_ngcontent-%COMP%]{margin-top:1rem;height:8px;border-radius:4px}.result-stat[_ngcontent-%COMP%]{text-align:center;padding:1rem;border-radius:8px}.result-stat.success[_ngcontent-%COMP%]{background:var(--ion-color-success-tint)}.result-stat.success[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-success)}.result-stat.error[_ngcontent-%COMP%]{background:var(--ion-color-danger-tint)}.result-stat.error[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-danger)}.result-stat[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:2rem;display:block;margin-bottom:.5rem}.result-stat[_ngcontent-%COMP%]   .stat-value[_ngcontent-%COMP%]{display:block;font-size:2rem;font-weight:700;margin-bottom:.25rem}.result-stat[_ngcontent-%COMP%]   .stat-label[_ngcontent-%COMP%]{display:block;font-size:.9rem;color:var(--ion-color-medium)}.error-list[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background:var(--ion-color-danger-tint);border-radius:8px}.error-list[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--ion-color-danger);margin-bottom:.5rem}.error-list[_ngcontent-%COMP%]   ion-list[_ngcontent-%COMP%]{background:transparent}.error-list[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{color:var(--ion-color-danger-shade);font-size:.9rem}.reset-btn[_ngcontent-%COMP%]{margin-top:1rem}ion-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}ion-card-title[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5rem}ol[_ngcontent-%COMP%]{padding-left:1.5rem}ol[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.5rem}"]})}}return n})()}}]);