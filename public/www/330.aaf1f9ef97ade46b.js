"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[330],{1330:(I,p,m)=>{m.r(p),m.d(p,{TimesheetsPage:()=>E});var g=m(467),_=m(177),u=m(4341),a=m(773),f=m(2951),d=m(5873),e=m(4438),T=m(5312),k=m(1626);let b=(()=>{class s{constructor(t){this.http=t,this.apiUrl=`${T.c.apiUrl}/timesheets`}checkAssignment(){return console.log("TimesheetService: Checking assignment status"),this.http.get(`${this.apiUrl}/assignment-status`)}submitRegularTimesheet(t){return console.log("TimesheetService: Submitting regular timesheet",t),this.http.post(`${this.apiUrl}/regular/submit`,t)}submitProjectTimesheet(t){return console.log("TimesheetService: Submitting project timesheet",t),this.http.post(`${this.apiUrl}/project/submit`,t)}getMyRegularTimesheets(t,i,n,o){let r={};return t&&(r.start_date=t),i&&(r.end_date=i),n&&(r.month=n.toString()),o&&(r.year=o.toString()),console.log("TimesheetService: Fetching regular timesheets",r),this.http.get(`${this.apiUrl}/regular/my-timesheets`,{params:r})}getMyProjectTimesheets(t,i,n,o,r){let l={};return t&&(l.start_date=t),i&&(l.end_date=i),n&&(l.month=n.toString()),o&&(l.year=o.toString()),r&&(l.project_id=r.toString()),console.log("TimesheetService: Fetching project timesheets",l),this.http.get(`${this.apiUrl}/project/my-timesheets`,{params:l})}getMyStats(){return this.http.get(`${this.apiUrl}/my-stats`)}uploadClientTimesheet(t){return this.http.post(`${this.apiUrl}/upload-client-timesheet`,t)}getAllTimesheetsForValidation(t,i,n){let o={};return t&&(o.startDate=t),i&&(o.endDate=i),n&&(o.employeeId=n.toString()),this.http.get(`${this.apiUrl}/admin/validate`,{params:o})}validateTimesheet(t,i,n){return this.http.put(`${this.apiUrl}/admin/validate/${t}`,{status:i,notes:n})}getAdminStats(t,i){let n={};return t&&(n.startDate=t),i&&(n.endDate=i),this.http.get(`${this.apiUrl}/admin/stats`,{params:n})}static{this.\u0275fac=function(i){return new(i||s)(e.KVO(k.Qq))}}static{this.\u0275prov=e.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();function w(s,c){1&s&&(e.j41(0,"ion-card",12)(1,"ion-card-content"),e.nrm(2,"ion-icon",13),e.j41(3,"span"),e.EFF(4,"You are assigned to projects - submit project timesheets"),e.k0s()()())}function M(s,c){if(1&s&&(e.j41(0,"p",26),e.EFF(1),e.k0s()),2&s){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.hours_breakdown.work_mode)}}function j(s,c){if(1&s&&(e.j41(0,"div",21),e.nrm(1,"ion-icon",22),e.j41(2,"span"),e.EFF(3),e.k0s()()),2&s){const t=e.XpG().$implicit;e.R7$(3),e.Lme("",t.hours_breakdown.shift_start," - ",t.hours_breakdown.shift_end,"")}}function C(s,c){if(1&s&&(e.j41(0,"div",21),e.nrm(1,"ion-icon",27),e.j41(2,"span"),e.EFF(3),e.k0s()()),2&s){const t=e.XpG().$implicit;e.R7$(3),e.SpI("Regular: ",t.hours_breakdown.regular_hours,"h")}}function F(s,c){if(1&s&&(e.j41(0,"div",28)(1,"strong"),e.EFF(2,"Tasks Completed:"),e.k0s(),e.j41(3,"p"),e.EFF(4),e.k0s()()),2&s){const t=e.XpG().$implicit;e.R7$(4),e.JRh(t.hours_breakdown.tasks)}}function P(s,c){if(1&s&&(e.j41(0,"div",29)(1,"strong"),e.EFF(2,"Notes:"),e.k0s(),e.j41(3,"p"),e.EFF(4),e.k0s()()),2&s){const t=e.XpG().$implicit;e.R7$(4),e.JRh(t.notes)}}function x(s,c){if(1&s&&(e.j41(0,"div",30),e.nrm(1,"ion-icon",31),e.j41(2,"span"),e.EFF(3),e.k0s()()),2&s){const t=e.XpG().$implicit,i=e.XpG(2);e.R7$(3),e.SpI("Submitted: ",i.formatDate(t.submission_date),"")}}function v(s,c){if(1&s&&(e.j41(0,"ion-card",15)(1,"ion-card-content")(2,"div",16)(3,"div")(4,"h3"),e.EFF(5),e.k0s(),e.DNE(6,M,2,1,"p",17),e.k0s(),e.j41(7,"ion-badge",18),e.EFF(8),e.k0s()(),e.j41(9,"div",19),e.DNE(10,j,4,2,"div",20),e.j41(11,"div",21),e.nrm(12,"ion-icon",22),e.j41(13,"span"),e.EFF(14),e.k0s()(),e.DNE(15,C,4,1,"div",20),e.k0s(),e.DNE(16,F,5,1,"div",23)(17,P,5,1,"div",24)(18,x,4,1,"div",25),e.k0s()()),2&s){const t=c.$implicit,i=e.XpG(2);e.R7$(5),e.JRh(i.formatDate(t.date||t.timesheet_date)),e.R7$(),e.Y8G("ngIf",null==t.hours_breakdown?null:t.hours_breakdown.work_mode),e.R7$(),e.Y8G("color",i.getStatusColor(t.status)),e.R7$(),e.SpI(" ",t.status," "),e.R7$(2),e.Y8G("ngIf",(null==t.hours_breakdown?null:t.hours_breakdown.shift_start)&&(null==t.hours_breakdown?null:t.hours_breakdown.shift_end)),e.R7$(4),e.SpI("Hours Worked: ",t.total_hours||t.actual_hours_worked,"h"),e.R7$(),e.Y8G("ngIf",null==t.hours_breakdown?null:t.hours_breakdown.regular_hours),e.R7$(),e.Y8G("ngIf",null==t.hours_breakdown?null:t.hours_breakdown.tasks),e.R7$(),e.Y8G("ngIf",t.notes),e.R7$(),e.Y8G("ngIf",t.submission_date)}}function S(s,c){if(1&s&&(e.j41(0,"div"),e.DNE(1,v,19,10,"ion-card",14),e.k0s()),2&s){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.timesheets)}}function O(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-card-content",32),e.nrm(2,"ion-icon",33),e.j41(3,"h3"),e.EFF(4,"No Timesheets"),e.k0s(),e.j41(5,"p"),e.EFF(6,"You haven't submitted any timesheets yet"),e.k0s(),e.j41(7,"ion-button",9),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.openSubmitModal())}),e.nrm(8,"ion-icon",34),e.EFF(9," Submit Timesheet "),e.k0s()()()}}function R(s,c){if(1&s){const t=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Submit Timesheet"),e.k0s(),e.j41(4,"ion-buttons",35)(5,"ion-button",9),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.closeSubmitModal())}),e.EFF(6,"Close"),e.k0s()()()(),e.j41(7,"ion-content")(8,"div",36)(9,"ion-list")(10,"ion-item")(11,"ion-label",37),e.EFF(12,"Date"),e.k0s(),e.j41(13,"ion-input",38),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.timesheet_date,n)||(o.newTimesheet.timesheet_date=n),e.Njj(n)}),e.k0s()(),e.j41(14,"ion-item")(15,"ion-label",37),e.EFF(16,"Work Mode"),e.k0s(),e.j41(17,"ion-select",39),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.work_mode,n)||(o.newTimesheet.work_mode=n),e.Njj(n)}),e.j41(18,"ion-select-option",40),e.EFF(19,"Office"),e.k0s(),e.j41(20,"ion-select-option",41),e.EFF(21,"Work From Home"),e.k0s(),e.j41(22,"ion-select-option",42),e.EFF(23,"Remote"),e.k0s()()(),e.j41(24,"ion-item")(25,"ion-label",37),e.EFF(26,"Shift Start Time"),e.k0s(),e.j41(27,"ion-input",43),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.shift_start_time,n)||(o.newTimesheet.shift_start_time=n),e.Njj(n)}),e.k0s()(),e.j41(28,"ion-item")(29,"ion-label",37),e.EFF(30,"Shift End Time"),e.k0s(),e.j41(31,"ion-input",43),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.shift_end_time,n)||(o.newTimesheet.shift_end_time=n),e.Njj(n)}),e.k0s()(),e.j41(32,"ion-item")(33,"ion-label",37),e.EFF(34,"Hours Worked"),e.k0s(),e.j41(35,"ion-input",44),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.actual_hours_worked,n)||(o.newTimesheet.actual_hours_worked=n),e.Njj(n)}),e.k0s()(),e.j41(36,"ion-item")(37,"ion-label",37),e.EFF(38,"Tasks Completed *"),e.k0s(),e.j41(39,"ion-textarea",45),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.tasks_completed,n)||(o.newTimesheet.tasks_completed=n),e.Njj(n)}),e.k0s()(),e.j41(40,"ion-item")(41,"ion-label",37),e.EFF(42,"Challenges Faced (Optional)"),e.k0s(),e.j41(43,"ion-textarea",46),e.mxI("ngModelChange",function(n){e.eBV(t);const o=e.XpG();return e.DH7(o.newTimesheet.challenges_faced,n)||(o.newTimesheet.challenges_faced=n),e.Njj(n)}),e.k0s()()(),e.j41(44,"div",47)(45,"ion-button",48),e.bIt("click",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.submitTimesheet())}),e.EFF(46," Submit Timesheet "),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(13),e.R50("ngModel",t.newTimesheet.timesheet_date),e.R7$(4),e.R50("ngModel",t.newTimesheet.work_mode),e.R7$(10),e.R50("ngModel",t.newTimesheet.shift_start_time),e.R7$(4),e.R50("ngModel",t.newTimesheet.shift_end_time),e.R7$(4),e.R50("ngModel",t.newTimesheet.actual_hours_worked),e.R7$(4),e.R50("ngModel",t.newTimesheet.tasks_completed),e.R7$(4),e.R50("ngModel",t.newTimesheet.challenges_faced)}}let E=(()=>{class s{constructor(t,i,n,o){this.timesheetService=t,this.loadingController=i,this.toastController=n,this.alertController=o,this.timesheets=[],this.hasProjectAssignment=!1,this.isLoading=!1,this.selectedStatus="all",this.showSubmitModal=!1,this.newTimesheet={timesheet_date:(new Date).toISOString().split("T")[0],work_mode:"Office",shift_start_time:"09:00",shift_end_time:"18:00",actual_hours_worked:8,tasks_completed:"",challenges_faced:""},(0,f.d)({addOutline:d.EKF,timeOutline:d.CVk,checkmarkOutline:d.g1L,closeOutline:d.xfX,calendarOutline:d.RXF})}ngOnInit(){this.checkAssignment(),this.loadTimesheets()}checkAssignment(){console.log("Checking project assignment status..."),this.timesheetService.checkAssignment().subscribe({next:t=>{console.log("Assignment status:",t),this.hasProjectAssignment=t.has_project},error:t=>{console.error("Error checking assignment:",t)}})}loadTimesheets(t){var i=this;return(0,g.A)(function*(){console.log("Loading timesheets..."),t||(i.isLoading=!0);const n=(new Date).toISOString().split("T")[0],o=new Date(Date.now()-2592e6).toISOString().split("T")[0];i.timesheetService.getMyRegularTimesheets(o,n).subscribe({next:r=>{console.log("Timesheets loaded:",r),i.timesheets="all"!==i.selectedStatus?r.filter(l=>l.status===i.selectedStatus):r,i.timesheets=i.timesheets.sort((l,h)=>new Date(h.date).getTime()-new Date(l.date).getTime()),i.isLoading=!1,t&&t.target.complete()},error:r=>{console.error("Error loading timesheets:",r),i.showToast(r.error?.error||r.error?.message||"Failed to load timesheets","danger"),i.isLoading=!1,t&&t.target.complete()}})})()}segmentChanged(t){this.selectedStatus=t.detail.value,this.loadTimesheets()}openSubmitModal(){this.showSubmitModal=!0}closeSubmitModal(){this.showSubmitModal=!1}submitTimesheet(){var t=this;return(0,g.A)(function*(){if(!t.newTimesheet.tasks_completed.trim())return void t.showToast("Please enter tasks completed","warning");const i=yield t.loadingController.create({message:"Submitting timesheet..."});yield i.present();const n=new Date(`2000-01-01 ${t.newTimesheet.shift_start_time}`),r=(new Date(`2000-01-01 ${t.newTimesheet.shift_end_time}`).getTime()-n.getTime())/36e5,l={date:t.newTimesheet.timesheet_date,total_hours:r||t.newTimesheet.actual_hours_worked,hours_breakdown:{work_mode:t.newTimesheet.work_mode,shift_start:t.newTimesheet.shift_start_time,shift_end:t.newTimesheet.shift_end_time,regular_hours:t.newTimesheet.actual_hours_worked,tasks:t.newTimesheet.tasks_completed},notes:t.newTimesheet.challenges_faced};console.log("Submitting timesheet data:",l),t.timesheetService.submitRegularTimesheet(l).subscribe({next:h=>{console.log("Timesheet submitted:",h),i.dismiss(),t.showToast(h.message||"Timesheet submitted successfully","success"),t.closeSubmitModal(),t.resetForm(),t.loadTimesheets()},error:h=>{i.dismiss(),console.error("Error submitting timesheet:",h),t.showToast(h.error?.error||h.error?.message||h.message||"Failed to submit timesheet","danger")}})})()}resetForm(){this.newTimesheet={timesheet_date:(new Date).toISOString().split("T")[0],work_mode:"Office",shift_start_time:"09:00",shift_end_time:"18:00",actual_hours_worked:8,tasks_completed:"",challenges_faced:""}}getStatusColor(t){switch(t?.toLowerCase()){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";default:return"medium"}}formatDate(t){return new Date(t).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}showToast(t,i){var n=this;return(0,g.A)(function*(){yield(yield n.toastController.create({message:t,duration:3e3,color:i,position:"bottom"})).present()})()}static{this.\u0275fac=function(i){return new(i||s)(e.rXU(b),e.rXU(a.Xi),e.rXU(a.K_),e.rXU(a.hG))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-timesheets"]],standalone:!0,features:[e.aNF],decls:26,vars:5,consts:[["slot","start"],["defaultHref","/tabs/home"],[3,"ngModelChange","ionChange","ngModel"],["value","all"],["value","pending"],["value","approved"],["class","info-card",4,"ngIf"],[4,"ngIf"],["slot","fixed","vertical","bottom","horizontal","end"],[3,"click"],["name","add-outline"],[3,"didDismiss","isOpen"],[1,"info-card"],["name","checkmark-outline","color","success"],["class","timesheet-card",4,"ngFor","ngForOf"],[1,"timesheet-card"],[1,"timesheet-header"],["class","work-mode",4,"ngIf"],[3,"color"],[1,"timesheet-details"],["class","detail-row",4,"ngIf"],[1,"detail-row"],["name","time-outline"],["class","tasks-section",4,"ngIf"],["class","challenges-section",4,"ngIf"],["class","submission-time",4,"ngIf"],[1,"work-mode"],["name","checkmark-outline"],[1,"tasks-section"],[1,"challenges-section"],[1,"submission-time"],["name","calendar-outline"],[1,"empty-state"],["name","time-outline","size","large"],["name","add-outline","slot","start"],["slot","end"],[1,"modal-content"],["position","stacked"],["type","date",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],["value","Office"],["value","WFH"],["value","Remote"],["type","time",3,"ngModelChange","ngModel"],["type","number",3,"ngModelChange","ngModel"],["rows","4","placeholder","Describe what you accomplished today...",3,"ngModelChange","ngModel"],["rows","3","placeholder","Any issues or blockers...",3,"ngModelChange","ngModel"],[1,"button-container"],["expand","block",3,"click"]],template:function(i,n){1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e.nrm(3,"ion-back-button",1),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"My Timesheets"),e.k0s()(),e.j41(6,"ion-toolbar")(7,"ion-segment",2),e.mxI("ngModelChange",function(r){return e.DH7(n.selectedStatus,r)||(n.selectedStatus=r),r}),e.bIt("ionChange",function(r){return n.segmentChanged(r)}),e.j41(8,"ion-segment-button",3)(9,"ion-label"),e.EFF(10,"All"),e.k0s()(),e.j41(11,"ion-segment-button",4)(12,"ion-label"),e.EFF(13,"Pending"),e.k0s()(),e.j41(14,"ion-segment-button",5)(15,"ion-label"),e.EFF(16,"Approved"),e.k0s()()()()(),e.j41(17,"ion-content"),e.DNE(18,w,5,0,"ion-card",6)(19,S,2,1,"div",7)(20,O,10,0,"ion-card",7),e.j41(21,"ion-fab",8)(22,"ion-fab-button",9),e.bIt("click",function(){return n.openSubmitModal()}),e.nrm(23,"ion-icon",10),e.k0s()(),e.j41(24,"ion-modal",11),e.bIt("didDismiss",function(){return n.closeSubmitModal()}),e.DNE(25,R,47,7,"ng-template"),e.k0s()()),2&i&&(e.R7$(7),e.R50("ngModel",n.selectedStatus),e.R7$(11),e.Y8G("ngIf",n.hasProjectAssignment),e.R7$(),e.Y8G("ngIf",!n.isLoading&&n.timesheets.length>0),e.R7$(),e.Y8G("ngIf",!n.isLoading&&0===n.timesheets.length),e.R7$(4),e.Y8G("isOpen",n.showSubmitModal))},dependencies:[_.MD,_.Sq,_.bT,u.YN,u.BC,u.vS,a.W9,a.eU,a.BC,a.ai,a.QW,a.el,a.b_,a.I9,a.nf,a.uz,a.he,a.In,a.Jm,a.iq,a.Gp,a.eP,a.Q8,a.YW,a.Nm,a.Ip,a.Sb,a.nc,a.$w],styles:[".info-card[_ngcontent-%COMP%]{margin:12px;background:rgba(var(--ion-color-success-rgb),.1);border-left:4px solid var(--ion-color-success)}.info-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.info-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.5em}.timesheet-card[_ngcontent-%COMP%]{margin:12px}.timesheet-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px}.timesheet-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-size:1.1em;color:var(--ion-color-dark)}.timesheet-header[_ngcontent-%COMP%]   .work-mode[_ngcontent-%COMP%]{margin:0;font-size:.85em;color:var(--ion-color-medium)}.timesheet-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;margin:16px 0;padding:12px;background:var(--ion-color-light);border-radius:8px}.detail-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:.9em}.detail-row[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-size:1.2em}.tasks-section[_ngcontent-%COMP%], .challenges-section[_ngcontent-%COMP%]{margin:12px 0}.tasks-section[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%], .challenges-section[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;margin-bottom:6px;color:var(--ion-color-dark)}.tasks-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .challenges-section[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--ion-color-medium);font-size:.9em;line-height:1.5}.submission-time[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;margin-top:12px;padding-top:12px;border-top:1px solid var(--ion-color-light);font-size:.85em;color:var(--ion-color-medium)}.submission-time[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.1em}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:16px 0 8px;color:var(--ion-color-dark)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:24px}.modal-content[_ngcontent-%COMP%]{padding:16px}.button-container[_ngcontent-%COMP%]{margin-top:20px;padding:0 16px 16px}ion-modal[_ngcontent-%COMP%]{--height: 90%}"]})}}return s})()}}]);